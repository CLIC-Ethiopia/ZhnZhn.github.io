(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{7909:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ae});var o=s(9679),n=s(9468),i=s(7728),a=s(2554),r=s(8804),c=s(2812);const l=e=>"is"+e+"Select";var u=s(5893);const d=(e,t,{isShowLabels:s,isRow:o,fSelect:n})=>{const{id:i,caption:a,options:r}=e,d=!o[l(i)];return(0,u.jsx)(c.Z.ShowHide,{isShow:d,children:(0,u.jsx)(c.Z.RowInputSelect,{isShowLabels:s,caption:a,options:r,onSelect:n(t)})},i)};var p=s(1926);const h=e=>{const t=(0,o.useRef)(e),s=(0,o.useCallback)((e=>{t.current=e}),[]);return[t,s]},m=(e,t,s)=>({caption:e,title:t,onClick:s}),g=(e,t,s,n)=>{const[i,a]=(0,p.Z)(!0),r=(0,o.useMemo)((()=>[m("L","Click to toggle input labels",e),m("T","Toggle Inputs",t),m("O","Chart Options",s),m("A","About Datasource",n)]),[]);return[(0,o.useMemo)((()=>(0,u.jsx)(c.Z.Toolbar,{isShow:i,buttons:r})),[i]),a]},f="row__pane-topic not-selected",C=(e,t,s=!0)=>({cn:f,onClick:t,name:e,isClose:s}),S=(e,t)=>(0,o.useMemo)((()=>({titleCl:f,pageWidth:175,maxPages:1,p0:[C("Toggle ToolBar",e),C("About Datasource",t)]})),[]),w=e=>{const[t,s]=(0,o.useState)(e);return[t,(0,o.useCallback)((()=>s((e=>!e))),[]),(0,o.useCallback)((()=>s(!1)),[])]},b=()=>{const e=(0,o.useRef)({}),[t,s,n]=w(!1),i=(0,o.useCallback)((t=>{e.current[t]=!e.current[t]}),[]);return[(0,o.useMemo)((()=>(0,u.jsx)(c.Z.ModalOptions,{isShow:t,toggleOption:i,onClose:n})),[t]),e,s]},v=e=>{const[t,s,n]=w(!1),[i,a]=(0,o.useState)({isShowChart:!0,isShowDate:!1}),{isShowChart:r,isShowDate:d}=i,p=(0,o.useCallback)((e=>{a((t=>(t[e]=!t[e],{...t})))}),[]),h=(0,o.useRef)([]),m=(0,o.useCallback)((e=>{h.current.push(e)}),[]),g=(0,o.useCallback)((e=>{h.current=h.current.filter((t=>t!==e))}),[]);return[(0,o.useMemo)((()=>(0,u.jsx)(c.Z.ModalToggle,{isShow:t,selectProps:e,isShowChart:r,isShowDate:d,crIsId:l,onToggle:p,onCheckCaption:m,onUnCheckCaption:g,onClose:n})),[t,e,r,d]),h,i,a,s]};const O=class{constructor(e=5e3){this.mls=e,this.isLoading=!1}start(e){return!this.isLoading&&(this.loadingUrl=e,this.isLoading=!0,this.timeoutId=setTimeout((()=>{e===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}};var T=s(9546),y=s.n(T);const x=(e,t)=>fetch(e,t).then((e=>{const{status:t,statusText:s}=e;if(t>=200&&t<400)return e.json();if(403===t)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+t+" "+s)})),D={selection:{filter:"all",values:["*"]}},k={code:"Tid",selection:{filter:"top",values:["1"]}},M=(e,t)=>{const s=e.map((e=>({code:e.v,...D})));return t||s.push(k),{method:"POST",body:JSON.stringify({query:s,response:{format:"json-stat"}})}},L=(e,t)=>{const s=[],o=t.v,n=e.Dimension(o),i=n.length;let a=0;for(;a<i;a++)s.push({caption:n.Category(a).label,slice:{[o]:n.id[a]}});return s},I=new O,F=e=>{const{metaUrl:t,dims:s=[],noTime:o,timeId:n}=e;if(I.isLoading)return Promise.resolve({errMsg:"Another dims are still loading"});{const e=M(s,o);return I.start(t),x(t,e).then((e=>{const t=((e,t,s)=>{const o=y()(e).Dataset(0);return t.map((e=>({id:e.v,caption:e.c,options:L(o,e)}))).filter((e=>t=>t.id!==e)(s))})(e,s,n);return I.stop(),{configs:t}})).catch((e=>(I.stop(),{errMsg:e.message})))}},Z=Array.isArray,j=e=>e.charAt(0).toUpperCase()+e.substring(1),q=(e,t,s)=>({caption:e,slice:{[t]:s}}),R=(e,t)=>!Z(e)||!Z(t)||e.length!==t.length,A=({values:e,valueTexts:t,code:s})=>{if(!R(e,t))return t.map(((t,o)=>q(t,s,e[o])))},E=({values:e,id:t})=>(e||[]).map((e=>q(e.text,t,e.id))),P=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],U={month:"M",quarter:"K"},_=e=>{const t=[],{variables:s}=e;let o,n="Y";return Z(s)?(i=s[0])&&i.id&&i.text&&!Z(i.valueTexts)&&Z(i.values)?(e=>{const t=[];let s;return e.forEach((e=>{const{time:o,text:n="",id:i}=e;o?(s=i,t.dateOptions=e.values.map((({id:e,text:t})=>({caption:t,value:e}))).reverse()):t.push({c:j(n),v:i,options:E(e)})})),{mapFrequency:"Y",dims:t,timeId:s}})(s):(s.forEach((e=>{const{code:s,time:i}=e,a=e.text||"";((e,t)=>!e&&-1===P.indexOf(t)&&-1===(t+"").indexOf("TLIST("))(i,s)?t.push({c:j(a),v:s,options:A(e)}):(o=s,n=U[a.toLowerCase()],t.dateOptions=(({values:e,valueTexts:t})=>{if(R(e,t))return;const s=[];return t.forEach(((t,o)=>{s.push({caption:t,value:e[o]})})),s.reverse()})(e))})),{mapFrequency:n,dims:t,timeId:o}):{dims:t,timeId:o,mapFrequency:n};var i},W=e=>x(e).then(_),B=e=>{const t=e.map((({c:e,v:t,options:s})=>({id:t,caption:e,options:s})));return t.dateOptions=e.dateOptions,t},H=new O,N=e=>{if(H.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const t=(e=>e.metaUrl||(({proxy:e="",baseMeta:t,dfId:s})=>""+e+t+"/"+s)(e))(e);return e.dims?F({metaUrl:t,...e}):(H.start(t),W(t).then((({dims:s,mapFrequency:o,timeId:n})=>(H.stop(),(e=>{const t=e.length;let s=0;for(;s<t&&e[s].options;s++);return s===t})(s)?{timeId:n,mapFrequency:o,configs:B(s)}:F({noTime:e.noTime,metaUrl:t,dims:s,mapFrequency:o,timeId:n})))).catch((({errMsg:e,message:t})=>(H.stop(),{errMsg:e||t}))))}},V=e=>{const t=(0,o.useRef)();return(0,o.useEffect)((()=>{t.current=e}),[e]),t.current},{crOptions:Y}=i.Z,{crDateConfig:J}=c.Z,K="M",z=({dims:e,proxy:t,baseMeta:s,dfProps:o},n)=>{N({dims:e,proxy:t,baseMeta:s,...o}).then(n).catch((e=>{n({errMsg:e.message})}))},G=()=>({isLoading:!0,isLoadFailed:!1}),Q=e=>e.map((e=>e.options)),X=e=>e.map((e=>({caption:e.caption,value:e.id}))),$=e=>{const{chartsType:t,mapFrequency:s=K,mapDateDf:n}=e,[{isLoading:i,isLoadFailed:a},r]=(0,o.useState)(G),[c,l]=(0,o.useState)([]),[u,d]=(0,o.useState)((()=>({configs:[],selectOptions:[],mapFrequency:s,chartOptions:Y(e),dateOptions:[]}))),p=(0,o.useCallback)((({configs:e,timeId:o,mapFrequency:i,errMsg:a})=>{if(e){const a=i||s,[c,l]=((e,t,s)=>{const{dateOptions:o}=e;if(o)return[o,o[0]];const{dateOptions:n,dateDefault:i}=J(t,s);return[n,{caption:i,value:i}]})(e,a,n);r({isLoading:!1,isLoadFailed:!1}),d({timeId:o,configs:e,selectOptions:Q(e),mapFrequency:a,dimOptions:X(e),chartOptions:Y({configs:e,chartsType:t}),dateOptions:c,dateDf:l})}else r({isLoading:!1,isLoadFailed:!0}),l([a])}),[t,s,n]),h=((e,t)=>{const s=V(e);return t&&!s.isShow&&e.isShow})(e,a);return(0,o.useEffect)((()=>{z(e,p)}),[]),(0,o.useEffect)((()=>{h&&(z(e,p),r(G))}),[h,e,p]),[u,i,a,c,l,d]},ee=e=>(0,o.useMemo)((()=>[(0,u.jsx)(c.Z.Button.Load,{onClick:e},"load")]),[e]),te={margin:"16px auto 32px"},se={borderColor:"#f44336",animation:"none"},{isCategory:oe}=i.Z,ne=n.Z.wideWidth(),ie=(e,t)=>e.isShow===t.isShow,ae={StatN:(0,o.memo)((e=>{const{isShow:t,caption:s,onShow:n,onFront:i,loadFn:l,onLoad:m,dims:f,msgOnNotSelected:C,onClickInfo:w,onClose:O}=e,T=!e.dims,y=(0,o.useRef)([]),x=(0,o.useCallback)((e=>t=>{y.current[e]=t?{...t}:void 0}),[]),[D,k]=h(),[M,L]=h(),[I,F]=h(),[Z,j,q,R,A,E]=$(e),{configs:P,selectOptions:U,chartType:_,chartOptions:W,dimOptions:B,dateOptions:H,dateDf:N={},timeId:V}=Z,[Y,J]=(0,p.Z)(ne),[K,z,G]=b(),[Q,X,ie,ae,re]=v(P),{isShowDate:ce,isShowChart:le}=ie,[ue,de]=g(J,re,G,w),pe=(0,o.useCallback)((()=>{O(),A([])}),[]),he=(0,o.useCallback)((()=>{const e=[];if(q)return e.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."),e;if(j)return e.push("Dims is loading"),e;const t=oe(_),{dim:s}=_||{},o=((e,t,s,o)=>n=>{s.forEach(((s,i)=>{const{caption:a}=s;n(a)&&!o[i]&&e.push(t(a))}))})(e,C,P,y.current);if(f||!t)return o((e=>!(t&&e===s))),e;if(t){const t=I.current;if(!t)return e.push("Dim isn't selected"),e;o((e=>e!==t.caption))}return e}),[q,j,P,_,C]),me=(0,o.useCallback)((e=>{let t=!1;oe(e)&&(M.current=null,t=!0),ae((e=>(e.isShowDate=t,{...e}))),E((t=>({...t,chartType:e})))}),[]),ge=(0,o.useCallback)((()=>{const t=he();if(0===t.length){const{seriaColor:t,seriaWidth:s}=D.current?D.current.getConf():{},o=((e,t)=>{const{dfC:s}=e;return s||(t||{}).value})(e,I.current),n=((e,t)=>e.dfC||!t?"":t.caption||"")(e,I.current),i=l({...e},{timeId:V,dfC:o,dfTitle:n,time:(M.current||N).value,dialogOptions:z.current,chartType:_,seriaColor:t,seriaWidth:s,items:y.current,titles:X.current,selectOptions:U});m(i)}A(t)}),[he,N,V,_,P,U]),fe=ee(ge),Ce=S(de,w),Se=((e,t)=>e?te:t?{...te,...se}:void 0)(j,q);return(0,u.jsxs)(c.Z.DraggableDialog,{isShow:t,caption:s,menuModel:Ce,commandButtons:fe,onShowChart:n,onFront:i,onClose:pe,children:[ue,K,Q,Se?(0,u.jsx)(a.Z,{style:Se}):(0,u.jsx)(r.Z,{items:P,crItem:d,isShowLabels:Y,isRow:ie,fSelect:x}),(0,u.jsx)(c.Z.RowChartDate,{chartType:_,isShowLabels:Y,isShowChart:le,chartOptions:W,onSelectChart:me,onRegColor:k,isShowDate:ce,dateDefault:N.caption,dateOptions:H,onSelecDate:L,isDim:T,dimOptions:B,onSelecDim:F}),(0,u.jsx)(c.Z.ValidationMessages,{validationMessages:R})]})}),ie)}}}]);