(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{1625:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>A});var n=o(2122),i=o(7866),s=o(3552),a=o(5893),r=o(9679);const c=function(){function t(t){void 0===t&&(t=5e3),this.mls=t,this.isLoading=!1}var e=t.prototype;return e.start=function(t){var e=this;return!this.isLoading&&(this.loadingUrl=t,this.isLoading=!0,this.timeoutId=setTimeout((function(){t===e.loadingUrl&&(e.isLoading=!1)}),this.mls),!0)},e.stop=function(){this.isLoading=!1,clearTimeout(this.timeoutId)},t}();var l=o(9546),u=o.n(l);const h=function(t,e){return fetch(t,e).then((function(t){var e=t.status,o=t.statusText;if(e>=200&&e<400)return t.json();if(403===e)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+e+" "+o)}))};var d={selection:{filter:"all",values:["*"]}},p={code:"Tid",selection:{filter:"top",values:["1"]}},f=function(t,e){var o=t.map((function(t){return e=t.v,(0,n.Z)({code:e},d);var e}));return e||o.push(p),{method:"POST",body:JSON.stringify({query:o,response:{format:"json-stat"}})}},g=function(t,e){for(var o=[],n=e.v,i=t.Dimension(n),s=i.length,a=0;a<s;a++){var r;o.push({caption:i.Category(a).label,slice:(r={},r[n]=i.id[a],r)})}return o},m=new c;const v=function(t){var e=t.metaUrl,o=t.dims,n=void 0===o?[]:o,i=t.noTime,s=t.timeId;if(m.isLoading)return Promise.resolve({errMsg:"Another dims are still loading"});var a=f(n,i);return m.start(e),h(e,a).then((function(t){var e=function(t,e,o){var n=u()(t).Dataset(0);return e.map((function(t){return{id:t.v,caption:t.c,options:g(n,t)}})).filter(function(t){return function(e){return e.id!==t}}(o))}(t,n,s);return m.stop(),{configs:e}})).catch((function(t){return m.stop(),{errMsg:t.message}}))};var _=Array.isArray,S=function(t){var e=t.values,o=t.valueTexts,n=t.code;if(_(e)&&_(o)&&e.length===o.length){for(var i=[],s=0;s<o.length;s++){var a;i.push({caption:o[s],slice:(a={},a[n]=e[s],a)})}return i}},C=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],y={month:"M",quarter:"K"},T=function(t){var e,o=[],n=t.variables,i="Y";return(void 0===n?[]:n).forEach((function(t){var n,s=t.code,a=t.time,r=t.text||"";a||-1!==C.indexOf(s)?(e=s,i=y[r.toLowerCase()]):o.push({c:(n=r,n.charAt(0).toUpperCase()+n.substring(1)),v:s,options:S(t)})})),{mapFrequency:i,dims:o,timeId:e}};const w=function(t){return h(t).then(T)};var D=function(t){return t.map((function(t){var e=t.c;return{id:t.v,caption:e,options:t.options}}))},b=new c;const L=function(t){if(b.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});var e=function(t){return t.metaUrl||""+(void 0===(o=(e=t).proxy)?"":o)+e.baseMeta+"/"+e.dfId;var e,o}(t);return t.dims?v((0,n.Z)({metaUrl:e},t)):(b.start(e),w(e).then((function(o){var n=o.dims,i=o.mapFrequency,s=o.timeId;return b.stop(),function(t){for(var e=t.length,o=0;o<e&&t[o].options;o++);return o===e}(n)?{timeId:s,mapFrequency:i,configs:D(n)}:v({noTime:t.noTime,metaUrl:e,dims:n,mapFrequency:i,timeId:s})})).catch((function(t){var e=t.errMsg,o=t.message;return b.stop(),{errMsg:e||o}})))};var I,M=o(7728),O=o(2554),Z=o(377),F=Z.Z.Decor,x=Z.Z.crMenuMore,N=Z.Z.crDateConfig,q={SPINNER_LOADING:{margin:"16px auto 32px"},SPINNER_FAILED:{borderColor:"#f44336",animation:"none"}},P=M.Z.isCategory,j=M.Z.crOptions,k=function(t){return"is"+t+"Select"};const A={StatN:(0,F.dialog)(I=function(t){function e(e){var o;return(o=t.call(this,e)||this)._toggleStateBy=function(t){o.setState((function(e){var o;return(o={})[t]=!e[t],o}))},o._checkCaptionBy=function(t){o._titles.push(t)},o._uncheckCaption=function(t){o._titles=o._titles.filter((function(e){return e!==t}))},o._setConfigs=function(t){var e=t.configs,n=t.timeId,i=t.mapFrequency,s=t.errMsg;if(e){var a=o.props,r=a.chartsType,c=a.mapFrequency;o.setState({isLoading:!1,isLoadFailed:!1,timeId:n,configs:e,mapFrequency:i||c,selectOptions:e.map((function(t){return t.options})),chartOptions:j({configs:e,chartsType:r})})}else o.setState({isLoading:!1,isLoadFailed:!0,validationMessages:[s]})},o._loadDims=function(){var t=o.props,e=t.dims,i=t.proxy,s=t.baseMeta,a=t.dfProps;L((0,n.Z)({dims:e,proxy:i,baseMeta:s},a)).then(o._setConfigs).catch((function(t){o._setConfigs({errMsg:t.message})}))},o._updateForDate=function(t){o.date=null;var e=o.props.mapDateDf,i=o.state.mapFrequency,s=N(i||"M",e);o.setState((0,n.Z)({isShowDate:!0},s,{chartType:t}))},o._handleLoad=function(){var t=o._crValidationMessages();if(0===t.length){var e=(0,i.Z)(o),s=e._items,a=e.dialogOptions,r=e.colorComp,c=e.date,l=o.state,u=l.timeId,h=l.chartType,d=l.selectOptions,p=r?r.getConf():{},f=p.seriaColor,g=p.seriaWidth,m=o.state.dateDefault,v=(0,n.Z)({},o.props,{timeId:u}),_=o.props.loadFn(v,{dialogOptions:a,chartType:h,seriaColor:f,seriaWidth:g,date:c,dateDefault:m,items:s,titles:o._titles,selectOptions:d});o.props.onLoad(_)}o.setState({validationMessages:t})},o._crValidationMessages=function(){var t=[],e=o.state,n=e.configs,i=e.isLoadFailed,s=e.chartType,a=void 0===s?{}:s,r=P(a),c=a.dim;return i?t.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."):n.forEach((function(e,n){var i=e.caption;r&&i===c||o._items[n]||t.push(o.props.msgOnNotSelected(i))})),t},o._handleClose=function(){o._handleWithValidationClose()},o._hSelectChartType=function(t){P(t)?o._updateForDate(t):o.setState({chartType:t,isShowDate:!1})},o._onRegColor=function(t){o.colorComp=t},o._fSelect=function(t){return function(e){this._items[t]=e}},o._hSelectDate=function(t){o.date=t},o._renderSelectInputs=function(){var t=o.state,e=t.isShowLabels;return t.configs.map((function(t,n){var s=t.id,r=t.caption,c=t.options,l=!o.state[k(s)];return(0,a.jsx)(Z.Z.ShowHide,{isShow:l,children:(0,a.jsx)(Z.Z.RowInputSelect,{isShowLabels:e,caption:r,options:c,onSelect:o._fSelect(n).bind((0,i.Z)(o))})},s)}))},o._menuMore=x((0,i.Z)(o),{toggleToolBar:o._toggleWithToolbar,onAbout:o._clickInfoWithToolbar}),o.toolbarButtons=o._createType2WithToolbar(e,{noDate:!0,isOptions:!0,isToggle:!0}),o._commandButtons=o._crCommandsWithLoad((0,i.Z)(o)),o._items=[],o._titles=[],o.state=(0,n.Z)({},o._isWithInitialState(),{isLoading:!0,isLoadFailed:!1,isShowChart:!0,isShowDate:!1},N("EMPTY"),{isOptions:!1,isToggle:!1,configs:[],selectOptions:[],mapFrequency:e.mapFrequency,chartOptions:j(e)}),o}(0,s.Z)(e,t);var o=e.prototype;return o.shouldComponentUpdate=function(t,e){return this.props===t||this.props.isShow!==t.isShow},o.componentDidMount=function(){this._loadDims()},o.componentDidUpdate=function(t){(function(t,e,o){return e!==t&&!t.isShow&&e.isShow&&o.isLoadFailed})(t,this.props,this.state)&&(this.setState({isLoading:!0,isLoadFailed:!1}),this._loadDims())},o.render=function(){var t=this.props,e=t.caption,o=t.isShow,i=t.onShow,s=t.onFront,r=this.state,c=r.chartType,l=r.isToolbar,u=r.isOptions,h=r.isToggle,d=r.isShowLabels,p=r.isLoading,f=r.isLoadFailed,g=r.isShowChart,m=r.isShowDate,v=r.dateDefault,_=r.dateOptions,S=r.configs,C=r.chartOptions,y=r.validationMessages,T=f?(0,n.Z)({},q.SPINNER_LOADING,q.SPINNER_FAILED):q.SPINNER_LOADING;return(0,a.jsxs)(Z.Z.DraggableDialog,{isShow:o,caption:e,menuModel:this._menuMore,commandButtons:this._commandButtons,onShowChart:i,onFront:s,onClose:this._handleClose,children:[(0,a.jsx)(Z.Z.Toolbar,{isShow:l,buttons:this.toolbarButtons}),(0,a.jsx)(Z.Z.ModalOptions,{isShow:u,toggleOption:this._toggleOptionWithToolbar,onClose:this._hideOptionsWithToolbar}),(0,a.jsx)(Z.Z.ModalToggle,{isShow:h,selectProps:S,isShowChart:g,isShowDate:m,crIsId:k,onToggle:this._toggleStateBy,onCheckCaption:this._checkCaptionBy,onUnCheckCaption:this._uncheckCaption,onClose:this._hideToggleWithToolbar}),(p||f)&&(0,a.jsx)(O.Z,{style:T}),!p&&!f&&this._renderSelectInputs(),(0,a.jsx)(Z.Z.RowChartDate,{chartType:c,isShowLabels:d,isShowChart:g,chartOptions:C,onSelectChart:this._hSelectChartType,onRegColor:this._onRegColor,isShowDate:m,dateDefault:v,dateOptions:_,onSelecDate:this._hSelectDate}),(0,a.jsx)(Z.Z.ValidationMessages,{validationMessages:y})]})},e}(r.Component))||I}}}]);