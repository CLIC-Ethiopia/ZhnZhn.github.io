(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{1625:(t,s,e)=>{"use strict";e.r(s),e.d(s,{default:()=>A});var i=e(9679);const o=class{constructor(t=5e3){this.mls=t,this.isLoading=!1}start(t){return!this.isLoading&&(this.loadingUrl=t,this.isLoading=!0,this.timeoutId=setTimeout((()=>{t===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}};var a=e(9546),n=e.n(a);const r=(t,s)=>fetch(t,s).then((t=>{const{status:s,statusText:e}=t;if(s>=200&&s<400)return t.json();if(403===s)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+s+" "+e)})),h={selection:{filter:"all",values:["*"]}},l={code:"Tid",selection:{filter:"top",values:["1"]}},c=(t,s)=>{const e=t.map((t=>({code:t.v,...h})));return s||e.push(l),{method:"POST",body:JSON.stringify({query:e,response:{format:"json-stat"}})}},p=(t,s)=>{const e=[],i=s.v,o=t.Dimension(i),a=o.length;let n=0;for(;n<a;n++)e.push({caption:o.Category(n).label,slice:{[i]:o.id[n]}});return e},d=new o,g=({metaUrl:t,dims:s=[],noTime:e,timeId:i})=>{if(d.isLoading)return Promise.resolve({errMsg:"Another dims are still loading"});{const o=c(s,e);return d.start(t),r(t,o).then((t=>{const e=((t,s,e)=>{const i=n()(t).Dataset(0);return s.map((t=>({id:t.v,caption:t.c,options:p(i,t)}))).filter((t=>s=>s.id!==t)(e))})(t,s,i);return d.stop(),{configs:e}})).catch((t=>(d.stop(),{errMsg:t.message})))}},u=Array.isArray,m=t=>t.charAt(0).toUpperCase()+t.substring(1),_=({values:t,valueTexts:s,code:e})=>{if(!u(t)||!u(s)||t.length!==s.length)return;const i=[];for(let o=0;o<s.length;o++)i.push({caption:s[o],slice:{[e]:t[o]}});return i},S=({values:t,id:s})=>{const e=[];for(let i=0;i<t.length;i++)e.push({caption:t[i].text,slice:{[s]:t[i].id}});return e},f=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],C={month:"M",quarter:"K"},T=t=>{const s=[],{variables:e}=t;let i,o="Y";return(e||[]).forEach((t=>{const{code:e,time:a}=t,n=t.text||"";((t,s,e)=>!t&&s&&e.id&&!u(e.valueTexts)&&u(e.values))(a,n,t)?s.push({c:m(n),v:t.id,options:S(t)}):a||-1!==f.indexOf(e)?(i=e,o=C[n.toLowerCase()]):s.push({c:m(n),v:e,options:_(t)})})),{mapFrequency:o,dims:s,timeId:i}},y=t=>r(t).then(T),w=t=>t.map((({c:t,v:s,options:e})=>({id:s,caption:t,options:e}))),D=new o,b=t=>{if(D.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const s=(t=>t.metaUrl||(({proxy:t="",baseMeta:s,dfId:e})=>""+t+s+"/"+e)(t))(t);return t.dims?g({metaUrl:s,...t}):(D.start(s),y(s).then((({dims:e,mapFrequency:i,timeId:o})=>(D.stop(),(t=>{const s=t.length;let e=0;for(;e<s&&t[e].options;e++);return e===s})(e)?{timeId:o,mapFrequency:i,configs:w(e)}:g({noTime:t.noTime,metaUrl:s,dims:e,mapFrequency:i,timeId:o})))).catch((({errMsg:t,message:s})=>(D.stop(),{errMsg:t||s}))))}};var L,I=e(7728),M=e(2554),O=e(2812),F=e(5893);const{Decor:v,crMenuMore:x,crDateConfig:N}=O.Z,q={SPINNER_LOADING:{margin:"16px auto 32px"},SPINNER_FAILED:{borderColor:"#f44336",animation:"none"}},{isCategory:P,crOptions:j}=I.Z,k=t=>"is"+t+"Select";const A={StatN:(0,v.dialog)(L=class extends i.Component{constructor(t){super(t),this._toggleStateBy=t=>{this.setState((s=>({[t]:!s[t]})))},this._checkCaptionBy=t=>{this._titles.push(t)},this._uncheckCaption=t=>{this._titles=this._titles.filter((s=>s!==t))},this._setConfigs=({configs:t,timeId:s,mapFrequency:e,errMsg:i})=>{if(t){const{chartsType:i,mapFrequency:o}=this.props;this.setState({isLoading:!1,isLoadFailed:!1,timeId:s,configs:t,mapFrequency:e||o,selectOptions:t.map((t=>t.options)),chartOptions:j({configs:t,chartsType:i})})}else this.setState({isLoading:!1,isLoadFailed:!0,validationMessages:[i]})},this._loadDims=()=>{const{dims:t,proxy:s,baseMeta:e,dfProps:i}=this.props;b({dims:t,proxy:s,baseMeta:e,...i}).then(this._setConfigs).catch((t=>{this._setConfigs({errMsg:t.message})}))},this._updateForDate=t=>{this.date=null;const{mapDateDf:s}=this.props,{mapFrequency:e}=this.state,i=N(e||"M",s);this.setState({isShowDate:!0,...i,chartType:t})},this._handleLoad=()=>{const t=this._crValidationMessages();if(0===t.length){const{_items:t,dialogOptions:s,colorComp:e,date:i}=this,{timeId:o,chartType:a,selectOptions:n}=this.state,{seriaColor:r,seriaWidth:h}=e?e.getConf():{},{dateDefault:l}=this.state,c={...this.props,timeId:o},p=this.props.loadFn(c,{dialogOptions:s,chartType:a,seriaColor:r,seriaWidth:h,date:i,dateDefault:l,items:t,titles:this._titles,selectOptions:n});this.props.onLoad(p)}this.setState({validationMessages:t})},this._crValidationMessages=()=>{const t=[],{configs:s,isLoadFailed:e,chartType:i={}}=this.state,o=P(i),{dim:a}=i;return e?t.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."):s.forEach(((s,e)=>{const{caption:i}=s;o&&i===a||this._items[e]||t.push(this.props.msgOnNotSelected(i))})),t},this._handleClose=()=>{this._handleWithValidationClose()},this._hSelectChartType=t=>{P(t)?this._updateForDate(t):this.setState({chartType:t,isShowDate:!1})},this._onRegColor=t=>{this.colorComp=t},this._fSelect=t=>function(s){this._items[t]=s},this._hSelectDate=t=>{this.date=t},this._renderSelectInputs=()=>{const{isShowLabels:t,configs:s}=this.state;return s.map(((s,e)=>{const{id:i,caption:o,options:a}=s,n=!this.state[k(i)];return(0,F.jsx)(O.Z.ShowHide,{isShow:n,children:(0,F.jsx)(O.Z.RowInputSelect,{isShowLabels:t,caption:o,options:a,onSelect:this._fSelect(e).bind(this)})},i)}))},this._menuMore=x(this,{toggleToolBar:this._toggleWithToolbar,onAbout:this._clickInfoWithToolbar}),this.toolbarButtons=this._createType2WithToolbar(t,{noDate:!0,isOptions:!0,isToggle:!0}),this._commandButtons=this._crCommandsWithLoad(this),this._items=[],this._titles=[],this.state={...this._isWithInitialState(),isLoading:!0,isLoadFailed:!1,isShowChart:!0,isShowDate:!1,...N("EMPTY"),isOptions:!1,isToggle:!1,configs:[],selectOptions:[],mapFrequency:t.mapFrequency,chartOptions:j(t)}}shouldComponentUpdate(t,s){return this.props===t||this.props.isShow!==t.isShow}componentDidMount(){this._loadDims()}componentDidUpdate(t){((t,s,e)=>s!==t&&!t.isShow&&s.isShow&&e.isLoadFailed)(t,this.props,this.state)&&(this.setState({isLoading:!0,isLoadFailed:!1}),this._loadDims())}render(){const{caption:t,isShow:s,onShow:e,onFront:i}=this.props,{chartType:o,isToolbar:a,isOptions:n,isToggle:r,isShowLabels:h,isLoading:l,isLoadFailed:c,isShowChart:p,isShowDate:d,dateDefault:g,dateOptions:u,configs:m,chartOptions:_,validationMessages:S}=this.state,f=c?{...q.SPINNER_LOADING,...q.SPINNER_FAILED}:q.SPINNER_LOADING;return(0,F.jsxs)(O.Z.DraggableDialog,{isShow:s,caption:t,menuModel:this._menuMore,commandButtons:this._commandButtons,onShowChart:e,onFront:i,onClose:this._handleClose,children:[(0,F.jsx)(O.Z.Toolbar,{isShow:a,buttons:this.toolbarButtons}),(0,F.jsx)(O.Z.ModalOptions,{isShow:n,toggleOption:this._toggleOptionWithToolbar,onClose:this._hideOptionsWithToolbar}),(0,F.jsx)(O.Z.ModalToggle,{isShow:r,selectProps:m,isShowChart:p,isShowDate:d,crIsId:k,onToggle:this._toggleStateBy,onCheckCaption:this._checkCaptionBy,onUnCheckCaption:this._uncheckCaption,onClose:this._hideToggleWithToolbar}),(l||c)&&(0,F.jsx)(M.Z,{style:f}),!l&&!c&&this._renderSelectInputs(),(0,F.jsx)(O.Z.RowChartDate,{chartType:o,isShowLabels:h,isShowChart:p,chartOptions:_,onSelectChart:this._hSelectChartType,onRegColor:this._onRegColor,isShowDate:d,dateDefault:g,dateOptions:u,onSelecDate:this._hSelectDate}),(0,F.jsx)(O.Z.ValidationMessages,{validationMessages:S})]})}})||L}}}]);