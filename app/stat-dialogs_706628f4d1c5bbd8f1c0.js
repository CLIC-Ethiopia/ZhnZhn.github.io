(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{2794:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>re});var o=s(9679),n=s(9468),a=s(4706),i=s(2554),r=s(8804),c=s(2812);const u=e=>"is"+e+"Select";var l=s(5893);const d=(e,t,{isShowLabels:s,isRow:o,fSelect:n})=>{const{id:a,caption:i,options:r}=e,d=!o[u(a)];return(0,l.jsx)(c.Z.ShowHide,{isShow:d,children:(0,l.jsx)(c.Z.RowInputSelect,{isShowLabels:s,caption:i,options:r,onSelect:n(t)})},a)};var p=s(1926);const h=e=>{const t=(0,o.useRef)(e),s=(0,o.useCallback)((e=>{t.current=e}),[]);return[t,s]},m=(e,t,s)=>({caption:e,title:t,onClick:s}),f=(e,t,s,n)=>{const[a,i]=(0,p.Z)(!0),r=(0,o.useMemo)((()=>[m("L","Click to toggle input labels",e),m("T","Toggle Inputs",t),m("O","Chart Options",s),m("A","About Datasource",n)]),[]);return[(0,o.useMemo)((()=>(0,l.jsx)(c.Z.Toolbar,{isShow:a,buttons:r})),[a]),i]},g="row__pane-topic not-selected",C=(e,t,s=!0)=>({cn:g,onClick:t,name:e,isClose:s}),S=(e,t)=>(0,o.useMemo)((()=>({titleCl:g,pageWidth:175,maxPages:1,p0:[C("Toggle ToolBar",e),C("About Datasource",t)]})),[]),w=e=>{const[t,s]=(0,o.useState)(e);return[t,(0,o.useCallback)((()=>s((e=>!e))),[]),(0,o.useCallback)((()=>s(!1)),[])]},b=()=>{const e=(0,o.useRef)({}),[t,s,n]=w(!1),a=(0,o.useCallback)((t=>{e.current[t]=!e.current[t]}),[]);return[(0,o.useMemo)((()=>(0,l.jsx)(c.Z.ModalOptions,{isShow:t,toggleOption:a,onClose:n})),[t]),e,s]},y=e=>{const[t,s,n]=w(!1),[a,i]=(0,o.useState)({isShowChart:!0,isShowDate:!1}),{isShowChart:r,isShowDate:d}=a,p=(0,o.useCallback)((e=>{i((t=>(t[e]=!t[e],{...t})))}),[]),h=(0,o.useRef)([]),m=(0,o.useCallback)((e=>{h.current.push(e)}),[]),f=(0,o.useCallback)((e=>{h.current=h.current.filter((t=>t!==e))}),[]);return[(0,o.useMemo)((()=>(0,l.jsx)(c.Z.ModalToggle,{isShow:t,selectProps:e,isShowChart:r,isShowDate:d,crIsId:u,onToggle:p,onCheckCaption:m,onUnCheckCaption:f,onClose:n})),[t,e,r,d]),h,a,i,s]};const v=class{constructor(e=5e3){this.mls=e,this.isLoading=!1}start(e){return!this.isLoading&&(this.loadingUrl=e,this.isLoading=!0,this.timeoutId=setTimeout((()=>{e===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}},O="time",T="Geo Entity",x=(e,t,s)=>({caption:e,slice:{[t]:s}}),D=e=>e?e.charAt(0).toUpperCase()+e.substring(1):"",k=Object.keys,M=e=>(e||"").split("_").map(D).join(" "),I=(e,t)=>{const{label:s}=e||{};return k(s||{}).map((e=>({caption:s[e],value:e,id:t})))},L=e=>{const t=[null],s=[];return k(e).forEach((o=>{if(o!==O){const n=e[o],{label:a,category:i}=n||{},r={c:M(a),v:o,options:I(i,o)};"s_adj"===o?(r.c="Adjust",s.push(r)):"geo"===o?(r.c=T,t[0]=r):t.push(r)}})),{dims:t.filter(Boolean).concat(s),timeId:O}},F=({values:e,id:t})=>(e||[]).map((e=>x(e.text,t,e.id))),j=e=>{const t=[];let s;return e.forEach((e=>{const{time:o,text:n="",id:a}=e;o?(s=a,t.dateOptions=e.values.map((({id:e,text:t})=>({caption:t,value:e}))).reverse()):t.push({c:D(n),v:a,options:F(e)})})),{mapFrequency:"Y",dims:t,timeId:s}},Z=Array.isArray,q={month:"M",quarter:"K"},E=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],A=(e,t)=>!Z(e)||!Z(t)||e.length!==t.length,R=({values:e,valueTexts:t,code:s})=>{if(!A(e,t))return t.map(((t,o)=>x(t,s,e[o])))},_=e=>{const t=[];let s,o="Y";return e.forEach((e=>{const{code:n,time:a}=e,i=e.text||"";((e,t)=>!e&&-1===E.indexOf(t)&&-1===(t+"").indexOf("TLIST("))(a,n)?t.push({c:D(i),v:n,options:R(e)}):(s=n,o=q[i.toLowerCase()],t.dateOptions=(({values:e,valueTexts:t})=>{if(A(e,t))return;const s=[];return t.forEach(((t,o)=>{s.push({caption:t,value:e[o]})})),s.reverse()})(e))})),{mapFrequency:o,dims:t,timeId:s}},P=(e,t)=>fetch(e,t).then((e=>{const{status:t,statusText:s}=e;if(t>=200&&t<400)return e.json();if(403===t)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+t+" "+s)})),U=Array.isArray,B=e=>{const t=[],{variables:s,dimension:o,source:n}=e;return((e,t)=>e&&"Eurostat"===t)(o,n)?L(o):U(s)?(a=s[0])&&a.id&&a.text&&!U(a.valueTexts)&&U(a.values)?j(s):_(s):{dims:t,timeId:undefined,mapFrequency:"Y"};var a},W=e=>P(e).then(B),Y=(e,t,s)=>({id:e,caption:t,options:s}),H=(e,t)=>{const s=t?((e,t)=>{const s=Object.create(null);return e.forEach((e=>{s[e.v]=e})),t.map((({v:e,c:t})=>Y(e,t,s[e].options)))})(e,t):(e=>e.map((({c:e,v:t,options:s})=>Y(t,e,s))))(e);return s.dateOptions=e.dateOptions,s},V=new v,N=e=>{if(V.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const t=(e=>e.metaUrl||(({proxy:e="",baseMeta:t,dfId:s,loadId:o,mapFrequency:n})=>"EU_STAT"===o?"https://ec.europa.eu/eurostat/wdds/rest/data/v2.1/json/en/"+s+"?time="+(e=>"M"===e?"2019M01":"S"===e?"2019S1":"2019")(n):""+e+t+"/"+s)(e))(e),s=e.dims;return V.start(t),W(t).then((({dims:e,mapFrequency:t,timeId:o})=>{if(!(e=>{const t=e.length;let s=0;for(;s<t&&e[s].options;s++);return s===t})(e))throw{errMsg:"Loaded dims without options"};return{timeId:o,mapFrequency:t,configs:H(e,s)}})).catch((({errMsg:e,message:t})=>({errMsg:e||t}))).finally((()=>{V.stop()}))}},G=e=>{const t=(0,o.useRef)();return(0,o.useEffect)((()=>{t.current=e}),[e]),t.current},{crOptions:K}=a.Z,{crDateConfig:z}=c.Z,J=({dims:e,proxy:t,baseMeta:s,loadId:o,mapFrequency:n,dfProps:a},i)=>{N({dims:e,proxy:t,baseMeta:s,loadId:o,mapFrequency:n,...a}).then(i).catch((e=>{i({errMsg:e.message})}))},Q=()=>({isLoading:!0,isLoadFailed:!1}),X=e=>e.map((e=>e.options)),$=e=>e.map((e=>({caption:e.caption,value:e.id}))),ee=e=>{const{chartsType:t,mapFrequency:s,mapDateDf:n,dfProps:a={}}=e,i=a.mapFrequency||s||"M",r=a.mapDateDf||n,[{isLoading:c,isLoadFailed:u},l]=(0,o.useState)(Q),[d,p]=(0,o.useState)([]),[h,m]=(0,o.useState)((()=>({configs:[],selectOptions:[],mapFrequency:s,chartOptions:K(e),dateOptions:[]}))),f=(0,o.useCallback)((({configs:e,timeId:s,mapFrequency:o,errMsg:n})=>{if(e){const n=o||i,[a,c]=((e,t,s)=>{const{dateOptions:o}=e;if(o)return[o,o[0]];const{dateOptions:n,dateDefault:a}=z(t,s);return[n,{caption:a,value:a}]})(e,n,r);l({isLoading:!1,isLoadFailed:!1}),m({timeId:s,configs:e,selectOptions:X(e),mapFrequency:n,dimOptions:$(e),chartOptions:K({configs:e,chartsType:t}),dateOptions:a,dateDf:c})}else l({isLoading:!1,isLoadFailed:!0}),p([n])}),[t,i,r]),g=((e,t)=>{const s=G(e);return t&&!s.isShow&&e.isShow})(e,u);return(0,o.useEffect)((()=>{J(e,f)}),[]),(0,o.useEffect)((()=>{g&&(J(e,f),l(Q))}),[g,e,f]),[h,c,u,d,p,m]},te=e=>(0,o.useMemo)((()=>[(0,l.jsx)(c.Z.Button.Load,{onClick:e},"load")]),[e]),se={margin:"16px auto 32px"},oe={borderColor:"#f44336",animation:"none"},{isCategory:ne}=a.Z,ae=n.Z.wideWidth(),ie=(e,t)=>e.isShow===t.isShow,re={StatN:(0,o.memo)((e=>{const{isShow:t,caption:s,onShow:n,onFront:a,loadFn:u,onLoad:m,msgOnNotSelected:g,onClickInfo:C,onClose:w}=e,v=!e.dims&&!e.notDim,O=(0,o.useRef)([]),x=(0,o.useCallback)((e=>t=>{O.current[e]=t?{...t}:void 0}),[]),[D,k]=h(),[M,I]=h(),[L,F]=h(),[j,Z,q,E,A,R]=ee(e),{configs:_,selectOptions:P,chartType:U,chartOptions:B,dimOptions:W,dateOptions:Y,dateDf:H={},timeId:V}=j,[N,G]=(0,p.Z)(ae),[K,z,J]=b(),[Q,X,$,ie,re]=y(_),{isShowDate:ce,isShowChart:ue}=$,[le,de]=f(G,re,J,C),pe=(0,o.useCallback)((()=>{w(),A([])}),[]),he=(0,o.useCallback)((()=>{const t=[];if(q)return t.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."),t;if(Z)return t.push("Dims is loading"),t;const s=ne(U),{dim:o}=U||{},n=((e,t,s,o)=>n=>{s.forEach(((s,a)=>{const{caption:i}=s;n(i)&&!o[a]&&e.push(t(i))}))})(t,g,_,O.current);if(!v||!s){const a=e.notDim?T:o;return n((e=>!(s&&e===a))),t}if(s){const e=L.current;if(!e)return t.push("Dim isn't selected"),t;n((t=>t!==e.caption))}return t}),[q,Z,_,U,g]),me=(0,o.useCallback)((e=>{let t=!1;ne(e)&&(M.current=null,t=!0),ie((e=>(e.isShowDate=t,{...e}))),R((t=>({...t,chartType:e})))}),[]),fe=(0,o.useCallback)((()=>{const t=he();if(0===t.length){const{seriaColor:t,seriaWidth:s}=D.current?D.current.getConf():{},o=((e,t)=>{const{dfC:s}=e;return s||(t||{}).value})(e,L.current),n=((e,t)=>e.dfC||!t?"":t.caption||"")(e,L.current),a=u({...e},{timeId:V,dfC:o,dfTitle:n,time:(M.current||H).value,dialogOptions:z.current,chartType:U,seriaColor:t,seriaWidth:s,items:O.current,titles:X.current,selectOptions:P});m(a)}A(t)}),[he,H,V,U,_,P]),ge=te(fe),Ce=S(de,C),Se=((e,t)=>e?se:t?{...se,...oe}:void 0)(Z,q);return(0,l.jsxs)(c.Z.DraggableDialog,{isShow:t,caption:s,menuModel:Ce,commandButtons:ge,onShowChart:n,onFront:a,onClose:pe,children:[le,K,Q,Se?(0,l.jsx)(i.Z,{style:Se}):(0,l.jsx)(r.Z,{items:_,crItem:d,isShowLabels:N,isRow:$,fSelect:x}),(0,l.jsx)(c.Z.RowChartDate,{chartType:U,isShowLabels:N,isShowChart:ue,chartOptions:B,onSelectChart:me,onRegColor:k,isShowDate:ce,dateDefault:H.caption,dateOptions:Y,onSelecDate:I,isDim:v,dimOptions:W,onSelecDim:F}),(0,l.jsx)(c.Z.ValidationMessages,{validationMessages:E})]})}),ie)}}}]);