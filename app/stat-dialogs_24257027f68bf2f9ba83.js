"use strict";(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{6196:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Ie});var s=o(9679),n=o(9468),r=o(4706),i=o(8804),a=o(4827);var c=o(5893);const l={position:"absolute",top:80,left:"45%",zIndex:10,display:"block",width:32,height:32,opacity:1,transition:"opacity 800ms ease-out"},u={borderColor:"#f44336",animation:"none"},d={opacity:0},p=e=>{let{style:t,status:o}=e;const n=(e=>{const[t,o]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{e||setTimeout((()=>o(!0)),1e3)}),[e]),t})(o),r="L"===o?l:"F"===o?u:d;return n?null:(0,c.jsx)("span",{style:{...l,...t,...r},"data-loader":"circle"})},h=e=>"is"+e+"Select",m=(e,t,o)=>{let{isShowLabels:s,isRow:n,fSelect:r}=o;const{id:i,caption:l,options:u,placeholder:d}=e,p=!n[h(i)];return(0,c.jsx)(a.Z.ShowHide,{isShow:p,children:(0,c.jsx)(a.Z.RowInputSelect,{isShowLabels:s,caption:l,placeholder:d,options:u,onSelect:r(t)})},i)};var f=o(1926),g=o(7753);const C=()=>{const e=(0,s.useRef)([]),t=(0,s.useCallback)((t=>o=>{e.current[t]=o?{...o}:void 0}),[]);return[e,t]},w=(e,t,o)=>({caption:e,title:t,onClick:o}),S=(e,t,o,n)=>{const[r,i]=(0,f.Z)(!0),l=(0,s.useMemo)((()=>[w("L","Click to toggle input labels",e),w("T","Toggle Inputs",t),w("O","Chart Options",o),w("A","About Datasource",n)]),[]);return[(0,s.useMemo)((()=>(0,c.jsx)(a.Z.Toolbar,{isShow:r,buttons:l})),[r]),i]},y="row__pane-topic not-selected",b=function(e,t,o){return void 0===o&&(o=!0),{cn:y,onClick:t,name:e,isClose:o}},v=(e,t)=>(0,s.useMemo)((()=>({titleCl:y,pageWidth:175,maxPages:1,p0:[b("Toggle ToolBar",e),b("About Datasource",t)]})),[]),O=e=>{const[t,o]=(0,s.useState)(e);return[t,(0,s.useCallback)((()=>o((e=>!e))),[]),(0,s.useCallback)((()=>o(!1)),[])]},I=()=>{const e=(0,s.useRef)({}),[t,o,n]=O(!1),r=(0,s.useCallback)((t=>{e.current[t]=!e.current[t]}),[]);return[(0,s.useMemo)((()=>(0,c.jsx)(a.Z.ModalOptions,{isShow:t,toggleOption:r,onClose:n})),[t]),e,o]},T=e=>{const[t,o]=(0,s.useState)({isShowChart:!0,isShowDate:!1}),n=(0,s.useCallback)((e=>{o((t=>(t[e]=!t[e],{...t})))}),[]);return(0,s.useEffect)((()=>{const t={};let s=!1;e.forEach((e=>{e.dfItem&&(s=!0,t[h(e.id)]=!0)})),o((e=>s?{...e,...t}:e))}),[e]),[t,o,n]},D=function(e){void 0===e&&(e=[]);const t=(0,s.useRef)(e),o=(0,s.useCallback)((e=>{t.current.push(e)}),[]),n=(0,s.useCallback)((e=>{t.current=t.current.filter((t=>t!==e))}),[]);return[t,o,n]},x=e=>{const[t,o,n]=O(!1),[r,i,l]=T(e),{isShowChart:u,isShowDate:d}=r,[p,m,f]=D();return[(0,s.useMemo)((()=>(0,c.jsx)(a.Z.ModalToggle,{isShow:t,selectProps:e,isShowChart:u,isShowDate:d,crIsId:h,onToggle:l,onCheckCaption:m,onUnCheckCaption:f,onClose:n})),[t,e,u,d]),p,r,i,o]};const F=class{constructor(e){void 0===e&&(e=5e3),this.mls=e,this.isLoading=!1}start(e){return!this.isLoading&&(this.loadingUrl=e,this.isLoading=!0,this.timeoutId=setTimeout((()=>{e===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}},k="time",M="Geo Entity",L=(e,t,o)=>({caption:e,slice:{[t]:o}}),j=e=>e?e.charAt(0).toUpperCase()+e.substring(1):"",E=Object.keys,q=e=>(e||"").split("_").map(j).join(" "),Z=(e,t)=>{const{label:o}=e||{};return E(o||{}).map((e=>({caption:o[e],value:e,id:t})))},A=e=>{const t=[null],o=[];return E(e).forEach((s=>{if(s!==k){const n=e[s],{label:r,category:i}=n||{},a={c:q(r),v:s,options:Z(i,s)};"s_adj"===s?(a.c="Seasonal Adjustment",a.options=(e=>e.options.map((e=>(e.sc=e.value,e.caption=e.caption+" ("+e.value+")",e))))(a),o.push(a)):"geo"===s?(a.c=M,t[0]=a):t.push(a)}})),{dims:t.filter(Boolean).concat(o),timeId:k}},P=e=>{let{values:t,id:o}=e;return(t||[]).map((e=>L(e.text,o,e.id)))},R=e=>{const t=[];let o;return e.forEach((e=>{const{time:s,text:n="",id:r}=e;s?(o=r,t.dateOptions=e.values.map((e=>{let{id:t,text:o}=e;return{caption:o,value:t}})).reverse()):t.push({c:j(n),v:r,options:P(e)})})),{mapFrequency:"Y",dims:t,timeId:o}},_=Array.isArray,U={month:"M",quarter:"K"},B=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],Q=(e,t)=>!_(e)||!_(t)||e.length!==t.length,W=e=>{let{values:t,valueTexts:o,code:s}=e;if(!Q(t,o))return o.map(((e,o)=>L(e,s,t[o])))},Y=e=>{const t=[];let o,s="Y";return e.forEach((e=>{const{code:n,time:r}=e,i=e.text||"";((e,t)=>!e&&-1===B.indexOf(t)&&-1===(t+"").indexOf("TLIST("))(r,n)?t.push({c:j(i),v:n,options:W(e)}):(o=n,s=U[i.toLowerCase()],t.dateOptions=(e=>{let{values:t,valueTexts:o}=e;if(Q(t,o))return;const s=[];return o.forEach(((e,o)=>{s.push({caption:e,value:t[o]})})),s.reverse()})(e))})),{mapFrequency:s,dims:t,timeId:o}},H=(e,t)=>fetch(e,t).then((e=>{const{status:t,statusText:o}=e;if(t>=200&&t<400)return e.json();if(403===t)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+t+" "+o)})),N=Array.isArray,V=e=>{const t=[],{variables:o,dimension:s,source:n}=e;return((e,t)=>e&&"Eurostat"===t)(s,n)?A(s):N(o)?(r=o[0])&&r.id&&r.text&&!N(r.valueTexts)&&N(r.values)?R(o):Y(o):{dims:t,timeId:undefined,mapFrequency:"Y"};var r},z=e=>H(e).then(V),G=e=>"M"===e?"2019M01":"S"===e?"2019S1":"Q"===e?"2019Q1":"2019",K=(e,t)=>{let{dfNonTime:o,mapFrequency:s,dfId:n}=e;const r=[t,o?"":"time="+G(s)].filter(Boolean).join("&");return"https://ec.europa.eu/eurostat/wdds/rest/data/v2.1/json/en/"+n+(r?"?"+r:"")},J={DF:e=>{let{proxy:t="",baseMeta:o,dfId:s}=e;return""+t+o+"/"+s},EU_STAT:K},X=e=>e.dimUrl||(e=>(J[e.loadId]||J.DF)(e))(e),$=(e,t,o)=>({id:e,caption:t,options:o}),ee=(e,t)=>{const o=t?((e,t)=>{const o=Object.create(null);return e.forEach((e=>{o[e.v]=e})),t.map((e=>{let{v:t,c:s}=e;return $(t,s,o[t].options)}))})(e,t):(e=>e.map((e=>{let{c:t,v:o,options:s}=e;return $(o,t,s)})))(e);return o.dateOptions=e.dateOptions,(e=>{e.forEach(((e,t)=>{const{options:o}=e;if(1===o.length){const t=o[0];e.placeholder=t.caption,e.dfItem=t,e.isRow=!1}}))})(o),o},te=(e,t)=>{const o=X(t),s=t.dims;return e.start(o),z(o).then((e=>{let{dims:t,mapFrequency:o,timeId:n}=e;if(!(e=>{const t=e.length;let o=0;for(;o<t&&e[o].options;o++);return o===t})(t))throw{errMsg:"Loaded dims without options"};return{timeId:n,mapFrequency:o,configs:ee(t,s)}}))},oe=e=>(e.options||[]).length,se=(e,t)=>{const{dfQ:o}=t,s=K(t,o[0]),n=K(t,o[1]);let r=[];return e.start(s),z(s).then((e=>{let{dims:t}=e;r=r.concat(t)})).then((()=>{return e=5e3,new Promise((t=>{setTimeout((()=>t()),e)}));var e})).then((()=>(e.stop(),e.start(n),z(n)))).then((e=>{let{dims:t,mapFrequency:o,timeId:s}=e;return r=(e=>{const t=Object.create(null);return e.forEach((e=>{const o=e.v,s=t[o];(!s||oe(s)<oe(e))&&(t[o]=e)})),Object.keys(t).map((e=>t[e]))})(r.concat(t)),{timeId:"time",mapFrequency:o,configs:ee(r)}}))},ne=Array.isArray,re=new F,ie=e=>{let{errMsg:t,message:o}=e;return{errMsg:t||o}},ae=e=>{if(re.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const t=(e=>{const{dfQ:t}=e;return ne(t)?2===t.length?se:void 0:te})(e);return t?t(re,e).catch(ie).finally((()=>re.stop())):Promise.resolve({errMsg:"Incorrect dialog configuration"})}},ce=e=>{const t=(0,s.useRef)();return(0,s.useEffect)((()=>{t.current=e}),[e]),t.current},{crOptions:le}=r.Z,{crDateConfig:ue}=a.Z,de=(e,t)=>({caption:e,value:t}),pe=(e,t)=>{let{dims:o,proxy:s,baseMeta:n,loadId:r,mapFrequency:i,dfProps:a}=e;ae({dims:o,proxy:s,baseMeta:n,loadId:r,mapFrequency:i,...a}).then(t).catch((e=>{t({errMsg:e.message})}))},he=()=>({isLoading:!0,isLoadFailed:!1}),me=e=>e.map((e=>e.options)),fe=e=>{const t=[];return e.forEach((e=>{(e.options||[]).length>1&&t.push(de(e.caption,e.id))})),t},ge=e=>{const{chartsType:t,mapFrequency:o,mapDateDf:n,dfProps:r={}}=e,i=r.mapFrequency||o||"M",a=r.mapDateDf||n,[{isLoading:c,isLoadFailed:l},u]=(0,s.useState)(he),[d,p]=(0,s.useState)([]),[h,m]=(0,s.useState)((()=>({configs:[],selectOptions:[],mapFrequency:o,chartOptions:le(e),dateOptions:[]}))),f=(0,s.useCallback)((e=>{let{configs:o,timeId:s,mapFrequency:n,errMsg:r}=e;if(o){const e=n||i,[r,c]=((e,t,o)=>{const{dateOptions:s}=e;if(s)return[s,s[0]];const{dateOptions:n,dateDefault:r}=ue(t,o);return[n,de(r,r)]})(o,e,a);u({isLoading:!1,isLoadFailed:!1}),m({timeId:s,configs:o,selectOptions:me(o),mapFrequency:e,dimOptions:fe(o),chartOptions:le({configs:o,chartsType:t,mapFrequency:e}),dateOptions:r,dateDf:c})}else u({isLoading:!1,isLoadFailed:!0}),p([r])}),[t,i,a]),g=((e,t)=>{const o=ce(e);return t&&!o.isShow&&e.isShow})(e,l);return(0,s.useEffect)((()=>{pe(e,f)}),[]),(0,s.useEffect)((()=>{g&&(pe(e,f),u(he))}),[g,e,f]),[h,c,l,d,p,m]},Ce=e=>(0,s.useMemo)((()=>[(0,c.jsx)(a.Z.Button.Load,{onClick:e},"load")]),[e]),we=(e,t,o)=>{e((e=>e[t]!==o?(e[t]=o,{...e}):e))},Se=(e,t)=>e?"L":t?"F":void 0,ye={height:50,width:"100%"},{isCategory:be}=r.Z,ve=n.Z.wideWidth(),Oe=(e,t)=>e.isShow===t.isShow,Ie={StatN:(0,s.memo)((e=>{const{isShow:t,caption:o,onShow:n,onFront:r,loadFn:l,onLoad:u,msgOnNotSelected:d,onClickInfo:h,onClose:w}=e,y=!e.dims&&!e.notDim,[b,O]=C(),[T,D]=(0,g.Z)(),[F,k]=(0,g.Z)(),[L,j]=(0,g.Z)(),[E,q,Z,A,P,R]=ge(e),{configs:_,selectOptions:U,chartType:B,chartOptions:Q,dimOptions:W,dateOptions:Y,dateDf:H={},timeId:N}=E,[V,z]=(0,f.Z)(ve),[G,K,J]=I(),[X,$,ee,te,oe]=x(_),{isShowDate:se,isShowChart:ne}=ee,[re,ie]=S(z,oe,J,h),ae=(0,s.useCallback)((()=>{w(),P([])}),[]),ce=(0,s.useCallback)((()=>{const t=[];if(Z)return t.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."),t;if(q)return t.push("Dims is loading"),t;const o=be(B),{dim:s}=B||{},n=((e,t,o,s)=>n=>{o.forEach(((o,r)=>{const{caption:i}=o;n(i)&&!s[r]&&e.push(t(i))}))})(t,d,_,b.current);if(!y||!o){const r=e.notDim?M:s;return n((e=>!(o&&e===r))),t}if(o){const e=L.current;if(!e)return t.push("Dim isn't selected"),t;n((t=>t!==e.caption))}return t}),[Z,q,_,B,d]),le=(0,s.useCallback)((e=>{const t=!!be(e)&&(F.current=null,!0);we(te,"isShowDate",t),we(R,"chartType",e)}),[]),ue=(0,s.useCallback)((()=>{((e,t)=>{e.forEach(((e,o)=>{const{dfItem:s}=e;s&&t(o)(s)}))})(_,O);const t=ce();if(0===t.length){const{seriaColor:t,seriaWidth:o}=T.current?T.current.getConf():{},s=((e,t)=>e.dfC||(t||{}).value)(e,L.current),n=((e,t)=>e.dfC||!t?"":t.caption||"")(e,L.current),r=l({...e},{timeId:N,dfC:s,dfTitle:n,time:(F.current||H).value,dialogOptions:K.current,chartType:B,seriaColor:t,seriaWidth:o,items:b.current,titles:$.current,selectOptions:U});u(r)}P(t)}),[ce,H,N,B,_,U]),de=Ce(ue),pe=v(ie,h),he=Se(q,Z);return(0,c.jsxs)(a.Z.DraggableDialog,{isShow:t,caption:o,menuModel:pe,commandButtons:de,onShowChart:n,onFront:r,onClose:ae,children:[re,G,X,(0,c.jsx)(p,{status:he}),he?(0,c.jsx)("div",{style:ye}):(0,c.jsx)(i.Z,{items:_,crItem:m,isShowLabels:V,isRow:ee,fSelect:O}),(0,c.jsx)(a.Z.RowChartDate,{chartType:B,isShowLabels:V,isShowChart:ne,chartOptions:Q,onSelectChart:le,onRegColor:D,isShowDate:se,dateDefault:H.caption,dateOptions:Y,onSelecDate:k,isDim:y,dimOptions:W,onSelecDim:j}),(0,c.jsx)(a.Z.ValidationMessages,{validationMessages:A})]})}),Oe)}}}]);