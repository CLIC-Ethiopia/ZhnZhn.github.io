(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{1625:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>B});var n=o(7154),i=o.n(n),s=o(1506),a=o.n(s),r=o(5354),c=o.n(r),l=o(5893),u=o(9679);const h=function(){function t(t){void 0===t&&(t=5e3),this.mls=t,this.isLoading=!1}var e=t.prototype;return e.start=function(t){var e=this;return!this.isLoading&&(this.loadingUrl=t,this.isLoading=!0,this.timeoutId=setTimeout((function(){t===e.loadingUrl&&(e.isLoading=!1)}),this.mls),!0)},e.stop=function(){this.isLoading=!1,clearTimeout(this.timeoutId)},t}();var d=o(9546),p=o.n(d);const f=function(t,e){return fetch(t,e).then((function(t){var e=t.status,o=t.statusText;if(e>=200&&e<400)return t.json();if(403===e)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+e+" "+o)}))};var g={selection:{filter:"all",values:["*"]}},m={code:"Tid",selection:{filter:"top",values:["1"]}},v=function(t,e){var o=t.map((function(t){return e=t.v,i()({code:e},g);var e}));return e||o.push(m),{method:"POST",body:JSON.stringify({query:o,response:{format:"json-stat"}})}},_=function(t,e){for(var o=[],n=e.v,i=t.Dimension(n),s=i.length,a=0;a<s;a++){var r;o.push({caption:i.Category(a).label,slice:(r={},r[n]=i.id[a],r)})}return o},S=new h;const C=function(t){var e=t.metaUrl,o=t.dims,n=void 0===o?[]:o,i=t.noTime,s=t.timeId;if(S.isLoading)return Promise.resolve({errMsg:"Another dims are still loading"});var a=v(n,i);return S.start(e),f(e,a).then((function(t){var e=function(t,e,o){var n=p()(t).Dataset(0);return e.map((function(t){return{id:t.v,caption:t.c,options:_(n,t)}})).filter(function(t){return function(e){return e.id!==t}}(o))}(t,n,s);return S.stop(),{configs:e}})).catch((function(t){return S.stop(),{errMsg:t.message}}))};var y=Array.isArray,T=function(t){var e=t.values,o=t.valueTexts,n=t.code;if(y(e)&&y(o)&&e.length===o.length){for(var i=[],s=0;s<o.length;s++){var a;i.push({caption:o[s],slice:(a={},a[n]=e[s],a)})}return i}},w=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],D={month:"M",quarter:"K"},b=function(t){var e,o=[],n=t.variables,i="Y";return(void 0===n?[]:n).forEach((function(t){var n,s=t.code,a=t.time,r=t.text||"";a||-1!==w.indexOf(s)?(e=s,i=D[r.toLowerCase()]):o.push({c:(n=r,n.charAt(0).toUpperCase()+n.substring(1)),v:s,options:T(t)})})),{mapFrequency:i,dims:o,timeId:e}};const L=function(t){return f(t).then(b)};var I=function(t){return t.map((function(t){var e=t.c;return{id:t.v,caption:e,options:t.options}}))},M=new h;const O=function(t){if(M.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});var e=function(t){return t.metaUrl||""+(void 0===(o=(e=t).proxy)?"":o)+e.baseMeta+"/"+e.dfId;var e,o}(t);return t.dims?C(i()({metaUrl:e},t)):(M.start(e),L(e).then((function(o){var n=o.dims,i=o.mapFrequency,s=o.timeId;return M.stop(),function(t){for(var e=t.length,o=0;o<e&&t[o].options;o++);return o===e}(n)?{timeId:s,mapFrequency:i,configs:I(n)}:C({noTime:t.noTime,metaUrl:e,dims:n,mapFrequency:i,timeId:s})})).catch((function(t){var e=t.errMsg,o=t.message;return M.stop(),{errMsg:e||o}})))};var F,x=o(7728),N=o(2554),q=o(82),P=q.Z.Decor,Z=q.Z.crMenuMore,j=q.Z.crDateConfig,k={SPINNER_LOADING:{margin:"16px auto 32px"},SPINNER_FAILED:{borderColor:"#f44336",animation:"none"}},A=x.Z.isCategory,E=x.Z.crOptions,W=function(t){return"is"+t+"Select"};const B={StatN:(0,P.dialog)(F=function(t){function e(e){var o;return(o=t.call(this,e)||this)._toggleStateBy=function(t){o.setState((function(e){var o;return(o={})[t]=!e[t],o}))},o._checkCaptionBy=function(t){o._titles.push(t)},o._uncheckCaption=function(t){o._titles=o._titles.filter((function(e){return e!==t}))},o._setConfigs=function(t){var e=t.configs,n=t.timeId,i=t.mapFrequency,s=t.errMsg;if(e){var a=o.props,r=a.chartsType,c=a.mapFrequency;o.setState({isLoading:!1,isLoadFailed:!1,timeId:n,configs:e,mapFrequency:i||c,selectOptions:e.map((function(t){return t.options})),chartOptions:E({configs:e,chartsType:r})})}else o.setState({isLoading:!1,isLoadFailed:!0,validationMessages:[s]})},o._loadDims=function(){var t=o.props,e=t.dims,n=t.proxy,s=t.baseMeta,a=t.dfProps;O(i()({dims:e,proxy:n,baseMeta:s},a)).then(o._setConfigs).catch((function(t){o._setConfigs({errMsg:t.message})}))},o._updateForDate=function(t){o.date=null;var e=o.props.mapDateDf,n=o.state.mapFrequency,s=j(n||"M",e);o.setState(i()({isShowDate:!0},s,{chartType:t}))},o._handleLoad=function(){var t=o._crValidationMessages();if(0===t.length){var e=a()(o),n=e._items,s=e.dialogOptions,r=e.colorComp,c=e.date,l=o.state,u=l.timeId,h=l.chartType,d=l.selectOptions,p=r?r.getConf():{},f=p.seriaColor,g=p.seriaWidth,m=o.state.dateDefault,v=i()({},o.props,{timeId:u}),_=o.props.loadFn(v,{dialogOptions:s,chartType:h,seriaColor:f,seriaWidth:g,date:c,dateDefault:m,items:n,titles:o._titles,selectOptions:d});o.props.onLoad(_)}o.setState({validationMessages:t})},o._crValidationMessages=function(){var t=[],e=o.state,n=e.configs,i=e.isLoadFailed,s=e.chartType,a=void 0===s?{}:s,r=A(a),c=a.dim;return i?t.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."):n.forEach((function(e,n){var i=e.caption;r&&i===c||o._items[n]||t.push(o.props.msgOnNotSelected(i))})),t},o._handleClose=function(){o._handleWithValidationClose()},o._hSelectChartType=function(t){A(t)?o._updateForDate(t):o.setState({chartType:t,isShowDate:!1})},o._onRegColor=function(t){o.colorComp=t},o._fSelect=function(t){return function(e){this._items[t]=e}},o._hSelectDate=function(t){o.date=t},o._renderSelectInputs=function(){var t=o.state,e=t.isShowLabels;return t.configs.map((function(t,n){var i=t.id,s=t.caption,r=t.options,c=!o.state[W(i)];return(0,l.jsx)(q.Z.ShowHide,{isShow:c,children:(0,l.jsx)(q.Z.RowInputSelect,{isShowLabels:e,caption:s,options:r,onSelect:o._fSelect(n).bind(a()(o))})},i)}))},o._menuMore=Z(a()(o),{toggleToolBar:o._toggleWithToolbar,onAbout:o._clickInfoWithToolbar}),o.toolbarButtons=o._createType2WithToolbar(e,{noDate:!0,isOptions:!0,isToggle:!0}),o._commandButtons=o._crCommandsWithLoad(a()(o)),o._items=[],o._titles=[],o.state=i()({},o._isWithInitialState(),{isLoading:!0,isLoadFailed:!1,isShowChart:!0,isShowDate:!1},j("EMPTY"),{isOptions:!1,isToggle:!1,configs:[],selectOptions:[],mapFrequency:e.mapFrequency,chartOptions:E(e)}),o}c()(e,t);var o=e.prototype;return o.shouldComponentUpdate=function(t,e){return this.props===t||this.props.isShow!==t.isShow},o.componentDidMount=function(){this._loadDims()},o.componentDidUpdate=function(t){(function(t,e,o){return e!==t&&!t.isShow&&e.isShow&&o.isLoadFailed})(t,this.props,this.state)&&(this.setState({isLoading:!0,isLoadFailed:!1}),this._loadDims())},o.render=function(){var t=this.props,e=t.caption,o=t.isShow,n=t.onShow,s=t.onFront,a=this.state,r=a.chartType,c=a.isToolbar,u=a.isOptions,h=a.isToggle,d=a.isShowLabels,p=a.isLoading,f=a.isLoadFailed,g=a.isShowChart,m=a.isShowDate,v=a.dateDefault,_=a.dateOptions,S=a.configs,C=a.chartOptions,y=a.validationMessages,T=f?i()({},k.SPINNER_LOADING,k.SPINNER_FAILED):k.SPINNER_LOADING;return(0,l.jsxs)(q.Z.DraggableDialog,{isShow:o,caption:e,menuModel:this._menuMore,commandButtons:this._commandButtons,onShowChart:n,onFront:s,onClose:this._handleClose,children:[(0,l.jsx)(q.Z.Toolbar,{isShow:c,buttons:this.toolbarButtons}),(0,l.jsx)(q.Z.ModalOptions,{isShow:u,toggleOption:this._toggleOptionWithToolbar,onClose:this._hideOptionsWithToolbar}),(0,l.jsx)(q.Z.ModalToggle,{isShow:h,selectProps:S,isShowChart:g,isShowDate:m,crIsId:W,onToggle:this._toggleStateBy,onCheckCaption:this._checkCaptionBy,onUnCheckCaption:this._uncheckCaption,onClose:this._hideToggleWithToolbar}),(p||f)&&(0,l.jsx)(N.Z,{style:T}),!p&&!f&&this._renderSelectInputs(),(0,l.jsx)(q.Z.RowChartDate,{chartType:r,isShowLabels:d,isShowChart:g,chartOptions:C,onSelectChart:this._hSelectChartType,onRegColor:this._onRegColor,isShowDate:m,dateDefault:v,dateOptions:_,onSelecDate:this._hSelectDate}),(0,l.jsx)(q.Z.ValidationMessages,{validationMessages:y})]})},e}(u.Component))||F}}}]);