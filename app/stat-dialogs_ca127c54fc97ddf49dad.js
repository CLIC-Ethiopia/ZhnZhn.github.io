(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{1625:(t,s,e)=>{"use strict";e.r(s),e.d(s,{default:()=>E});var i=e(9679);const o=class{constructor(t=5e3){this.mls=t,this.isLoading=!1}start(t){return!this.isLoading&&(this.loadingUrl=t,this.isLoading=!0,this.timeoutId=setTimeout((()=>{t===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}};var a=e(9546),n=e.n(a);const r=(t,s)=>fetch(t,s).then((t=>{const{status:s,statusText:e}=t;if(s>=200&&s<400)return t.json();if(403===s)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+s+" "+e)})),h={selection:{filter:"all",values:["*"]}},l={code:"Tid",selection:{filter:"top",values:["1"]}},c=(t,s)=>{const e=t.map((t=>({code:t.v,...h})));return s||e.push(l),{method:"POST",body:JSON.stringify({query:e,response:{format:"json-stat"}})}},d=(t,s)=>{const e=[],i=s.v,o=t.Dimension(i),a=o.length;let n=0;for(;n<a;n++)e.push({caption:o.Category(n).label,slice:{[i]:o.id[n]}});return e},p=new o,g=({metaUrl:t,dims:s=[],noTime:e,timeId:i})=>{if(p.isLoading)return Promise.resolve({errMsg:"Another dims are still loading"});{const o=c(s,e);return p.start(t),r(t,o).then((t=>{const e=((t,s,e)=>{const i=n()(t).Dataset(0);return s.map((t=>({id:t.v,caption:t.c,options:d(i,t)}))).filter((t=>s=>s.id!==t)(e))})(t,s,i);return p.stop(),{configs:e}})).catch((t=>(p.stop(),{errMsg:t.message})))}},u=Array.isArray,m=t=>t.charAt(0).toUpperCase()+t.substring(1),S=(t,s,e)=>({caption:t,slice:{[s]:e}}),_=({values:t,valueTexts:s,code:e})=>{if(u(t)&&u(s)&&t.length===s.length)return s.map(((s,i)=>S(s,e,t[i])))},f=({values:t,id:s})=>(t||[]).map((t=>S(t.text,s,t.id))),C=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],T={month:"M",quarter:"K"},y=t=>{const s=[],{variables:e}=t;let i,o="Y";return(e||[]).forEach((t=>{const{code:e,time:a}=t,n=t.text||"";((t,s,e)=>!t&&s&&e.id&&!u(e.valueTexts)&&u(e.values))(a,n,t)?s.push({c:m(n),v:t.id,options:f(t)}):((t,s)=>!t&&-1===C.indexOf(s)&&-1===(s+"").indexOf("TLIST("))(a,e)?s.push({c:m(n),v:e,options:_(t)}):(i=e,o=T[n.toLowerCase()])})),{mapFrequency:o,dims:s,timeId:i}},w=t=>r(t).then(y),D=t=>t.map((({c:t,v:s,options:e})=>({id:s,caption:t,options:e}))),b=new o,L=t=>{if(b.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const s=(t=>t.metaUrl||(({proxy:t="",baseMeta:s,dfId:e})=>""+t+s+"/"+e)(t))(t);return t.dims?g({metaUrl:s,...t}):(b.start(s),w(s).then((({dims:e,mapFrequency:i,timeId:o})=>(b.stop(),(t=>{const s=t.length;let e=0;for(;e<s&&t[e].options;e++);return e===s})(e)?{timeId:o,mapFrequency:i,configs:D(e)}:g({noTime:t.noTime,metaUrl:s,dims:e,mapFrequency:i,timeId:o})))).catch((({errMsg:t,message:s})=>(b.stop(),{errMsg:t||s}))))}};var I,M=e(7728),O=e(2554),v=e(2812),F=e(5893);const{Decor:x,crMenuMore:N,crDateConfig:q}=v.Z,P={SPINNER_LOADING:{margin:"16px auto 32px"},SPINNER_FAILED:{borderColor:"#f44336",animation:"none"}},{isCategory:j,crOptions:k}=M.Z,A=t=>"is"+t+"Select";const E={StatN:(0,x.dialog)(I=class extends i.Component{constructor(t){super(t),this._toggleStateBy=t=>{this.setState((s=>({[t]:!s[t]})))},this._checkCaptionBy=t=>{this._titles.push(t)},this._uncheckCaption=t=>{this._titles=this._titles.filter((s=>s!==t))},this._setConfigs=({configs:t,timeId:s,mapFrequency:e,errMsg:i})=>{if(t){const{chartsType:i,mapFrequency:o}=this.props;this.setState({isLoading:!1,isLoadFailed:!1,timeId:s,configs:t,mapFrequency:e||o,selectOptions:t.map((t=>t.options)),chartOptions:k({configs:t,chartsType:i})})}else this.setState({isLoading:!1,isLoadFailed:!0,validationMessages:[i]})},this._loadDims=()=>{const{dims:t,proxy:s,baseMeta:e,dfProps:i}=this.props;L({dims:t,proxy:s,baseMeta:e,...i}).then(this._setConfigs).catch((t=>{this._setConfigs({errMsg:t.message})}))},this._updateForDate=t=>{this.date=null;const{mapDateDf:s}=this.props,{mapFrequency:e}=this.state,i=q(e||"M",s);this.setState({isShowDate:!0,...i,chartType:t})},this._handleLoad=()=>{const t=this._crValidationMessages();if(0===t.length){const{_items:t,_titles:s,dialogOptions:e,colorComp:i,date:o}=this,{seriaColor:a,seriaWidth:n}=i?i.getConf():{},{dateDefault:r,timeId:h,chartType:l,selectOptions:c}=this.state,{loadFn:d,onLoad:p}=this.props;p(d({...this.props,timeId:h},{dialogOptions:e,chartType:l,seriaColor:a,seriaWidth:n,date:o,dateDefault:r,items:t,titles:s,selectOptions:c}))}this.setState({validationMessages:t})},this._crValidationMessages=()=>{const t=[],{configs:s,isLoadFailed:e,chartType:i={}}=this.state,o=j(i),{dim:a}=i;return e?t.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."):s.forEach(((s,e)=>{const{caption:i}=s;o&&i===a||this._items[e]||t.push(this.props.msgOnNotSelected(i))})),t},this._handleClose=()=>{this._handleWithValidationClose()},this._hSelectChartType=t=>{j(t)?this._updateForDate(t):this.setState({chartType:t,isShowDate:!1})},this._onRegColor=t=>{this.colorComp=t},this._fSelect=t=>function(s){this._items[t]={...s}},this._hSelectDate=t=>{this.date=t},this._renderSelectInputs=()=>{const{isShowLabels:t,configs:s}=this.state;return s.map(((s,e)=>{const{id:i,caption:o,options:a}=s,n=!this.state[A(i)];return(0,F.jsx)(v.Z.ShowHide,{isShow:n,children:(0,F.jsx)(v.Z.RowInputSelect,{isShowLabels:t,caption:o,options:a,onSelect:this._fSelect(e).bind(this)})},i)}))},this._menuMore=N(this,{toggleToolBar:this._toggleWithToolbar,onAbout:this._clickInfoWithToolbar}),this.toolbarButtons=this._createType2WithToolbar(t,{noDate:!0,isOptions:!0,isToggle:!0}),this._commandButtons=this._crCommandsWithLoad(this),this._items=[],this._titles=[],this.state={...this._isWithInitialState(),isLoading:!0,isLoadFailed:!1,isShowChart:!0,isShowDate:!1,...q("EMPTY"),isOptions:!1,isToggle:!1,configs:[],selectOptions:[],mapFrequency:t.mapFrequency,chartOptions:k(t)}}shouldComponentUpdate(t,s){return this.props===t||this.props.isShow!==t.isShow}componentDidMount(){this._loadDims()}componentDidUpdate(t){((t,s,e)=>s!==t&&!t.isShow&&s.isShow&&e.isLoadFailed)(t,this.props,this.state)&&(this.setState({isLoading:!0,isLoadFailed:!1}),this._loadDims())}render(){const{isShow:t,caption:s,onShow:e,onFront:i}=this.props,{chartType:o,isToolbar:a,isOptions:n,isToggle:r,isShowLabels:h,isLoading:l,isLoadFailed:c,isShowChart:d,isShowDate:p,dateDefault:g,dateOptions:u,configs:m,chartOptions:S,validationMessages:_}=this.state,f=l?P.SPINNER_LOADING:c?{...P.SPINNER_LOADING,...P.SPINNER_FAILED}:void 0;return(0,F.jsxs)(v.Z.DraggableDialog,{isShow:t,caption:s,menuModel:this._menuMore,commandButtons:this._commandButtons,onShowChart:e,onFront:i,onClose:this._handleClose,children:[(0,F.jsx)(v.Z.Toolbar,{isShow:a,buttons:this.toolbarButtons}),(0,F.jsx)(v.Z.ModalOptions,{isShow:n,toggleOption:this._toggleOptionWithToolbar,onClose:this._hideOptionsWithToolbar}),(0,F.jsx)(v.Z.ModalToggle,{isShow:r,selectProps:m,isShowChart:d,isShowDate:p,crIsId:A,onToggle:this._toggleStateBy,onCheckCaption:this._checkCaptionBy,onUnCheckCaption:this._uncheckCaption,onClose:this._hideToggleWithToolbar}),f?(0,F.jsx)(O.Z,{style:f}):this._renderSelectInputs(),(0,F.jsx)(v.Z.RowChartDate,{chartType:o,isShowLabels:h,isShowChart:d,chartOptions:S,onSelectChart:this._hSelectChartType,onRegColor:this._onRegColor,isShowDate:p,dateDefault:g,dateOptions:u,onSelecDate:this._hSelectDate}),(0,F.jsx)(v.Z.ValidationMessages,{validationMessages:_})]})}})||I}}}]);