(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{aqCK:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>U});var i=o("pVnL"),n=o.n(i),s=o("PJYZ"),a=o.n(s),r=o("VbXa"),c=o.n(r),l=o("nKUr"),u=o("EW9e");const h=function(){function t(t){void 0===t&&(t=5e3),this.mls=t,this.isLoading=!1}var e=t.prototype;return e.start=function(t){var e=this;return!this.isLoading&&(this.loadingUrl=t,this.isLoading=!0,this.timeoutId=setTimeout((function(){t===e.loadingUrl&&(e.isLoading=!1)}),this.mls),!0)},e.stop=function(){this.isLoading=!1,clearTimeout(this.timeoutId)},t}();var d=o("qaQh"),p=o.n(d);const f=function(t,e){return fetch(t,e).then((function(t){var e=t.status,o=t.statusText;if(e>=200&&e<400)return t.json();if(403===e)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+e+" "+o)}))};var g={selection:{filter:"all",values:["*"]}},m={code:"Tid",selection:{filter:"top",values:["1"]}},v=function(t,e){var o=t.map((function(t){return e=t.v,n()({code:e},g);var e}));return e||o.push(m),{method:"POST",body:JSON.stringify({query:o,response:{format:"json-stat"}})}},_=function(t,e){for(var o=[],i=e.v,n=t.Dimension(i),s=n.length,a=0;a<s;a++){var r;o.push({caption:n.Category(a).label,slice:(r={},r[i]=n.id[a],r)})}return o},S=new h;const C=function(t){var e=t.metaUrl,o=t.dims,i=void 0===o?[]:o,n=t.noTime,s=t.timeId;if(S.isLoading)return Promise.resolve({errMsg:"Another dims are still loading"});var a=v(i,n);return S.start(e),f(e,a).then((function(t){var e=function(t,e,o){var i=p()(t).Dataset(0);return e.map((function(t){return{id:t.v,caption:t.c,options:_(i,t)}})).filter(function(t){return function(e){return e.id!==t}}(o))}(t,i,s);return S.stop(),{configs:e}})).catch((function(t){return S.stop(),{errMsg:t.message}}))};var y=Array.isArray,T=function(t){var e=t.values,o=t.valueTexts,i=t.code;if(y(e)&&y(o)&&e.length===o.length){for(var n=[],s=0;s<o.length;s++){var a;n.push({caption:o[s],slice:(a={},a[i]=e[s],a)})}return n}},w=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],D={month:"M",quarter:"K"},b=function(t){var e,o=[],i=t.variables,n="Y";return(void 0===i?[]:i).forEach((function(t){var i,s=t.code,a=t.time,r=t.text||"";a||-1!==w.indexOf(s)?(e=s,n=D[r.toLowerCase()]):o.push({c:(i=r,i.charAt(0).toUpperCase()+i.substring(1)),v:s,options:T(t)})})),{mapFrequency:n,dims:o,timeId:e}};const L=function(t){return f(t).then(b)};var M=function(t){return t.map((function(t){var e=t.c;return{id:t.v,caption:e,options:t.options}}))},I=new h;const O=function(t){if(I.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});var e=function(t){return t.metaUrl||""+(void 0===(o=(e=t).proxy)?"":o)+e.baseMeta+"/"+e.dfId;var e,o}(t);return t.dims?C(n()({metaUrl:e},t)):(I.start(e),L(e).then((function(o){var i=o.dims,n=o.mapFrequency,s=o.timeId;return I.stop(),function(t){for(var e=t.length,o=0;o<e&&t[o].options;o++);return o===e}(i)?{timeId:s,mapFrequency:n,configs:M(i)}:C({noTime:t.noTime,metaUrl:e,dims:i,mapFrequency:n,timeId:s})})).catch((function(t){var e=t.errMsg,o=t.message;return I.stop(),{errMsg:e||o}})))};var F,x=o("/9jM"),q=o("J0TW"),N=o("XAQi"),P=N.Z.Decor,Z=N.Z.crMenuMore,A=N.Z.crDateConfig,j={SPINNER_LOADING:{position:"relative",display:"block",textAlign:"middle",margin:"16px auto 32px",width:32,height:32},SPINNER_FAILED:{borderColor:"#f44336",animation:"none"}},k=x.Z.isCategory,E=x.Z.crOptions,W=function(t){return"is"+t+"Select"};const U={StatN:(0,P.dialog)(F=function(t){function e(e){var o;return(o=t.call(this,e)||this)._toggleStateBy=function(t){o.setState((function(e){var o;return(o={})[t]=!e[t],o}))},o._checkCaptionBy=function(t){o._titles.push(t)},o._uncheckCaption=function(t){o._titles=o._titles.filter((function(e){return e!==t}))},o._setConfigs=function(t){var e=t.configs,i=t.timeId,n=t.mapFrequency,s=t.errMsg;if(e){var a=o.props,r=a.chartsType,c=a.mapFrequency;o.setState({isLoading:!1,isLoadFailed:!1,timeId:i,configs:e,mapFrequency:n||c,selectOptions:e.map((function(t){return t.options})),chartOptions:E({configs:e,chartsType:r})})}else o.setState({isLoading:!1,isLoadFailed:!0,validationMessages:[s]})},o._loadDims=function(){var t=o.props,e=t.dims,i=t.proxy,s=t.baseMeta,a=t.dfProps;O(n()({dims:e,proxy:i,baseMeta:s},a)).then(o._setConfigs).catch((function(t){o._setConfigs({errMsg:t.message})}))},o._updateForDate=function(t){o.date=null;var e=o.props.mapDateDf,i=o.state.mapFrequency,s=A(i||"M",e);o.setState(n()({isShowDate:!0},s,{chartType:t}))},o._handleLoad=function(){var t=o._crValidationMessages();if(0===t.length){var e=a()(o),i=e._items,s=e.dialogOptions,r=e.colorComp,c=e.date,l=o.state,u=l.timeId,h=l.chartType,d=l.selectOptions,p=r?r.getConf():{},f=p.seriaColor,g=p.seriaWidth,m=o.state.dateDefault,v=n()({},o.props,{timeId:u}),_=o.props.loadFn(v,{dialogOptions:s,chartType:h,seriaColor:f,seriaWidth:g,date:c,dateDefault:m,items:i,titles:o._titles,selectOptions:d});o.props.onLoad(_)}o.setState({validationMessages:t})},o._crValidationMessages=function(){var t=[],e=o.state,i=e.configs,n=e.isLoadFailed,s=e.chartType,a=void 0===s?{}:s,r=k(a),c=a.dim;return n?t.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."):i.forEach((function(e,i){var n=e.caption;r&&n===c||o._items[i]||t.push(o.props.msgOnNotSelected(n))})),t},o._handleClose=function(){o._handleWithValidationClose()},o._hSelectChartType=function(t){k(t)?o._updateForDate(t):o.setState({chartType:t,isShowDate:!1})},o._onRegColor=function(t){o.colorComp=t},o._fSelect=function(t){return function(e){this._items[t]=e}},o._hSelectDate=function(t){o.date=t},o._renderSelectInputs=function(){var t=o.state,e=t.isShowLabels;return t.configs.map((function(t,i){var n=t.id,s=t.caption,r=t.options,c=!o.state[W(n)];return(0,l.jsx)(N.Z.ShowHide,{isShow:c,children:(0,l.jsx)(N.Z.RowInputSelect,{isShowLabels:e,caption:s,options:r,onSelect:o._fSelect(i).bind(a()(o))})},n)}))},o._menuMore=Z(a()(o),{toggleToolBar:o._toggleWithToolbar,onAbout:o._clickInfoWithToolbar}),o.toolbarButtons=o._createType2WithToolbar(e,{noDate:!0,isOptions:!0,isToggle:!0}),o._commandButtons=o._crCommandsWithLoad(a()(o)),o._items=[],o._titles=[],o.state=n()({},o._isWithInitialState(),{isLoading:!0,isLoadFailed:!1,isShowChart:!0,isShowDate:!1},A("EMPTY"),{isOptions:!1,isToggle:!1,configs:[],selectOptions:[],mapFrequency:e.mapFrequency,chartOptions:E(e)}),o}c()(e,t);var o=e.prototype;return o.shouldComponentUpdate=function(t,e){return this.props===t||this.props.isShow!==t.isShow},o.componentDidMount=function(){this._loadDims()},o.componentDidUpdate=function(t){(function(t,e,o){return e!==t&&!t.isShow&&e.isShow&&o.isLoadFailed})(t,this.props,this.state)&&(this.setState({isLoading:!0,isLoadFailed:!1}),this._loadDims())},o.render=function(){var t=this.props,e=t.caption,o=t.isShow,i=t.onShow,s=t.onFront,a=this.state,r=a.chartType,c=a.isToolbar,u=a.isOptions,h=a.isToggle,d=a.isShowLabels,p=a.isLoading,f=a.isLoadFailed,g=a.isShowChart,m=a.isShowDate,v=a.dateDefault,_=a.dateOptions,S=a.configs,C=a.chartOptions,y=a.validationMessages,T=f?n()({},j.SPINNER_LOADING,j.SPINNER_FAILED):j.SPINNER_LOADING;return(0,l.jsxs)(N.Z.DraggableDialog,{isShow:o,caption:e,menuModel:this._menuMore,commandButtons:this._commandButtons,onShowChart:i,onFront:s,onClose:this._handleClose,children:[(0,l.jsx)(N.Z.Toolbar,{isShow:c,buttons:this.toolbarButtons}),(0,l.jsx)(N.Z.ModalOptions,{isShow:u,toggleOption:this._toggleOptionWithToolbar,onClose:this._hideOptionsWithToolbar}),(0,l.jsx)(N.Z.ModalToggle,{isShow:h,selectProps:S,isShowChart:g,isShowDate:m,crIsId:W,onToggle:this._toggleStateBy,onCheckCaption:this._checkCaptionBy,onUnCheckCaption:this._uncheckCaption,onClose:this._hideToggleWithToolbar}),(p||f)&&(0,l.jsx)(q.Z,{style:T}),!p&&!f&&this._renderSelectInputs(),(0,l.jsx)(N.Z.RowChartDate,{chartType:r,isShowLabels:d,isShowChart:g,chartOptions:C,onSelectChart:this._hSelectChartType,onRegColor:this._onRegColor,isShowDate:m,dateDefault:v,dateOptions:_,onSelecDate:this._hSelectDate}),(0,l.jsx)(N.Z.ValidationMessages,{validationMessages:y})]})},e}(u.Component))||F}}}]);