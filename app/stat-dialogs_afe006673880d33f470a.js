(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{1625:(t,s,e)=>{"use strict";e.r(s),e.d(s,{default:()=>V});var o=e(9679);const i=class{constructor(t=5e3){this.mls=t,this.isLoading=!1}start(t){return!this.isLoading&&(this.loadingUrl=t,this.isLoading=!0,this.timeoutId=setTimeout((()=>{t===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}};var a=e(9546),n=e.n(a);const r=(t,s)=>fetch(t,s).then((t=>{const{status:s,statusText:e}=t;if(s>=200&&s<400)return t.json();if(403===s)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+s+" "+e)})),h={selection:{filter:"all",values:["*"]}},l={code:"Tid",selection:{filter:"top",values:["1"]}},c=(t,s)=>{const e=t.map((t=>({code:t.v,...h})));return s||e.push(l),{method:"POST",body:JSON.stringify({query:e,response:{format:"json-stat"}})}},d=(t,s)=>{const e=[],o=s.v,i=t.Dimension(o),a=i.length;let n=0;for(;n<a;n++)e.push({caption:i.Category(n).label,slice:{[o]:i.id[n]}});return e},p=new i,g=({metaUrl:t,dims:s=[],noTime:e,timeId:o})=>{if(p.isLoading)return Promise.resolve({errMsg:"Another dims are still loading"});{const i=c(s,e);return p.start(t),r(t,i).then((t=>{const e=((t,s,e)=>{const o=n()(t).Dataset(0);return s.map((t=>({id:t.v,caption:t.c,options:d(o,t)}))).filter((t=>s=>s.id!==t)(e))})(t,s,o);return p.stop(),{configs:e}})).catch((t=>(p.stop(),{errMsg:t.message})))}},u=Array.isArray,m=t=>t.charAt(0).toUpperCase()+t.substring(1),S=(t,s,e)=>({caption:t,slice:{[s]:e}}),w=({values:t,valueTexts:s,code:e})=>{if(u(t)&&u(s)&&t.length===s.length)return s.map(((s,o)=>S(s,e,t[o])))},f=({values:t,id:s})=>(t||[]).map((t=>S(t.text,s,t.id))),_=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],C={month:"M",quarter:"K"},T=t=>{const s=[],{variables:e}=t;let o,i="Y";return(e||[]).forEach((t=>{const{code:e,time:a}=t,n=t.text||"";((t,s,e)=>!t&&s&&e.id&&!u(e.valueTexts)&&u(e.values))(a,n,t)?s.push({c:m(n),v:t.id,options:f(t)}):((t,s)=>!t&&-1===_.indexOf(s)&&-1===(s+"").indexOf("TLIST("))(a,e)?s.push({c:m(n),v:e,options:w(t)}):(o=e,i=C[n.toLowerCase()])})),{mapFrequency:i,dims:s,timeId:o}},y=t=>r(t).then(T),b=t=>t.map((({c:t,v:s,options:e})=>({id:s,caption:t,options:e}))),M=new i,D=t=>{if(M.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const s=(t=>t.metaUrl||(({proxy:t="",baseMeta:s,dfId:e})=>""+t+s+"/"+e)(t))(t);return t.dims?g({metaUrl:s,...t}):(M.start(s),y(s).then((({dims:e,mapFrequency:o,timeId:i})=>(M.stop(),(t=>{const s=t.length;let e=0;for(;e<s&&t[e].options;e++);return e===s})(e)?{timeId:i,mapFrequency:o,configs:b(e)}:g({noTime:t.noTime,metaUrl:s,dims:e,mapFrequency:o,timeId:i})))).catch((({errMsg:t,message:s})=>(M.stop(),{errMsg:t||s}))))}};var L,v=e(9468),I=e(7728),O=e(2554),x=e(8804),F=e(2812),R=e(5893);const{Decor:q,crMenuMore:j,crDateConfig:Z}=F.Z,k={margin:"16px auto 32px"},U={borderColor:"#f44336",animation:"none"},{isCategory:W,crOptions:P}=I.Z,B=t=>"is"+t+"Select",A=({dims:t,proxy:s,baseMeta:e,dfProps:o},i)=>{D({dims:t,proxy:s,baseMeta:e,...o}).then(i).catch((t=>{i({errMsg:t.message})}))},E=(t,s,{isShowLabels:e,isRow:o,fSelect:i})=>{const{id:a,caption:n,options:r}=t,h=!o[B(a)];return(0,R.jsx)(F.Z.ShowHide,{isShow:h,children:(0,R.jsx)(F.Z.RowInputSelect,{isShowLabels:e,caption:n,options:r,onSelect:i(s)})},a)};const V={StatN:(0,q.dialog)(L=class extends o.Component{constructor(t){super(t),this._toggleIsRow=t=>{this.setState((s=>{const{isRow:e}=s;return e[t]=!e[t],s.isRow={...e},{...s}}))},this._checkCaptionBy=t=>{this._titles.push(t)},this._uncheckCaption=t=>{this._titles=this._titles.filter((s=>s!==t))},this._setConfigs=({configs:t,timeId:s,mapFrequency:e,errMsg:o})=>{if(t){const{chartsType:o,mapFrequency:i}=this.props;this.setState({isLoading:!1,isLoadFailed:!1,timeId:s,configs:t,mapFrequency:e||i,selectOptions:t.map((t=>t.options)),chartOptions:P({configs:t,chartsType:o})})}else this.setState({isLoading:!1,isLoadFailed:!0,validationMessages:[o]})},this._setIsShowDate=(t,s)=>{const{isRow:e}=t;e.isShowDate=s,t.isRow={...e}},this._updateForDate=t=>{this.date=null;const{mapDateDf:s}=this.props,{mapFrequency:e}=this.state,o=Z(e||"M",s);this.setState((s=>(this._setIsShowDate(s,!0),{...s,...o,chartType:t})))},this._handleLoad=()=>{const t=this._crValidationMessages();if(0===t.length){const{_items:t,_titles:s,dialogOptions:e,colorComp:o,date:i}=this,{seriaColor:a,seriaWidth:n}=o?o.getConf():{},{dateDefault:r,timeId:h,chartType:l,selectOptions:c}=this.state,{loadFn:d,onLoad:p}=this.props;p(d({...this.props,timeId:h},{dialogOptions:e,chartType:l,seriaColor:a,seriaWidth:n,date:i,dateDefault:r,items:t,titles:s,selectOptions:c}))}this.setState({validationMessages:t})},this._crValidationMessages=()=>{const t=[],{isLoadFailed:s,isLoading:e,configs:o,chartType:i}=this.state,a=W(i),{dim:n}=i||{};return s?(t.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."),t):e?(t.push("Dims is loading"),t):(o.forEach(((s,e)=>{const{caption:o}=s;a&&o===n||this._items[e]||t.push(this.props.msgOnNotSelected(o))})),t)},this._hClose=()=>{this.props.onClose(),this.setState((t=>({validationMessages:[]})))},this._hSelectChartType=t=>{W(t)?this._updateForDate(t):this.setState((s=>(this._setIsShowDate(s,!1),{...s,chartType:t})))},this._onRegColor=t=>{this.colorComp=t},this._fSelect=t=>function(s){this._items[t]=s?{...s}:void 0}.bind(this),this._hSelectDate=t=>{this.date=t},this._menuMore=j(this,{toggleToolBar:this._toggleWithToolbar,onAbout:this._clickInfoWithToolbar}),this.toolbarButtons=this._createType2WithToolbar(t,{noDate:!0,isOptions:!0,isToggle:!0}),this._commandButtons=this._crCommandsWithLoad(this),this._items=[],this._titles=[],this.state={isLoading:!0,isLoadFailed:!1,isToolbar:!0,isShowLabels:v.Z.wideWidth(),isRow:{isShowChart:!0,isShowDate:!1},...Z("EMPTY"),configs:[],selectOptions:[],mapFrequency:t.mapFrequency,chartOptions:P(t),validationMessages:[]}}shouldComponentUpdate(t,s){return this.props===t||this.props.isShow!==t.isShow}componentDidMount(){A(this.props,this._setConfigs)}componentDidUpdate(t){((t,s,e)=>s!==t&&!t.isShow&&s.isShow&&e.isLoadFailed)(t,this.props,this.state)&&(this.setState({isLoading:!0,isLoadFailed:!1}),A(this.props,this._setConfigs))}render(){const{isShow:t,caption:s,onShow:e,onFront:o}=this.props,{chartType:i,isToolbar:a,isOptions:n,isToggle:r,isShowLabels:h,isLoading:l,isLoadFailed:c,dateDefault:d,dateOptions:p,isRow:g,configs:u,chartOptions:m,validationMessages:S}=this.state,{isShowChart:w,isShowDate:f}=g,_=l?k:c?{...k,...U}:void 0;return(0,R.jsxs)(F.Z.DraggableDialog,{isShow:t,caption:s,menuModel:this._menuMore,commandButtons:this._commandButtons,onShowChart:e,onFront:o,onClose:this._hClose,children:[(0,R.jsx)(F.Z.Toolbar,{isShow:a,buttons:this.toolbarButtons}),(0,R.jsx)(F.Z.ModalOptions,{isShow:n,toggleOption:this._toggleOptionWithToolbar,onClose:this._hideOptionsWithToolbar}),(0,R.jsx)(F.Z.ModalToggle,{isShow:r,selectProps:u,isShowChart:w,isShowDate:f,crIsId:B,onToggle:this._toggleIsRow,onCheckCaption:this._checkCaptionBy,onUnCheckCaption:this._uncheckCaption,onClose:this._hideToggleWithToolbar}),_?(0,R.jsx)(O.Z,{style:_}):(0,R.jsx)(x.Z,{items:u,crItem:E,isShowLabels:h,isRow:g,fSelect:this._fSelect}),(0,R.jsx)(F.Z.RowChartDate,{chartType:i,isShowLabels:h,isShowChart:w,chartOptions:m,onSelectChart:this._hSelectChartType,onRegColor:this._onRegColor,isShowDate:f,dateDefault:d,dateOptions:p,onSelecDate:this._hSelectDate}),(0,R.jsx)(F.Z.ValidationMessages,{validationMessages:S})]})}})||L}}}]);