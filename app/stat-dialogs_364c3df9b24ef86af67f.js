(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[138],{4145:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>le});var s=o(9679),n=o(9468),i=o(4706),a=o(2554),r=o(8804),c=o(2812);const u=e=>"is"+e+"Select";var l=o(5893);const d=(e,t,{isShowLabels:o,isRow:s,fSelect:n})=>{const{id:i,caption:a,options:r}=e,d=!s[u(i)];return(0,l.jsx)(c.Z.ShowHide,{isShow:d,children:(0,l.jsx)(c.Z.RowInputSelect,{isShowLabels:o,caption:a,options:r,onSelect:n(t)})},i)};var p=o(1926),h=o(7753);const m=(e,t,o)=>({caption:e,title:t,onClick:o}),f=(e,t,o,n)=>{const[i,a]=(0,p.Z)(!0),r=(0,s.useMemo)((()=>[m("L","Click to toggle input labels",e),m("T","Toggle Inputs",t),m("O","Chart Options",o),m("A","About Datasource",n)]),[]);return[(0,s.useMemo)((()=>(0,l.jsx)(c.Z.Toolbar,{isShow:i,buttons:r})),[i]),a]},g="row__pane-topic not-selected",C=(e,t,o=!0)=>({cn:g,onClick:t,name:e,isClose:o}),S=(e,t)=>(0,s.useMemo)((()=>({titleCl:g,pageWidth:175,maxPages:1,p0:[C("Toggle ToolBar",e),C("About Datasource",t)]})),[]),w=e=>{const[t,o]=(0,s.useState)(e);return[t,(0,s.useCallback)((()=>o((e=>!e))),[]),(0,s.useCallback)((()=>o(!1)),[])]},b=()=>{const e=(0,s.useRef)({}),[t,o,n]=w(!1),i=(0,s.useCallback)((t=>{e.current[t]=!e.current[t]}),[]);return[(0,s.useMemo)((()=>(0,l.jsx)(c.Z.ModalOptions,{isShow:t,toggleOption:i,onClose:n})),[t]),e,o]},y=e=>{const[t,o,n]=w(!1),[i,a]=(0,s.useState)({isShowChart:!0,isShowDate:!1}),{isShowChart:r,isShowDate:d}=i,p=(0,s.useCallback)((e=>{a((t=>(t[e]=!t[e],{...t})))}),[]),h=(0,s.useRef)([]),m=(0,s.useCallback)((e=>{h.current.push(e)}),[]),f=(0,s.useCallback)((e=>{h.current=h.current.filter((t=>t!==e))}),[]);return[(0,s.useMemo)((()=>(0,l.jsx)(c.Z.ModalToggle,{isShow:t,selectProps:e,isShowChart:r,isShowDate:d,crIsId:u,onToggle:p,onCheckCaption:m,onUnCheckCaption:f,onClose:n})),[t,e,r,d]),h,i,a,o]};const v=class{constructor(e=5e3){this.mls=e,this.isLoading=!1}start(e){return!this.isLoading&&(this.loadingUrl=e,this.isLoading=!0,this.timeoutId=setTimeout((()=>{e===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}},O=({dfNonTime:e,mapFrequency:t,dfId:o})=>"https://ec.europa.eu/eurostat/wdds/rest/data/v2.1/json/en/"+o+(e?"":"?time="+(e=>"M"===e?"2019M01":"S"===e?"2019S1":"Q"===e?"2019Q1":"2019")(t)),D="time",T="Geo Entity",x=(e,t,o)=>({caption:e,slice:{[t]:o}}),M=e=>e?e.charAt(0).toUpperCase()+e.substring(1):"",k=Object.keys,I=e=>(e||"").split("_").map(M).join(" "),L=(e,t)=>{const{label:o}=e||{};return k(o||{}).map((e=>({caption:o[e],value:e,id:t})))},F=e=>{const t=[null],o=[];return k(e).forEach((s=>{if(s!==D){const n=e[s],{label:i,category:a}=n||{},r={c:I(i),v:s,options:L(a,s)};"s_adj"===s?(r.c="Adjust",o.push(r)):"geo"===s?(r.c=T,t[0]=r):t.push(r)}})),{dims:t.filter(Boolean).concat(o),timeId:D}},Z=({values:e,id:t})=>(e||[]).map((e=>x(e.text,t,e.id))),j=e=>{const t=[];let o;return e.forEach((e=>{const{time:s,text:n="",id:i}=e;s?(o=i,t.dateOptions=e.values.map((({id:e,text:t})=>({caption:t,value:e}))).reverse()):t.push({c:M(n),v:i,options:Z(e)})})),{mapFrequency:"Y",dims:t,timeId:o}},q=Array.isArray,E={month:"M",quarter:"K"},A=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],R=(e,t)=>!q(e)||!q(t)||e.length!==t.length,_=({values:e,valueTexts:t,code:o})=>{if(!R(e,t))return t.map(((t,s)=>x(t,o,e[s])))},P=e=>{const t=[];let o,s="Y";return e.forEach((e=>{const{code:n,time:i}=e,a=e.text||"";((e,t)=>!e&&-1===A.indexOf(t)&&-1===(t+"").indexOf("TLIST("))(i,n)?t.push({c:M(a),v:n,options:_(e)}):(o=n,s=E[a.toLowerCase()],t.dateOptions=(({values:e,valueTexts:t})=>{if(R(e,t))return;const o=[];return t.forEach(((t,s)=>{o.push({caption:t,value:e[s]})})),o.reverse()})(e))})),{mapFrequency:s,dims:t,timeId:o}},U=(e,t)=>fetch(e,t).then((e=>{const{status:t,statusText:o}=e;if(t>=200&&t<400)return e.json();if(403===t)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error("HTTP Code: "+t+" "+o)})),B=Array.isArray,W=e=>{const t=[],{variables:o,dimension:s,source:n}=e;return((e,t)=>e&&"Eurostat"===t)(s,n)?F(s):B(o)?(i=o[0])&&i.id&&i.text&&!B(i.valueTexts)&&B(i.values)?j(o):P(o):{dims:t,timeId:undefined,mapFrequency:"Y"};var i},Y=e=>U(e).then(W),H=(e,t,o)=>({id:e,caption:t,options:o}),N=(e,t)=>{const o=t?((e,t)=>{const o=Object.create(null);return e.forEach((e=>{o[e.v]=e})),t.map((({v:e,c:t})=>H(e,t,o[e].options)))})(e,t):(e=>e.map((({c:e,v:t,options:o})=>H(t,e,o))))(e);return o.dateOptions=e.dateOptions,o},V={DF:({proxy:e="",baseMeta:t,dfId:o})=>""+e+t+"/"+o,EU_STAT:O},Q=e=>e.metaUrl||(e=>(V[e.loadId]||V.DF)(e))(e),G=new v,K=e=>{if(G.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const t=Q(e),o=e.dims;return G.start(t),Y(t).then((({dims:e,mapFrequency:t,timeId:s})=>{if(!(e=>{const t=e.length;let o=0;for(;o<t&&e[o].options;o++);return o===t})(e))throw{errMsg:"Loaded dims without options"};return{timeId:s,mapFrequency:t,configs:N(e,o)}})).catch((({errMsg:e,message:t})=>({errMsg:e||t}))).finally((()=>{G.stop()}))}},z=e=>{const t=(0,s.useRef)();return(0,s.useEffect)((()=>{t.current=e}),[e]),t.current},{crOptions:J}=i.Z,{crDateConfig:X}=c.Z,$=({dims:e,proxy:t,baseMeta:o,loadId:s,mapFrequency:n,dfProps:i},a)=>{K({dims:e,proxy:t,baseMeta:o,loadId:s,mapFrequency:n,...i}).then(a).catch((e=>{a({errMsg:e.message})}))},ee=()=>({isLoading:!0,isLoadFailed:!1}),te=e=>e.map((e=>e.options)),oe=e=>e.map((e=>({caption:e.caption,value:e.id}))),se=e=>{const{chartsType:t,mapFrequency:o,mapDateDf:n,dfProps:i={}}=e,a=i.mapFrequency||o||"M",r=i.mapDateDf||n,[{isLoading:c,isLoadFailed:u},l]=(0,s.useState)(ee),[d,p]=(0,s.useState)([]),[h,m]=(0,s.useState)((()=>({configs:[],selectOptions:[],mapFrequency:o,chartOptions:J(e),dateOptions:[]}))),f=(0,s.useCallback)((({configs:e,timeId:o,mapFrequency:s,errMsg:n})=>{if(e){const n=s||a,[i,c]=((e,t,o)=>{const{dateOptions:s}=e;if(s)return[s,s[0]];const{dateOptions:n,dateDefault:i}=X(t,o);return[n,{caption:i,value:i}]})(e,n,r);l({isLoading:!1,isLoadFailed:!1}),m({timeId:o,configs:e,selectOptions:te(e),mapFrequency:n,dimOptions:oe(e),chartOptions:J({configs:e,chartsType:t}),dateOptions:i,dateDf:c})}else l({isLoading:!1,isLoadFailed:!0}),p([n])}),[t,a,r]),g=((e,t)=>{const o=z(e);return t&&!o.isShow&&e.isShow})(e,u);return(0,s.useEffect)((()=>{$(e,f)}),[]),(0,s.useEffect)((()=>{g&&($(e,f),l(ee))}),[g,e,f]),[h,c,u,d,p,m]},ne=e=>(0,s.useMemo)((()=>[(0,l.jsx)(c.Z.Button.Load,{onClick:e},"load")]),[e]),ie={margin:"16px auto 32px"},ae={borderColor:"#f44336",animation:"none"},{isCategory:re}=i.Z,ce=n.Z.wideWidth(),ue=(e,t)=>e.isShow===t.isShow,le={StatN:(0,s.memo)((e=>{const{isShow:t,caption:o,onShow:n,onFront:i,loadFn:u,onLoad:m,msgOnNotSelected:g,onClickInfo:C,onClose:w}=e,v=!e.dims&&!e.notDim,O=(0,s.useRef)([]),D=(0,s.useCallback)((e=>t=>{O.current[e]=t?{...t}:void 0}),[]),[x,M]=(0,h.Z)(),[k,I]=(0,h.Z)(),[L,F]=(0,h.Z)(),[Z,j,q,E,A,R]=se(e),{configs:_,selectOptions:P,chartType:U,chartOptions:B,dimOptions:W,dateOptions:Y,dateDf:H={},timeId:N}=Z,[V,Q]=(0,p.Z)(ce),[G,K,z]=b(),[J,X,$,ee,te]=y(_),{isShowDate:oe,isShowChart:ue}=$,[le,de]=f(Q,te,z,C),pe=(0,s.useCallback)((()=>{w(),A([])}),[]),he=(0,s.useCallback)((()=>{const t=[];if(q)return t.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."),t;if(j)return t.push("Dims is loading"),t;const o=re(U),{dim:s}=U||{},n=((e,t,o,s)=>n=>{o.forEach(((o,i)=>{const{caption:a}=o;n(a)&&!s[i]&&e.push(t(a))}))})(t,g,_,O.current);if(!v||!o){const i=e.notDim?T:s;return n((e=>!(o&&e===i))),t}if(o){const e=L.current;if(!e)return t.push("Dim isn't selected"),t;n((t=>t!==e.caption))}return t}),[q,j,_,U,g]),me=(0,s.useCallback)((e=>{let t=!1;re(e)&&(k.current=null,t=!0),ee((e=>(e.isShowDate=t,{...e}))),R((t=>({...t,chartType:e})))}),[]),fe=(0,s.useCallback)((()=>{const t=he();if(0===t.length){const{seriaColor:t,seriaWidth:o}=x.current?x.current.getConf():{},s=((e,t)=>{const{dfC:o}=e;return o||(t||{}).value})(e,L.current),n=((e,t)=>e.dfC||!t?"":t.caption||"")(e,L.current),i=u({...e},{timeId:N,dfC:s,dfTitle:n,time:(k.current||H).value,dialogOptions:K.current,chartType:U,seriaColor:t,seriaWidth:o,items:O.current,titles:X.current,selectOptions:P});m(i)}A(t)}),[he,H,N,U,_,P]),ge=ne(fe),Ce=S(de,C),Se=((e,t)=>e?ie:t?{...ie,...ae}:void 0)(j,q);return(0,l.jsxs)(c.Z.DraggableDialog,{isShow:t,caption:o,menuModel:Ce,commandButtons:ge,onShowChart:n,onFront:i,onClose:pe,children:[le,G,J,Se?(0,l.jsx)(a.Z,{style:Se}):(0,l.jsx)(r.Z,{items:_,crItem:d,isShowLabels:V,isRow:$,fSelect:D}),(0,l.jsx)(c.Z.RowChartDate,{chartType:U,isShowLabels:V,isShowChart:ue,chartOptions:B,onSelectChart:me,onRegColor:M,isShowDate:oe,dateDefault:H.caption,dateOptions:Y,onSelecDate:I,isDim:v,dimOptions:W,onSelecDim:F}),(0,l.jsx)(c.Z.ValidationMessages,{validationMessages:E})]})}),ue)}}}]);