{"version":3,"sources":["../../src/math/mfi.js"],"names":["ymdToUTC","dt","_getPriceAndFlow","point","close","high","low","bTp","plus","div","bRmf","times","isFullData","_crMfiXy","p","y","x","_crMfiDetail","isNegative","zhDate","tp","parseFloat","toFixed","rmf","mfi","data","period","dataMfi","nPeriod","bPositiveFlow","bNegativeFlow","nNotFullPoint","max","length","i","push","gt","minus","bMFR_PlusOne","bRatio","bY"],"mappings":"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","sourcesContent":["import Big from 'big.js';\r\n\r\nimport dt from '../utils/DateUtils'\r\n\r\nconst { ymdToUTC } = dt;\r\n\r\nconst _getPriceAndFlow = (point) => {\r\n  const close = point[4]\r\n      , high = (point[2]) ? point[2] : close\r\n      , low  = (point[3]) ? point[2] : close\r\n      , bTp = Big(high).plus(low).plus(close).div(3)\r\n      , bRmf = bTp.times(point[5])\r\n      , isFullData = (point[2] && point[3])\r\n            ? true : false;\r\n  return { bTp, bRmf, isFullData };\r\n};\r\n\r\nconst _crMfiXy = (p, y) => ({\r\n  x : ymdToUTC(p),\r\n  y : y\r\n});\r\nconst _crMfiDetail = (isNegative, bTp, bRmf, zhDate) => ({\r\n  isNegative : isNegative,\r\n  tp : parseFloat(bTp.toFixed(4)),\r\n  rmf : parseFloat(bRmf.toFixed(4)),\r\n  zhDate : zhDate\r\n});\r\n\r\nconst mfi = (data, period) => {\r\n\r\n  const dataMfi = []\r\n      , nPeriod = parseFloat(period) + 1;\r\n\r\n   let bPositiveFlow = Big('0.0')\r\n     , bNegativeFlow = Big('0.0001')\r\n     , isNegative = false\r\n     , nNotFullPoint = 0\r\n     , max=data.length\r\n     , i = 0;\r\n\r\n   for (; i<max; i++){\r\n     const point = data[i];\r\n     if (i<nPeriod){\r\n       if (i==0){\r\n         const {bTp, bRmf, isFullData} = _getPriceAndFlow(point);\r\n         if (!isFullData) { nNotFullPoint+=1;}\r\n         dataMfi.push({\r\n           ..._crMfiXy(point[0], null),\r\n           ..._crMfiDetail(false, bTp, bRmf)\r\n         })\r\n       } else {\r\n         const {bTp, bRmf, isFullData} = _getPriceAndFlow(point);\r\n         if (!isFullData) { nNotFullPoint+=1;}\r\n         if (bTp.gt(dataMfi[i-1].tp)){\r\n            bPositiveFlow = bPositiveFlow.plus(bRmf.toFixed(4));\r\n            isNegative = false;\r\n         } else {\r\n           bNegativeFlow = bNegativeFlow.plus(bRmf.toFixed(4));\r\n           isNegative = true;\r\n         }\r\n         dataMfi.push({\r\n           ..._crMfiXy(point[0], null),\r\n           ..._crMfiDetail(isNegative, bTp, bRmf)\r\n         })\r\n       }\r\n     } else {\r\n        const { bTp, bRmf, isFullData } = _getPriceAndFlow(point);\r\n        if (!isFullData) { nNotFullPoint+=1; }\r\n        if (bTp.gt(dataMfi[i-1].tp)){\r\n           bPositiveFlow = bPositiveFlow.plus(bRmf.toFixed(4));\r\n           isNegative = false;\r\n        } else {\r\n          bNegativeFlow = bNegativeFlow.plus(bRmf.toFixed(4));\r\n          isNegative = true;\r\n        }\r\n        if (dataMfi[i-period].isNegative){\r\n          bNegativeFlow = bNegativeFlow.minus(dataMfi[i-period].rmf);\r\n        } else {\r\n          bPositiveFlow = bPositiveFlow.minus(dataMfi[i-period].rmf);\r\n        }\r\n\r\n        const bMFR_PlusOne = bPositiveFlow.div(bNegativeFlow.toFixed(4)).plus('1')\r\n            , bRatio = Big('100').div(bMFR_PlusOne.toFixed(4))\r\n            , bY = Big('100').minus(bRatio.toFixed(4));\r\n\r\n        dataMfi.push({\r\n          ..._crMfiXy(point[0], parseFloat(bY.toFixed(2))),\r\n          ..._crMfiDetail(isNegative, bTp, bRmf, point[0])\r\n        })\r\n     }\r\n   }\r\n\r\n   return {\r\n     dataMfi,\r\n     nNotFullPoint\r\n   };\r\n};\r\n\r\nexport default mfi\r\n"],"file":"mfi.js"}