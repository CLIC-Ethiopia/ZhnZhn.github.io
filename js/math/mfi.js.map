{"version":3,"sources":["../../src/math/mfi.js"],"names":["_getPriceAndFlow","point","close","high","low","bTp","plus","div","bRmf","times","isFullData","_isNumber","n","_crMfiPoint","p","y","isNegative","x","tp","parseFloat","toFixed","rmf","mfi","data","period","dataMfi","nPeriod","bPositiveFlow","bNegativeFlow","nNotFullPoint","max","length","i","gt","push","_rmf","minus","bMFR_PlusOne","bRatio","bY"],"mappings":"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","sourcesContent":["import Big from 'big.js';\r\nimport { ymdToUTC } from '../utils/DateUtils';\r\n\r\nconst _getPriceAndFlow = (point) => {\r\n  const close = point[4]\r\n  , high = point[2] || close\r\n  , low  = point[3] || close\r\n  , bTp = Big(high).plus(low).plus(close).div(3)\r\n  , bRmf = bTp.times(point[5])\r\n  , isFullData = (point[2] && point[3])\r\n       ? true : false;\r\n  return [bTp, bRmf, isFullData];\r\n};\r\n\r\nconst _isNumber = n => typeof n === 'number'\r\n  && n-n === 0;\r\n\r\nconst _crMfiPoint = (p, y, isNegative, bTp, bRmf) => ({\r\n  x : _isNumber(p) ? p : ymdToUTC(p),\r\n  y : y,\r\n  isNegative : isNegative,\r\n  tp : parseFloat(bTp.toFixed(4)),\r\n  rmf : parseFloat(bRmf.toFixed(4))\r\n});\r\n\r\nconst mfi = (data, period) => {\r\n\r\n  const dataMfi = []\r\n  , nPeriod = parseFloat(period) + 1;\r\n\r\n  let bPositiveFlow = Big(0)\r\n  , bNegativeFlow = Big('0.0001')\r\n  , isNegative = false\r\n  , nNotFullPoint = 0\r\n  , max=data.length\r\n  , i = 0;\r\n\r\n  for (; i<max; i++){\r\n     const point = data[i]\r\n     , [bTp, bRmf, isFullData] = _getPriceAndFlow(point);\r\n     if (!isFullData) { nNotFullPoint+=1; }\r\n\r\n     if (i<nPeriod){\r\n       if (i!=0) {\r\n         if (bTp.gt(dataMfi[i-1].tp)){\r\n           bPositiveFlow = bPositiveFlow.plus(bRmf);\r\n           isNegative = false;\r\n         } else {\r\n           bNegativeFlow = bNegativeFlow.plus(bRmf);\r\n           isNegative = true;\r\n         }\r\n       }\r\n       dataMfi.push(\r\n         _crMfiPoint(point[0], null, isNegative, bTp, bRmf)\r\n       )\r\n     } else {\r\n        if (bTp.gt(dataMfi[i-1].tp)){\r\n          bPositiveFlow = bPositiveFlow.plus(bRmf);\r\n          isNegative = false;\r\n        } else {\r\n          bNegativeFlow = bNegativeFlow.plus(bRmf);\r\n          isNegative = true;\r\n        }\r\n        const _rmf = dataMfi[i-period].rmf;\r\n        if (dataMfi[i-period].isNegative){\r\n          bNegativeFlow = bNegativeFlow.minus(_rmf);\r\n        } else {\r\n          bPositiveFlow = bPositiveFlow.minus(_rmf);\r\n        }\r\n\r\n        const bMFR_PlusOne = bPositiveFlow.div(bNegativeFlow).plus(1)\r\n        , bRatio = Big(100).div(bMFR_PlusOne)\r\n        , bY = Big(100).minus(bRatio);\r\n\r\n        dataMfi.push(\r\n          _crMfiPoint(point[0], parseFloat(bY.toFixed(2)), isNegative, bTp, bRmf)\r\n        )\r\n     }\r\n   }\r\n\r\n   return [\r\n     dataMfi,\r\n     nNotFullPoint\r\n   ];\r\n};\r\n\r\nexport default mfi\r\n"],"file":"mfi.js"}