{"version":3,"sources":["../../src/math/k-means.js"],"names":["C","N","ITERATION","getterSetter","initialValue","validator","thingToGetSet","_fnIsValid","val","newValue","sumOfSquareDiffs","oneVector","anotherVector","squareDiffs","map","component","i","Math","pow","reduce","a","b","mindex","array","min","indexOf","sumVectors","averageLocation","points","zeroVector","location","locations","point","vectorSum","length","Point","self","label","updateLabel","centroids","distancesSquared","centroid","Centroid","initialLocation","updateLocation","pointsWithThisCentroid","filter","kmeans","data","config","k","round","sqrt","iterations","vector","push","iter","forEach","compareUnaryCentroid","compareUnaryPoint","clusterMaker","arrayOfArrays","n","boolA","boolB","clusters","pointsAndCentroids","undefined","value","unarySortedClusters","sort","cluster","crUnarySortedCluster","iteration"],"mappings":"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","file":"k-means.js","sourcesContent":["\r\n\r\nconst C = {\r\n  N: 6,\r\n  ITERATION: 100\r\n};\r\n\r\n// convenience functions\r\nconst getterSetter = function(initialValue, validator) {\r\n  let thingToGetSet = initialValue;\r\n  const _fnIsValid = validator || function(val) { return true };\r\n  return function(newValue) {\r\n    if (typeof newValue === 'undefined') return thingToGetSet;\r\n    if (_fnIsValid(newValue)) thingToGetSet = newValue;\r\n  };\r\n};\r\n\r\nconst sumOfSquareDiffs = function(oneVector, anotherVector) {\r\n  const squareDiffs = oneVector.map( (component, i) => {\r\n    return Math.pow(component - anotherVector[i], 2);\r\n  });\r\n  return squareDiffs.reduce( (a, b) => { return a + b }, 0);\r\n};\r\n\r\nconst mindex = function(array) {\r\n  const min = array.reduce( (a, b) => {\r\n    return Math.min(a, b);\r\n  });\r\n  return array.indexOf(min);\r\n};\r\n\r\nconst sumVectors = function(a, b) {\r\n  return a.map( (val, i) => { return val + b[i]; });\r\n};\r\n\r\nconst averageLocation = function(points) {\r\n  const zeroVector = points[0].location().map( () => { return 0; })\r\n      , locations = points.map( (point) => { return point.location(); })\r\n      , vectorSum = locations.reduce( (a, b) => { return sumVectors(a, b); }, zeroVector);\r\n\r\n  return vectorSum.map( (val) => { return val / points.length; });\r\n};\r\n\r\n// objects\r\nconst Point = function(location) {\r\n  const self = this;\r\n  this.location = getterSetter(location);\r\n\r\n  this.label = getterSetter();\r\n  this.updateLabel = function(centroids) {\r\n    const distancesSquared = centroids.map( (centroid) => {\r\n      return sumOfSquareDiffs(self.location(), centroid.location());\r\n    });\r\n    self.label(mindex(distancesSquared));\r\n  };\r\n};\r\n\r\nconst Centroid = function(initialLocation, label) {\r\n  const self = this;\r\n  this.location = getterSetter(initialLocation);\r\n  this.label = getterSetter(label);\r\n  this.updateLocation = function(points) {\r\n    const pointsWithThisCentroid = points.filter( (point) => { return point.label() == self.label(); });\r\n    if (pointsWithThisCentroid.length > 0) self.location(averageLocation(pointsWithThisCentroid));\r\n  };\r\n};\r\n\r\n\r\n\r\nconst kmeans = function(data, config) {\r\n  // default k\r\n  const k = config.k || Math.round(Math.sqrt(data.length / 2))\r\n      , iterations = config.iterations;\r\n\r\n  // initialize point objects with data\r\n  const points = data.map( (vector) => { return new Point(vector); });\r\n\r\n  // intialize centroids randomly\r\n  const centroids = [];\r\n  let i;\r\n  for (i = 0; i < k; i++) {\r\n    centroids.push(new Centroid(points[i % points.length].location(), i));\r\n  }\r\n\r\n  // update labels and centroid locations until convergence\r\n  let iter;\r\n  for (iter = 0; iter < iterations; iter++) {\r\n    points.forEach( (point) => { point.updateLabel(centroids); });\r\n    centroids.forEach( (centroid) => { centroid.updateLocation(points); });\r\n  }\r\n\r\n  // return points and centroids\r\n  return {\r\n    points: points,\r\n    centroids: centroids\r\n  };\r\n\r\n};\r\n\r\n\r\n//fn for sort clusters\r\nconst compareUnaryCentroid = (a, b) => {\r\n  if ( a.centroid[0] < b.centroid[0] ) { return -1;}\r\n  if ( a.centroid[0] > b.centroid[0] ) { return 1;}\r\n  if ( a.centroid[0] === b.centroid[0] ) { return 0;}\r\n};\r\nconst compareUnaryPoint = (a, b) => {\r\n  if ( a[0] < b[0] ) { return -1;}\r\n  if ( a[0] > b[0] ) { return 1;}\r\n  if ( a[0] === b[0] ) { return 0;}\r\n};\r\n\r\nconst clusterMaker = {\r\n\r\n  data: getterSetter([], function(arrayOfArrays) {\r\n    const n = arrayOfArrays[0].length;\r\n    return (arrayOfArrays.map( (array) => {\r\n      return array.length == n;\r\n    }).reduce( (boolA, boolB) => { return (boolA & boolB); }, true));\r\n  }),\r\n\r\n  clusters() {\r\n    const pointsAndCentroids = kmeans(this.data(), {k: this.k(), iterations: this.iterations() })\r\n        , points = pointsAndCentroids.points\r\n        , centroids = pointsAndCentroids.centroids;\r\n\r\n    return centroids.map( (centroid) => {\r\n      return {\r\n        centroid: centroid.location(),\r\n        points: points\r\n                  .filter( (point) => {\r\n                    return point.label() == centroid.label();\r\n                  })\r\n                  .map( (point) => {\r\n                     return point.location();\r\n                  })\r\n      };\r\n    });\r\n  },\r\n\r\n  k: getterSetter(undefined, function(value) { return ((value % 1 == 0) & (value > 0)) }),\r\n\r\n  iterations: getterSetter(Math.pow(10, 3), function(value) { return ((value % 1 == 0) & (value > 0)) }),\r\n\r\n\r\n  unarySortedClusters() {\r\n    return this.clusters()\r\n        .sort(compareUnaryCentroid)\r\n        .map( (cluster) => {\r\n           cluster.points = cluster.points.sort(compareUnaryPoint);\r\n           return cluster;\r\n        });\r\n  },\r\n\r\n  crUnarySortedCluster(points=[], n=C.N, iteration=C.ITERATION){\r\n    this.k(n)\r\n    this.iterations(iteration)\r\n    this.data(points)\r\n    return this.unarySortedClusters();\r\n  }\r\n\r\n};\r\n\r\nexport default clusterMaker\r\n"]}