{"version":3,"sources":["../../src/math/seriaFn.js"],"names":["isNumber","fns","isPointArr","crPointGetter","fGetY","getZeroCountFromStart","getZeroIndexFromEnd","_isArr","Array","isArray","_calcY","yPrev","yNext","parseFloat","minus","div","Math","abs","times","toFixed","_calcChanges","toString","_crIndicatorData","d","rt","calc","_d","max","length","prevStep","getX","getY","pPrev","pNext","i","push","_fIndicator","_rt","parseInt","fn","growthRate","changesBetween","normalize","_y0","findMinY","data","minY","Number","POSITIVE_INFINITY","_fn","y","p","min","arr","mathFn","toFixedNumber","findMaxY","maxY","NEGATIVE_INFINITY","filterTrimZero","_getY","_countZero","splice","_zeroIndex","mean","_sum","_numberOfPoints","_p","add","_maxIndex","_avg","median","map","arrP","sort","a","b","_len","_half","_median","round"],"mappings":"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","sourcesContent":["import Big from 'big.js'\r\n\r\nimport mathFn from './mathFn'\r\nimport fns from './seriaHelperFn'\r\n\r\nconst {\r\n  isNumber,\r\n  isPointArr,\r\n  crPointGetter,\r\n  fGetY,\r\n  getZeroCountFromStart,\r\n  getZeroIndexFromEnd\r\n} = fns\r\n\r\nconst _isArr = Array.isArray;\r\n\r\nconst _calcY = (yPrev, yNext) => {\r\n\r\n  if (!isNumber(yPrev) || !isNumber(yNext)) {\r\n    return null;\r\n  }\r\n\r\n  if (yNext === 0) {\r\n    return yPrev === 0\r\n      ? 0\r\n      : yPrev > 0 ? -100 : 100;\r\n  }\r\n\r\n  if (yPrev === 0) {\r\n    return null;\r\n  }\r\n\r\n  return parseFloat(\r\n    Big(yNext).minus(yPrev)\r\n      .div(Math.abs(yPrev))\r\n      .times(100)\r\n      .toFixed(2)\r\n    );\r\n};\r\n\r\nconst _calcChanges = (yPrev, yNext) => {\r\n  if (!isNumber(yPrev) || !isNumber(yNext)) {\r\n    return null;\r\n  }\r\n  return parseFloat(Big(yNext).minus(yPrev).toString());\r\n};\r\n\r\nconst _crIndicatorData = (d, rt, calc) => {\r\n  const _d = []\r\n  , max = d.length\r\n  , prevStep = rt-1\r\n  , { getX, getY } = crPointGetter(d);\r\n  let pPrev = d[0]\r\n    , pNext\r\n    , i=rt;\r\n  for (; i<max; i++){\r\n    pNext = d[i];\r\n    _d.push([\r\n      getX(pNext),\r\n      calc(getY(pPrev), getY(pNext))\r\n    ])\r\n    pPrev = d[i-prevStep]\r\n  }\r\n  return _d;\r\n}\r\n\r\nconst _fIndicator = (calc) => (d, rt=1) => {\r\n  const _rt = parseInt(rt, 10);\r\n  if ( !(_isArr(d) && isNumber(_rt)) ) {\r\n    return [];\r\n  }\r\n  return _crIndicatorData(d, _rt, calc);\r\n};\r\n\r\nconst fn = {\r\n  growthRate: _fIndicator(_calcY),\r\n  changesBetween: _fIndicator(_calcChanges),\r\n\r\n  normalize: (d) => {\r\n    if ( !(_isArr(d) && d[0]) ) {\r\n      return [];\r\n    }\r\n    const { getX, getY } = crPointGetter(d)\r\n    , _y0 = getY(d[0]);\r\n    if ( !(isNumber(_y0) && _y0 !== 0) ) {\r\n      return [];\r\n    }\r\n\r\n    const _d = [];\r\n    let i = 0;\r\n    for(; i<d.length; i++) {\r\n      _d.push([\r\n        getX(d[i]),\r\n        parseFloat(\r\n          Big(getY(d[i])).div(_y0)\r\n           .times(100)\r\n           .toFixed(2)\r\n        )\r\n      ])\r\n    }\r\n\r\n    return _d;\r\n  },\r\n\r\n  findMinY: (data) => {\r\n    if ( !(_isArr(data) && data.length) ) {\r\n      return void 0;\r\n    }\r\n    let minY = Number.POSITIVE_INFINITY;\r\n    const _fn = isNumber(data[0].y)\r\n      ? (p, min) => isNumber(p.y) && p.y<min ? p.y : min\r\n      : (arr, min) => isNumber(arr[1]) && arr[1]<min ? arr[1] : min;\r\n    let i = 0;\r\n    for (; i<data.length; i++){\r\n      minY = _fn(data[i], minY)\r\n    }\r\n    return minY !== Number.POSITIVE_INFINITY\r\n      ? mathFn.toFixedNumber(minY)\r\n      : void 0;\r\n  },\r\n  findMaxY: (data) => {\r\n    if (! (_isArr(data) && data.length) ) {\r\n      return void 0;\r\n    }\r\n    let maxY = Number.NEGATIVE_INFINITY;\r\n    const _fn = isNumber(data[0].y)\r\n      ? (p, max) => isNumber(p.y) && p.y>max ? p.y : max\r\n      : (arr, max) => isNumber(arr[1]) && arr[1]>max ? arr[1] : max;\r\n    let i = 0;\r\n    for (; i<data.length; i++){\r\n      maxY = _fn(data[i], maxY)\r\n    }\r\n    return maxY !== Number.NEGATIVE_INFINITY\r\n      ? mathFn.toFixedNumber(maxY)\r\n      : void 0;\r\n  },\r\n\r\n  filterTrimZero: (data) => {\r\n    if (!_isArr(data)) { return data; }\r\n\r\n    const _getY = fGetY(data[0]);\r\n    if (!_getY) { return data; }\r\n\r\n    const _countZero = getZeroCountFromStart(data, _getY)\r\n    if (_countZero) {\r\n      data.splice(0, _countZero)\r\n    }\r\n    const _zeroIndex = getZeroIndexFromEnd(data, _getY)\r\n    if (_zeroIndex){\r\n      data.splice(_zeroIndex)\r\n    }\r\n    return data;\r\n  },\r\n\r\n  mean: (data) => {\r\n    if ( !isPointArr(data) ) {\r\n      return [];\r\n    }\r\n\r\n    let _sum = Big(0)\r\n    , _numberOfPoints = 0, i = 0, _p;\r\n    for (;i<data.length;i++) {\r\n      _p = data[i]\r\n      if (isNumber(_p[1])) {\r\n        _sum = _sum.add(_p[1])\r\n        _numberOfPoints++\r\n      }\r\n    }\r\n    const _maxIndex = data.length - 1\r\n    , _avg = parseInt(_sum.div(_numberOfPoints).toFixed(0), 10);\r\n    return [\r\n      [data[0][0], _avg],\r\n      [data[_maxIndex][0], _avg]\r\n    ];\r\n  },\r\n\r\n  median: (data) => {\r\n    if ( !isPointArr(data) ) {\r\n      return [];\r\n    }\r\n\r\n    const _d = data\r\n      .map(arrP => arrP[1])\r\n      .sort((a, b) => a-b)\r\n    , _len = data.length\r\n    , _half = _len/2\r\n    , _median = _half % 2 === 0\r\n       ? Math.round((_d[_half-1] + _d[_half])/2)\r\n       : _d[Math.round(_half) - 1];\r\n    return [\r\n      [data[0][0], _median],\r\n      [data[_len-1][0], _median],\r\n    ];\r\n  }\r\n};\r\n\r\nexport default fn\r\n"],"file":"seriaFn.js"}