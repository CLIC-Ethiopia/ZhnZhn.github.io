{"version":3,"sources":["../../../src/components/zhn-containers/DialogContainer.jsx"],"names":["S","ROOT","zIndex","position","top","left","width","_findCompIndex","arr","key","_max","length","i","undefined","_doVisible","keyValue","_index","slice","_updateVisible","state","maxDialog","hmIs","visibleDialogs","_keyIndex","indexOf","splice","push","_findCompByKey","comps","index","DialogContainer","props","_onStore","actionType","option","showAction","setState","Comp","data","prevState","compDialogs","hmData","_handleToggleDialog","onCloseDialog","_Comp","elHtml","style","cursor","_handleToFront","_renderDialogs","map","cloneElement","isShow","optionData","onFront","bind","onClose","document","getElementsByTagName","unsubscribe","store","listen","error","info","defaultProps"],"mappings":"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","file":"DialogContainer.js","sourcesContent":["import React, { Component } from 'react';\r\n\r\nconst S = {\r\n  ROOT: {\r\n    zIndex: 1030,\r\n    position: 'absolute',\r\n    top: '70px',\r\n    left: '10px',\r\n    width: '98%'\r\n  }\r\n};\r\n\r\nconst _findCompIndex = (arr, key) => {\r\n  const _max = arr.length;\r\n  let  i=0;\r\n  for (; i<_max; i++){\r\n    if (arr[i].key === key){\r\n      return i;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nconst _doVisible = function(arr, keyValue){\r\n  const _index = _findCompIndex(arr, keyValue) || 0;\r\n\r\n  return [ ...arr.slice(0, _index), ...arr.slice(_index+1), arr[_index] ];\r\n}\r\n\r\nconst _updateVisible = (state, key, maxDialog) => {\r\n  const { hmIs, visibleDialogs } = state\r\n      , _keyIndex = visibleDialogs.indexOf(key);\r\n  if (_keyIndex !== -1) {\r\n    visibleDialogs.splice(_keyIndex, 1)\r\n  }\r\n  visibleDialogs.push(key)\r\n  hmIs[key] = true\r\n  if (visibleDialogs.length > maxDialog ){\r\n    hmIs[visibleDialogs[0]] = false\r\n    visibleDialogs.splice(0, 1)\r\n  }\r\n}\r\n\r\nconst _findCompByKey = (comps, key) => {\r\n  const index = _findCompIndex(comps, key);\r\n  return index !== undefined\r\n     ? comps[index]\r\n     : undefined;\r\n}\r\n\r\nclass DialogContainer extends Component {\r\n  static defaultProps = {\r\n    maxDialog: 3\r\n  }\r\n\r\n  constructor(props){\r\n    super()\r\n    this.elHtml = document.getElementsByTagName('html')[0]\r\n    this.state = {\r\n      hmIs: {},\r\n      compDialogs : [],\r\n      hmData : {},\r\n      visibleDialogs: []\r\n    }\r\n  }\r\n\r\n   componentDidMount(){\r\n     this.unsubscribe = this.props.store.listen(this._onStore)\r\n   }\r\n   componentWillUnmount(){\r\n     this.unsubscribe()\r\n   }\r\n\r\n\r\n   componentDidCatch(error, info){\r\n     /*\r\n     console.log('error:')\r\n     console.log(error)\r\n     console.log('info:')\r\n     console.log(info)\r\n     */\r\n   }\r\n\r\n\r\n   _onStore = (actionType, option) => {\r\n      const { showAction } = this.props;\r\n      if (actionType === showAction){\r\n         this.setState(prevState => {\r\n           const { key, Comp, data } = option\r\n               , { maxDialog } = this.props;\r\n           _updateVisible(prevState, key, maxDialog)\r\n           if (!Comp){\r\n              prevState.compDialogs = _doVisible(prevState.compDialogs, key)\r\n           } else {\r\n              prevState.compDialogs.push(Comp)\r\n           }\r\n           prevState.hmData[key] = data\r\n           return prevState;\r\n         })\r\n      }\r\n   }\r\n\r\n  _handleToggleDialog = (key) => {\r\n    const { hmIs, compDialogs } = this.state;\r\n    if (hmIs[key]){\r\n      const { onCloseDialog } = this.props\r\n          , _Comp = _findCompByKey(compDialogs, key);\r\n      if (typeof onCloseDialog === 'function' && _Comp){\r\n        onCloseDialog(_Comp)\r\n      }\r\n    }\r\n\r\n    this.setState(prevState => {\r\n      const { hmIs } = prevState;\r\n      hmIs[key] = !hmIs[key]\r\n      if (!hmIs[key]) {\r\n        const visibleDialogs = prevState.visibleDialogs\r\n            , _keyIndex = visibleDialogs.indexOf(key);\r\n        visibleDialogs.splice(_keyIndex, 1)\r\n        this.elHtml.style.cursor = ''\r\n      }\r\n      return prevState;\r\n    })\r\n  }\r\n\r\n  _handleToFront = (key) => {\r\n    const { visibleDialogs } = this.state;\r\n    if (visibleDialogs[visibleDialogs.length-1] !== key) {\r\n      this.setState(prevState => {\r\n        prevState.compDialogs = _doVisible(prevState.compDialogs, key)\r\n        const visibleDialogs = prevState.visibleDialogs\r\n            , _keyIndex = visibleDialogs.indexOf(key);\r\n        visibleDialogs.splice(_keyIndex, 1)\r\n        visibleDialogs.push(key)\r\n        return prevState;\r\n      })\r\n    }\r\n  }\r\n\r\n  _renderDialogs = () => {\r\n    const { hmIs, compDialogs, hmData } = this.state;\r\n    return compDialogs.map(Comp => {\r\n       const key = Comp.key;\r\n       return React.cloneElement(Comp, {\r\n          key: key,\r\n          isShow: hmIs[key],\r\n          optionData: hmData[key],\r\n          onFront: this._handleToFront.bind(this, key),\r\n          onClose: this._handleToggleDialog.bind(this, key)\r\n       });\r\n    });\r\n  }\r\n\r\n  render() {    \r\n    return (\r\n      <div style={S.ROOT}>\r\n        {this._renderDialogs()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DialogContainer\r\n"]}