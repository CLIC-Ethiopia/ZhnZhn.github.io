{"version":3,"sources":["../../../src/components/dialogs/WithLoadOptions.js"],"names":["_fnShowAlertDialog","alertCaption","alertDescr","modalDialogType","ALERT","showModalDialog","WithLoadOptions","_loadOptions","option","toStateProp","isLoadingProp","isLoadingFailedProp","uri","optionJsonProp","fnOnCompleted","fnOnFailed","retryServer","retryNetwork","fetch","then","response","status","statusText","json","_loadOptionsID","setTimeout","catch","error","_onLoadOptionsCompleted","setState","_onLoadOptionsFailed","TypeError","Alert","NETWORK_ERROR","caption","descr","_handlerWithLoadOptions","optionURI","props","_uri","_jsonProp","optionsJsonProp","_unmountWithLoadOptions","clearTimeout"],"mappings":";;;;;;AAEA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,qBAAqB,SAArBA,kBAAqB,CAASC,YAAT,EAAuBC,UAAvB,EAAkC;AAC3D,MAAMC,kBAAkB,kBAAYC,KAApC;AACA,6BAAiBC,eAAjB,CACE,kBAAYD,KADd,EACqB,EAAEH,0BAAF,EAAgBC,sBAAhB,EAA4BC,gCAA5B,EADrB;AAGD,CALD;;AAOA,IAAMG,kBAAmB;AACvBC,cADuB,wBACVC,MADU,EACH;AAAA;;AAAA,QAEVC,WAFU,GAKRD,MALQ,CAEVC,WAFU;AAAA,QAEGC,aAFH,GAKRF,MALQ,CAEGE,aAFH;AAAA,QAEkBC,mBAFlB,GAKRH,MALQ,CAEkBG,mBAFlB;AAAA,QAGVC,GAHU,GAKRJ,MALQ,CAGVI,GAHU;AAAA,QAGLC,cAHK,GAKRL,MALQ,CAGLK,cAHK;AAAA,QAIVC,aAJU,GAKRN,MALQ,CAIVM,aAJU;AAAA,QAIKC,UAJL,GAKRP,MALQ,CAIKO,UAJL;AAAA,8BAKRP,MALQ,CAIiBQ,WAJjB;AAAA,QAIiBA,WAJjB,uCAI6B,CAJ7B;AAAA,+BAKRR,MALQ,CAIgCS,YAJhC;AAAA,QAIgCA,YAJhC,wCAI6C,CAJ7C;;AAMlBC,UAAMN,GAAN,EACGO,IADH,CACQ,UAACC,QAAD,EAAc;AAAA,UACVC,MADU,GACYD,QADZ,CACVC,MADU;AAAA,UACFC,UADE,GACYF,QADZ,CACFE,UADE;;AAEjB,UAAID,UAAQ,GAAR,IAAeA,SAAO,GAA1B,EAA8B;AAC3B,eAAOD,SAASG,IAAT,EAAP;AACF,OAFD,MAEO,IAAIF,UAAQ,GAAR,IAAeA,SAAO,GAA1B,EAA8B;AAClCrB,2BAAmB,eAAnB,EAAoCqB,SAAS,GAAT,GAAeC,UAAnD;AACAP,mBAAW,IAAX,EAAiBL,aAAjB,EAAgCC,mBAAhC;AACA,eAAO,IAAP;AACF,OAJM,MAIA,IAAIU,UAAQ,GAAR,IAAeA,SAAO,GAA1B,EAA+B;AACpC,YAAIL,gBAAgB,CAApB,EAAuB;AACrBR,iBAAOQ,WAAP,GAAqBA,cAAc,CAAnC;AACA,gBAAKQ,cAAL,GAAsBC,WAAY,MAAKlB,YAAL,CAAkBC,MAAlB,CAAZ,EAAuC,GAAvC,CAAtB;AACD,SAHD,MAGO;AACJR,6BAAmB,eAAnB,EAAoCqB,SAAS,GAAT,GAAeC,UAAnD;AACAP,qBAAW,IAAX,EAAiBL,aAAjB,EAAgCC,mBAAhC;AACF;AACD,eAAO,IAAP;AACD;AACH,KAnBH,EAoBGQ,IApBH,CAoBQ,UAACI,IAAD,EAAU;AACd,UAAIA,IAAJ,EAAU;AACRT,sBAAc,EAAEL,wBAAF,EAAeC,4BAAf,EAA8Ba,UAA9B,EAAoCV,8BAApC,EAAd;AACD;AACF,KAxBH,EAyBGa,KAzBH,CAyBS,UAACC,KAAD,EAAW;AAChB,UAAIV,iBAAiB,CAArB,EAAuB;AACpBF,mBAAWY,KAAX,EAAkBjB,aAAlB,EAAiCC,mBAAjC;AACF,OAFD,MAEO;AACLH,eAAOS,YAAP,GAAsBA,eAAe,CAArC;AACA,cAAKO,cAAL,GAAsBC,WAAY,MAAKlB,YAAL,CAAkBC,MAAlB,CAAZ,EAAuC,GAAvC,CAAtB;AACD;AACF,KAhCH;AAiCD,GAxCsB;AA0CvBoB,yBA1CuB,yCA0CsD;AAAA,QAAnDnB,WAAmD,QAAnDA,WAAmD;AAAA,QAAtCC,aAAsC,QAAtCA,aAAsC;AAAA,QAAvBa,IAAuB,QAAvBA,IAAuB;AAAA,QAAjBV,cAAiB,QAAjBA,cAAiB;;AAC3E,QAAIJ,eAAeI,cAAnB,EAAmC;AAAA;;AAChC,WAAKgB,QAAL,6CACGnB,aADH,EACoB,KADpB,8BAEGD,WAFH,EAEkBc,KAAKV,cAAL,CAFlB;AAIF;AACF,GAjDsB;AAkDvBiB,sBAlDuB,gCAkDFH,KAlDE,EAkDKjB,aAlDL,EAkDoBC,mBAlDpB,EAkDwC;AAAA;;AAC7D,SAAKkB,QAAL,+CACInB,aADJ,EACqB,KADrB,+BAEIC,mBAFJ,EAE2B,IAF3B;AAIA,QAAIgB,iBAAiBI,SAArB,EAA+B;AAC7B/B,yBACG,cAAIgC,KAAJ,CAAUC,aAAV,CAAwBC,OAD3B,EAEG,cAAIF,KAAJ,CAAUC,aAAV,CAAwBE,KAF3B;AAID;AACF,GA7DsB;AA+DvBC,yBA/DuB,mCAgElB3B,WAhEkB,EAkErB;AAAA,QAFgBC,aAEhB,uEAF8B,WAE9B;AAAA,QAF2CC,mBAE3C,uEAF+D,iBAE/D;AAAA,QADG0B,SACH;AAAA,QADcxB,cACd;;AACA,QAAI,KAAKyB,KAAL,CAAWD,SAAX,IAAwBA,SAA5B,EAAuC;AAAA;;AACrC,UAAME,OAAQF,SAAD,GAAcA,SAAd,GAA0B,KAAKC,KAAL,CAAWD,SAAlD;AAAA,UACMG,YAAa3B,cAAD,GAAmBA,cAAnB,GAAoC,KAAKyB,KAAL,CAAWG,eADjE;AAEA,WAAKZ,QAAL,+CACOnB,aADP,EACsB,IADtB,+BAC6BC,mBAD7B,EACmD,KADnD,gBAEK,KAAKJ,YAAL,CAAkB;AAChBE,gCADgB,EACHC,4BADG,EACYC,wCADZ;AAEhBC,aAAM2B,IAFU;AAGhB1B,wBAAiB2B,SAHD;AAIhB1B,uBAAgB,KAAKc,uBAJL;AAKhBb,oBAAY,KAAKe;AALD,OAAlB,CAFL;AAUD;AACF,GAjFsB;AAkFvBY,yBAlFuB,qCAkFE;AACvB,QAAI,KAAKlB,cAAT,EAAwB;AACtBmB,mBAAa,KAAKnB,cAAlB;AACD;AACF;AAtFsB,CAAzB;;kBAyFelB,e","file":"WithLoadOptions.js","sourcesContent":["\r\n\r\nimport Msg from '../../constants/Msg';\r\nimport ComponentActions from '../../flux/actions/ComponentActions';\r\nimport {ModalDialog} from '../../constants/Type';\r\n\r\nconst _fnShowAlertDialog = function(alertCaption, alertDescr){\r\n  const modalDialogType = ModalDialog.ALERT;\r\n  ComponentActions.showModalDialog(\r\n    ModalDialog.ALERT, { alertCaption, alertDescr, modalDialogType }\r\n  );\r\n}\r\n\r\nconst WithLoadOptions =  {\r\n  _loadOptions(option){\r\n    const {\r\n            toStateProp, isLoadingProp, isLoadingFailedProp,\r\n            uri, optionJsonProp,\r\n            fnOnCompleted, fnOnFailed, retryServer=3, retryNetwork=1\r\n          } = option;\r\n    fetch(uri)\r\n      .then((response) => {\r\n         const {status, statusText} = response;\r\n         if (status>=200 && status<400){\r\n            return response.json();\r\n         } else if (status>=400 && status<500){\r\n            _fnShowAlertDialog('Client Error:', status + ' ' + statusText);\r\n            fnOnFailed(null, isLoadingProp, isLoadingFailedProp);\r\n            return null;\r\n         } else if (status>=500 && status<600) {\r\n           if (retryServer !== 0) {\r\n             option.retryServer = retryServer - 1;\r\n             this._loadOptionsID = setTimeout( this._loadOptions(option), 3E3);\r\n           } else {\r\n              _fnShowAlertDialog('Server Error:', status + ' ' + statusText);\r\n              fnOnFailed(null, isLoadingProp, isLoadingFailedProp);\r\n           }\r\n           return null;\r\n         }\r\n      })\r\n      .then((json) => {\r\n        if (json) {\r\n          fnOnCompleted({ toStateProp, isLoadingProp, json, optionJsonProp });\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        if (retryNetwork === 0){\r\n           fnOnFailed(error, isLoadingProp, isLoadingFailedProp);\r\n        } else {\r\n          option.retryNetwork = retryNetwork - 1;\r\n          this._loadOptionsID = setTimeout( this._loadOptions(option), 2E3);\r\n        }\r\n      })\r\n  },\r\n\r\n  _onLoadOptionsCompleted({ toStateProp, isLoadingProp, json, optionJsonProp }){\r\n    if (toStateProp && optionJsonProp) {\r\n       this.setState({\r\n         [isLoadingProp] : false,\r\n         [toStateProp] : json[optionJsonProp]\r\n       });\r\n    }\r\n  },\r\n  _onLoadOptionsFailed(error, isLoadingProp, isLoadingFailedProp){\r\n    this.setState({\r\n       [isLoadingProp] : false,\r\n       [isLoadingFailedProp] : true\r\n    })    \r\n    if (error instanceof TypeError){\r\n      _fnShowAlertDialog(\r\n         Msg.Alert.NETWORK_ERROR.caption,\r\n         Msg.Alert.NETWORK_ERROR.descr\r\n       );\r\n    }\r\n  },\r\n\r\n  _handlerWithLoadOptions(\r\n       toStateProp, isLoadingProp='isLoading', isLoadingFailedProp='isLoadingFailed',\r\n       optionURI, optionJsonProp\r\n   ){\r\n    if (this.props.optionURI || optionURI) {\r\n      const _uri = (optionURI) ? optionURI : this.props.optionURI\r\n          , _jsonProp = (optionJsonProp) ? optionJsonProp : this.props.optionsJsonProp;\r\n      this.setState(\r\n           {[isLoadingProp]:true, [isLoadingFailedProp]: false},\r\n           this._loadOptions({\r\n             toStateProp, isLoadingProp, isLoadingFailedProp,\r\n             uri : _uri,\r\n             optionJsonProp : _jsonProp,\r\n             fnOnCompleted : this._onLoadOptionsCompleted,\r\n             fnOnFailed: this._onLoadOptionsFailed\r\n           })\r\n      );\r\n    }\r\n  },\r\n  _unmountWithLoadOptions(){\r\n    if (this._loadOptionsID){\r\n      clearTimeout(this._loadOptionsID)\r\n    }\r\n  }\r\n};\r\n\r\nexport default WithLoadOptions\r\n"]}