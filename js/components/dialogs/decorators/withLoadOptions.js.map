{"version":3,"sources":["../../../../src/components/dialogs/decorators/withLoadOptions.js"],"names":["_fnShowAlertDialog","alertCaption","alertDescr","modalDialogType","ALERT","showModalDialog","_loadOptions","option","target","toStateProp","isLoadingProp","isLoadingFailedProp","uri","optionJsonProp","fnOnCompleted","fnOnFailed","retryServer","retryNetwork","fetch","then","response","status","statusText","json","_loadOptionsID","setTimeout","catch","error","_onLoadOptionsCompleted","dfColumns","setState","_isDfColumns","_onLoadOptionsFailed","TypeError","Alert","NETWORK_ERROR","caption","descr","_handlerWithLoadOptions","optionURI","props","_uri","_jsonProp","optionsJsonProp","_unmountWithLoadOptions","clearTimeout","withLoadOptions","Object","assign","prototype"],"mappings":"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","file":"withLoadOptions.js","sourcesContent":["\r\nimport Msg from '../../../constants/Msg';\r\nimport ComponentActions from '../../../flux/actions/ComponentActions';\r\nimport {ModalDialog} from '../../../constants/Type';\r\n\r\nconst _fnShowAlertDialog = function(alertCaption, alertDescr){\r\n  const modalDialogType = ModalDialog.ALERT;\r\n  ComponentActions.showModalDialog(\r\n    ModalDialog.ALERT, { alertCaption, alertDescr, modalDialogType }\r\n  )\r\n};\r\n\r\nconst _loadOptions = function(option){\r\n  const {\r\n          target,\r\n          toStateProp, isLoadingProp, isLoadingFailedProp,\r\n          uri, optionJsonProp,\r\n          fnOnCompleted, fnOnFailed, retryServer=3, retryNetwork=1\r\n        } = option;\r\n  fetch(uri)\r\n    .then((response) => {\r\n       const {status, statusText} = response;\r\n       if (status>=200 && status<400){\r\n          return response.json();\r\n       } else if (status>=400 && status<500){\r\n          _fnShowAlertDialog('Client Error:', status + ' ' + statusText)\r\n          fnOnFailed(target, {isLoadingProp, isLoadingFailedProp})\r\n          return null;\r\n       } else if (status>=500 && status<600) {\r\n         if (retryServer !== 0) {\r\n           option.retryServer = retryServer - 1\r\n           target._loadOptionsID = setTimeout( _loadOptions(option), 3E3)\r\n         } else {\r\n            _fnShowAlertDialog('Server Error:', status + ' ' + statusText)\r\n            fnOnFailed(target, { isLoadingProp, isLoadingFailedProp })\r\n         }\r\n         return null;\r\n       }\r\n    })\r\n    .then((json) => {\r\n      if (json) {\r\n        fnOnCompleted(target, { toStateProp, isLoadingProp, json, optionJsonProp })\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      if (retryNetwork === 0){\r\n         fnOnFailed(target, {error, isLoadingProp, isLoadingFailedProp});\r\n      } else {\r\n        option.retryNetwork = retryNetwork - 1;\r\n        target._loadOptionsID = setTimeout( _loadOptions(option), 2E3);\r\n      }\r\n    })\r\n}\r\n\r\nconst _onLoadOptionsCompleted = function(\r\n   target, {toStateProp, isLoadingProp, json, optionJsonProp}\r\n ){\r\n  if (toStateProp && optionJsonProp) {\r\n     if (!json.dfColumns) {\r\n       target.setState({\r\n         [isLoadingProp]: false,\r\n         [toStateProp]: json[optionJsonProp]\r\n       });\r\n     } else {\r\n       target._isDfColumns = true\r\n       target.setState({\r\n         [isLoadingProp]: false,\r\n         [toStateProp]: json[optionJsonProp],\r\n         childOptions: json.dfColumns\r\n       });\r\n     }\r\n  }\r\n}\r\n\r\nconst _onLoadOptionsFailed = function(\r\n  target, { error, isLoadingProp, isLoadingFailedProp }\r\n){\r\n  target.setState({\r\n     [isLoadingProp] : false,\r\n     [isLoadingFailedProp] : true\r\n  })\r\n  if (error instanceof TypeError){\r\n    _fnShowAlertDialog(\r\n       Msg.Alert.NETWORK_ERROR.caption,\r\n       Msg.Alert.NETWORK_ERROR.descr\r\n     );\r\n  }\r\n}\r\n\r\nconst _handlerWithLoadOptions = function(\r\n  toStateProp, isLoadingProp='isLoading', isLoadingFailedProp='isLoadingFailed',\r\n  optionURI, optionJsonProp\r\n){\r\n  if (this.props.optionURI || optionURI) {\r\n    const _uri = (optionURI)\r\n             ? optionURI\r\n             : this.props.optionURI\r\n        , _jsonProp = (optionJsonProp)\r\n             ? optionJsonProp\r\n             : this.props.optionsJsonProp;\r\n    this.setState(\r\n         {[isLoadingProp]:true, [isLoadingFailedProp]: false},\r\n         _loadOptions({\r\n            target : this,\r\n            toStateProp, isLoadingProp, isLoadingFailedProp,\r\n            uri : _uri,\r\n            optionJsonProp : _jsonProp,\r\n            fnOnCompleted : _onLoadOptionsCompleted,\r\n            fnOnFailed: _onLoadOptionsFailed\r\n         })\r\n    );\r\n  }\r\n}\r\nconst _unmountWithLoadOptions = function(){\r\n  if (this._loadOptionsID){\r\n    clearTimeout(this._loadOptionsID)\r\n  }\r\n}\r\n\r\nconst withLoadOptions = (target) => {\r\n  Object.assign(target.prototype, {\r\n    _handlerWithLoadOptions,\r\n    _unmountWithLoadOptions\r\n  })\r\n}\r\n\r\nexport default withLoadOptions\r\n"]}