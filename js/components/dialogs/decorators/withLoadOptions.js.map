{"version":3,"sources":["../../../../src/components/dialogs/decorators/withLoadOptions.js"],"names":["NETWORK_ERROR","Msg","Alert","_showMsgErr","alertCaption","alertDescr","CA","showAlert","_loadOptions","option","target","toStateProp","uri","optionJsonProp","fnOnCompleted","fnOnFailed","retryServer","retryNetwork","fetch","then","response","status","statusText","json","_loadOptionsID","setTimeout","error","_onLoadOptionsCompleted","dfColumns","items","propCaption","setState","isLoading","_isDfColumns","twoOptions","_onLoadOptionsFailed","isLoadingFailed","TypeError","caption","descr","_handlerWithLoadOptions","optionURI","_uri","props","_jsonProp","optionsJsonProp","_unmountWithLoadOptions","clearTimeout","withLoadOptions","Object","assign","prototype"],"mappings":"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","sourcesContent":["\r\nimport Msg from '../../../constants/Msg';\r\nimport CA from '../../../flux/actions/ComponentActions';\r\n\r\nimport crOptions from './crOptions'\r\n\r\nconst NETWORK_ERROR = Msg.Alert.NETWORK_ERROR;\r\n\r\nconst _showMsgErr = function(alertCaption, alertDescr){\r\n  CA.showAlert({ alertCaption, alertDescr })\r\n};\r\n\r\nconst _loadOptions = function(option){\r\n  const {\r\n    target,\r\n    toStateProp,\r\n    uri, optionJsonProp,\r\n    fnOnCompleted, fnOnFailed,\r\n    retryServer=3, retryNetwork=1\r\n  } = option;\r\n  fetch(uri)\r\n    .then(response => {\r\n       const {status, statusText} = response;\r\n       if (status>=200 && status<400){\r\n          return response.json();\r\n       } else if (status>=400 && status<500){\r\n          _showMsgErr('Client Error:', status + ' ' + statusText)\r\n          fnOnFailed(target)\r\n          return null;\r\n       } else if (status>=500 && status<600) {\r\n         if (retryServer !== 0) {\r\n           option.retryServer = retryServer - 1\r\n           target._loadOptionsID = setTimeout( _loadOptions(option), 3E3)\r\n         } else {\r\n            _showMsgErr('Server Error:', status + ' ' + statusText)\r\n            fnOnFailed(target)\r\n         }\r\n         return null;\r\n       }\r\n    })\r\n    .then((json) => {\r\n      if (json) {\r\n        fnOnCompleted(target, { toStateProp, json, optionJsonProp })\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      if (retryNetwork === 0){\r\n         fnOnFailed(target, error);\r\n      } else {\r\n        option.retryNetwork = retryNetwork - 1;\r\n        target._loadOptionsID = setTimeout( _loadOptions(option), 2E3);\r\n      }\r\n    })\r\n}\r\n\r\nconst _onLoadOptionsCompleted = function(\r\n   target, { toStateProp, json, optionJsonProp }\r\n ){\r\n  if (toStateProp && optionJsonProp) {\r\n     if (!json.dfColumns) {\r\n       const {\r\n         items,\r\n         propCaption\r\n       } = crOptions(json, optionJsonProp);\r\n       target.setState({\r\n         isLoading: false, propCaption,\r\n         [toStateProp]: items\r\n       });\r\n     } else {\r\n       target._isDfColumns = true\r\n       target.setState({\r\n         isLoading: false,\r\n         [toStateProp]: json[optionJsonProp],\r\n         twoOptions: json.dfColumns\r\n       });\r\n     }\r\n  }\r\n}\r\n\r\nconst _onLoadOptionsFailed = function(target, error ){\r\n  target.setState({\r\n     isLoading: false,\r\n     isLoadingFailed: true\r\n  })\r\n  if (error instanceof TypeError){\r\n    _showMsgErr(\r\n       NETWORK_ERROR.caption,\r\n       NETWORK_ERROR.descr\r\n     );\r\n  }\r\n};\r\n\r\nconst _handlerWithLoadOptions = function(\r\n  toStateProp,\r\n  optionURI, optionJsonProp\r\n){\r\n  const _uri = optionURI || this.props.optionURI;\r\n  if (_uri) {\r\n    const _jsonProp = optionJsonProp\r\n      || this.props.optionsJsonProp;\r\n    this.setState({\r\n      isLoading: true,\r\n      isLoadingFailed: false\r\n    }, _loadOptions({\r\n        target: this,\r\n        toStateProp,\r\n        uri: _uri,\r\n        optionJsonProp: _jsonProp,\r\n        fnOnCompleted: _onLoadOptionsCompleted,\r\n        fnOnFailed: _onLoadOptionsFailed\r\n      })\r\n    );\r\n  }\r\n}\r\nconst _unmountWithLoadOptions = function(){\r\n  if (this._loadOptionsID){\r\n    clearTimeout(this._loadOptionsID)\r\n  }\r\n}\r\n\r\nconst withLoadOptions = (target) => {\r\n  Object.assign(target.prototype, {\r\n    _handlerWithLoadOptions,\r\n    _unmountWithLoadOptions\r\n  })\r\n}\r\n\r\nexport default withLoadOptions\r\n"],"file":"withLoadOptions.js"}