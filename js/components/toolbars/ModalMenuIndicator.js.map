{"version":3,"sources":["../../../src/components/toolbars/ModalMenuIndicator.jsx"],"names":["crMomAthConfig","IndicatorBuilder","C_GROW","MOM_ATH","S_PANE","width","margin","_isFn","fn","_isSeriaInst","s","setVisible","FNS","GR","growthRate","CH","changesBetween","NORM","normalize","NORM_CAPTION_EL","_isNumber","n","_getSeriaIndex","chart","_index","series","length","_crName","prefixStr","nOrObj","_suffix","ModalMenuIndicator","Component","constructor","props","_handleAddMomAth","getChart","config","onAddMfi","setState","isMomAth","_handleRemoveMomAth","onRemoveMfi","_isMfi","zhIsMfi","_isMomAth","zhIsMomAth","_addGrowRate","_addSeriaBy","bind","_removeGrowRate","_hideSeriaBy","_addChanges","_removeChanges","_addNormalize","_removeNormalize","state","isGrowthRate","isNormalize","confArr","seriaOptions","fnOptions","seriaPropName","statePropName","color","name","_seria","_chart","seriaIndex","data","seriaData","zhAddSeriaToYAxis","isRemove","yAxis","remove","render","isShow","style","onClose","zhConfig","isWithoutSma","isChanges","S_MODAL_MENU","defaultProps"],"mappings":"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","sourcesContent":["import { Component } from 'react';\r\n//import PropTypes from \"prop-types\";\r\n\r\nimport {\r\n  growthRate,\r\n  changesBetween,\r\n  normalize\r\n} from '../../math/seriaFn';\r\nimport IndicatorBuilder from '../../charts/IndicatorBuilder'\r\n\r\nimport ModalPopup from '../zhn-moleculs/ModalPopup'\r\n\r\nimport RowType1 from './RowType1'\r\nimport RowPlusMinus from './RowPlusMinus'\r\nimport RowSma from './RowSma'\r\nimport RowMfi from './RowMfi'\r\n\r\nimport { S_MODAL_MENU } from './ModalMenu.Style'\r\n\r\nconst { crMomAthConfig } = IndicatorBuilder;\r\n\r\nconst C_GROW = '#90ed7d'\r\n, MOM_ATH = 'MOM_ATH'\r\n, S_PANE = {\r\n   width: 265,\r\n   margin: 8\r\n};\r\n\r\nconst _isFn = fn => typeof fn === 'function';\r\n\r\nconst _isSeriaInst = (s) => s && _isFn(s.setVisible);\r\n\r\nconst FNS = {\r\n  GR: ['ROC', 'isGrowthRate', C_GROW, growthRate, true],\r\n  CH: ['DIFF', 'isChanges', C_GROW, changesBetween, true],\r\n  NORM: ['NORM', 'isNormalize', C_GROW, normalize, false]\r\n};\r\n\r\n/*\r\nconst DEF_GROWTH_RATE = (\r\n  <>Def: 100*(&Delta;y<sub>t1-t0</sub>/y<sub>t0</sub>)</>\r\n);\r\n*/\r\n\r\nconst NORM_CAPTION_EL = (\r\n  <>\r\n    Normalize (100*y<sub>t</sub>/y<sub>0</sub>)\r\n  </>\r\n);\r\n\r\nconst _isNumber = n => typeof n === 'number'\r\n\r\nconst _getSeriaIndex = (chart, { s }) => {\r\n  const _index = _isNumber(s) ? s - 1 : 0;\r\n  return chart?.series.length > _index\r\n    ? _index\r\n    : 0;\r\n}\r\n\r\nconst _crName = (prefixStr, nOrObj) => {\r\n  const _suffix = _isNumber(nOrObj)\r\n    ? `(${nOrObj})`\r\n    : '';\r\n  return `${prefixStr}${_suffix}`;\r\n};\r\n\r\nclass ModalMenuIndicator extends Component {\r\n  /*\r\n  static propTypes = {\r\n    rootStyle: PropTypes.object,\r\n    config: PropTypes.object,\r\n    getChart: PropTypes.func,\r\n    onAddMfi: PropTypes.func,\r\n    onRemoveMfi: PropTypes.func,\r\n  }\r\n  */\r\n\r\n  static defaultProps = {\r\n    getChart: () => {}\r\n  }\r\n\r\n  constructor(props){\r\n    super(props)\r\n\r\n    const { config } = props;\r\n    this._isMfi = !!config.zhIsMfi\r\n    this._isMomAth = !!config.zhIsMomAth\r\n\r\n    this._addGrowRate = this._addSeriaBy\r\n     .bind(this, FNS.GR)\r\n    this._removeGrowRate = this._hideSeriaBy\r\n     .bind(this, FNS.GR)\r\n\r\n     this._addChanges = this._addSeriaBy\r\n      .bind(this, FNS.CH)\r\n     this._removeChanges = this._hideSeriaBy\r\n      .bind(this, FNS.CH)\r\n\r\n     this._addNormalize = this._addSeriaBy\r\n      .bind(this, FNS.NORM, {})\r\n     this._removeNormalize = this._hideSeriaBy\r\n      .bind(this, FNS.NORM)\r\n\r\n    this.state = {\r\n      isGrowthRate: false,\r\n      isNormalize: false,\r\n      isMomAth: false\r\n    }\r\n  }\r\n\r\n\r\n  _addSeriaBy(confArr, seriaOptions, fnOptions) {\r\n    const seriaPropName = confArr[0]\r\n    , statePropName = confArr[1]\r\n    , color = confArr[2]\r\n    , fn = confArr[3]\r\n    , name = _crName(seriaPropName, fnOptions);\r\n    const _seria = this[seriaPropName];\r\n    if (!this._chart) {\r\n      this._chart = this.props.getChart()\r\n    }\r\n    if (this._chart) {\r\n      const seriaIndex = _getSeriaIndex(this._chart, seriaOptions);\r\n      if ( _isSeriaInst(_seria) ) {\r\n        _seria.setVisible(true)\r\n      } else {\r\n        const data = this._chart.series[seriaIndex].data\r\n            , seriaData = fn(data, fnOptions);\r\n        this[seriaPropName] = this._chart.zhAddSeriaToYAxis({\r\n          data: seriaData,\r\n          color: seriaOptions.color || color,\r\n          name\r\n        }, seriaOptions)\r\n      }\r\n      this.setState({ [statePropName]: true })\r\n    }\r\n  }\r\n\r\n  _hideSeriaBy(confArr) {\r\n    const seriaPropName = confArr[0]\r\n    , statePropName = confArr[1]\r\n    , isRemove = confArr[4]\r\n    , _seria = this[seriaPropName];\r\n    if (_isSeriaInst(_seria)) {\r\n      if (isRemove) {\r\n        _seria.yAxis.remove()\r\n        this[seriaPropName] = null\r\n      } else {\r\n        _seria.setVisible(false)\r\n      }\r\n      this.setState({ [statePropName]: false })\r\n    }\r\n  }\r\n\r\n  _handleAddMomAth = () => {\r\n    const chart = this.props.getChart()\r\n    , config = crMomAthConfig(chart)\r\n    if (config) {\r\n      this.props.onAddMfi(config, MOM_ATH)\r\n      this.setState({ isMomAth: true })\r\n    }\r\n  }\r\n  _handleRemoveMomAth = () => {\r\n    this.props.onRemoveMfi(MOM_ATH)\r\n    this.setState({ isMomAth: false })\r\n  }\r\n\r\n render(){\r\n    const {\r\n      isShow, style, config,\r\n      getChart, onClose,\r\n      onAddMfi, onRemoveMfi\r\n    } = this.props\r\n    , { zhConfig={} } = config\r\n    , { isWithoutSma } = zhConfig\r\n    , {\r\n      isGrowthRate,\r\n      isChanges,\r\n      isNormalize,\r\n      isMomAth\r\n    } = this.state;\r\n    return (\r\n      <ModalPopup\r\n        style={{...S_MODAL_MENU, ...style}}\r\n        isShow={isShow}\r\n        onClose={onClose}\r\n      >\r\n        <div style={S_PANE}>\r\n          <RowType1\r\n            is={isChanges}\r\n            caption=\"Changes Between\"\r\n            onMinus={this._removeChanges}\r\n            onPlus={this._addChanges}\r\n          />\r\n          <RowType1\r\n            is={isGrowthRate}\r\n            caption=\"Growth Rate\"\r\n            //Def={DEF_GROWTH_RATE}\r\n            onMinus={this._removeGrowRate}\r\n            onPlus={this._addGrowRate}\r\n          />\r\n          <RowPlusMinus\r\n            is={isNormalize}\r\n            caption={NORM_CAPTION_EL}\r\n            onMinus={this._removeNormalize}\r\n            onPlus={this._addNormalize}\r\n          />\r\n          {!isWithoutSma && <RowSma\r\n              config={config}\r\n              getChart={getChart}\r\n            />\r\n          }\r\n          {this._isMfi && <RowMfi\r\n              getChart={getChart}\r\n              onAddMfi={onAddMfi}\r\n              onRemoveMfi={onRemoveMfi}\r\n           />\r\n          }\r\n          {this._isMomAth && <RowPlusMinus\r\n             is={isMomAth}\r\n             caption=\"MOM(1) & ATH\"\r\n             onPlus={this._handleAddMomAth}\r\n             onMinus={this._handleRemoveMomAth}\r\n           />\r\n          }\r\n        </div>\r\n      </ModalPopup>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ModalMenuIndicator\r\n"],"file":"ModalMenuIndicator.js"}