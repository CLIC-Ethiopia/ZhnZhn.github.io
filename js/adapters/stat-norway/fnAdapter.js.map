{"version":3,"sources":["../../../src/adapters/stat-norway/fnAdapter.js"],"names":["isYNumber","AdapterFn","numberFormat","crId","roundBy","valueMoving","crItemConf","TITLE","NST","SWS","SEARCH","url","title","SFL","DF_SOURCE","MAX_SOURCE_ID_LENGTH","_crSearchToken","label","_arr","toString","split","_crLink","token","_crToken","dfId","arr","id","pop","prefix","join","_crSearchLink","option","_token","loadId","_crDescr","updated","source","_date","replace","_elSearchLink","_crItemCaption","items","caption","_crAreaMapSlice","dfTSlice","mapSlice","forEach","item","slice","Object","assign","_getDimensionWithouTime","ds","_dim","Dimension","_getTimeDimension","timeId","_dimTimeId","times","_crDataSource","dataSource","length","fnAdapter","crValueMoving","crTitle","browserType","crDsValuesTimes","json","Dataset","values","Data","crTid","time","tidIds","crInfo","name","description","crZhConfig","_itemKey","optionFetch","key","itemCaption","itemConf","crConfOption","info","zhConfig","crChartOption","data"],"mappings":"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","sourcesContent":["import JSONstat from 'jsonstat';\r\n\r\nimport AdapterFn from '../AdapterFn';\r\n\r\nconst {\r\n  isYNumber,\r\n  numberFormat,\r\n  crId,\r\n  roundBy,\r\n  valueMoving,\r\n  crItemConf\r\n} = AdapterFn;\r\n\r\nconst TITLE = {\r\n  NST: 'Statisctics Norway: All Items',\r\n  SWS: 'Statisctics Sweden: All Items'\r\n};\r\n\r\nconst SEARCH = {\r\n  NST: {\r\n    url: 'https://www.ssb.no/en/sok?sok=',\r\n    title: 'Statistics Norway Search'\r\n  },\r\n  SWS: {\r\n    url: 'https://www.scb.se/en/finding-statistics/search/?query=',\r\n    title: 'Statistics Sweden Search'\r\n  },\r\n  SFL: {\r\n    url: 'http://pxnet2.stat.fi/PXWeb/pxweb/en/StatFin/',\r\n    title: \"Statistics Finland's PX-Web\"\r\n  }\r\n};\r\n\r\nconst DF_SOURCE = 'Unknown';\r\nconst MAX_SOURCE_ID_LENGTH = 9;\r\n\r\nconst _crSearchToken = (label) => {\r\n  const _arr = (label || '').toString().split(',');\r\n  return _arr[0] || '';\r\n};\r\n\r\nconst _crLink = (token, {url, title}) => `<a class=\"native-link\" href=\"${url}${token}\">${title}</a>`;\r\n\r\nconst _crToken = ({ dfId }) => {\r\n  const arr = (''+dfId).split('/')\r\n  , id = arr.pop()\r\n  , prefix = arr.join('__');\r\n  return prefix && id ? `StatFin__${prefix}/${id}` : '';\r\n}\r\n\r\nconst _crSearchLink = (label, option) => {\r\n  const  _token = _crSearchToken(label);\r\n  switch(option.loadId){\r\n    case 'NST': case 'NST_2':\r\n      return _crLink(_token, SEARCH.NST);\r\n    case 'SWS':\r\n      return _crLink(_token, SEARCH.SWS);\r\n    case 'SFL':\r\n      return _crLink(_crToken(option), SEARCH.SFL);\r\n    default:\r\n      return '';\r\n  }\r\n};\r\n\r\nconst _crDescr = ({ updated='', source=DF_SOURCE, label }, option) => {\r\n  const _date = updated\r\n    .replace('T', ' ')\r\n    .replace('Z', '')\r\n  , { dfId='' } = option\r\n  , _elSearchLink = _crSearchLink(label, option);\r\n\r\n  return `TableId: ${dfId}<BR/>${source}: ${_date}<BR/>${_elSearchLink}`;\r\n};\r\n\r\nconst _crItemCaption = (option) => {\r\n  const { items, dfId='id'} = option\r\n       , caption =  items[0]\r\n            ? items[0].caption\r\n            : 'All Items';\r\n  return `${dfId}_${caption}`;\r\n}\r\n\r\nconst _crAreaMapSlice = (option) => {\r\n  const { items, dfTSlice } = option\r\n      , mapSlice = {};\r\n  items.forEach(item => {\r\n    if (item.slice) {\r\n      Object.assign(mapSlice, item.slice)\r\n    }\r\n  })\r\n  return Object.assign(mapSlice, dfTSlice)\r\n};\r\n\r\n\r\nconst _getDimensionWithouTime = (ds) => {\r\n  const _dim = ds.Dimension(\"Year\")\r\n   || ds.Dimension(\"Vuosi\")\r\n   || ds.Dimension(\"VuosineljÃ¤nnes\")\r\n   || ds.Dimension(\"Month\");\r\n  return _dim && _dim.id\r\n    ? [_dim.id[0]]\r\n    : [\"2019\"];\r\n};\r\n\r\nconst _getTimeDimension = (ds, timeId) => {\r\n  const _dimTimeId = timeId && ds.Dimension(timeId)\r\n  , _dim = _dimTimeId || ds.Dimension(\"Tid\")\r\n  , times = _dim && _dim.id\r\n     || _getDimensionWithouTime(ds);\r\n\r\n  return times;\r\n}\r\n\r\nconst _crDataSource = ({ dataSource, dfId }) => dfId\r\n && (''+dfId).length < MAX_SOURCE_ID_LENGTH\r\n   ? `${dataSource} (${dfId})`\r\n   : dataSource;\r\n\r\n\r\nconst fnAdapter = {\r\n  isYNumber, numberFormat, crId, roundBy,\r\n  crValueMoving: valueMoving,\r\n\r\n  crTitle: (option) => {\r\n    switch(option.browserType){\r\n      case 'NST':\r\n      case 'NST_ALL':\r\n        return TITLE.NST;\r\n      case 'SWS':\r\n      case 'SWS_ALL':\r\n        return TITLE.SWS;\r\n      default:\r\n        return '';\r\n    }\r\n  },\r\n\r\n  crDsValuesTimes: (json, option) => {\r\n    const mapSlice = _crAreaMapSlice(option)\r\n        , ds = JSONstat(json).Dataset(0)\r\n        , values = ds.Data(mapSlice)\r\n        , times = _getTimeDimension(ds, option.timeId);\r\n    return { ds, values, times };\r\n  },\r\n\r\n  crTid: (time, ds) => {\r\n    if (time) {\r\n      return time;\r\n    }\r\n    const tidIds = _getTimeDimension(ds);\r\n    return tidIds[tidIds.length-1];\r\n  },\r\n\r\n  crInfo: (ds, option) => ({\r\n    name: ds.label || '',\r\n    description: _crDescr(ds, option)\r\n  }),\r\n\r\n  crZhConfig: (option) => {\r\n    const {\r\n      _itemKey, url,\r\n      optionFetch, items,\r\n      dataSource, dfId, timeId\r\n    } = option\r\n    , key = _itemKey || crId()\r\n    , itemCaption = option.itemCaption || _crItemCaption(option)\r\n    , itemConf = url\r\n       ? {\r\n         _itemKey: key,\r\n         ...crItemConf(option),\r\n         optionFetch, items,\r\n         dataSource,\r\n         //sfl\r\n         dfId, timeId\r\n        }\r\n      : void 0;\r\n    return {\r\n      id: key, key,\r\n      itemCaption,\r\n      itemConf,\r\n      dataSource: _crDataSource(option)\r\n    };\r\n  },\r\n\r\n  crConfOption: (ds, option) => ({\r\n    info: fnAdapter.crInfo(ds, option),\r\n    zhConfig: fnAdapter.crZhConfig(option)\r\n  }),\r\n\r\n  crChartOption: (ds, data, option) => ({\r\n    valueMoving: fnAdapter.crValueMoving(data),\r\n    ...fnAdapter.crConfOption(ds, option)    \r\n  })\r\n}\r\n\r\nexport default fnAdapter\r\n"],"file":"fnAdapter.js"}