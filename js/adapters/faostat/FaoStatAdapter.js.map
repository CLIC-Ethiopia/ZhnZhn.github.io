{"version":3,"sources":["../../../src/adapters/faostat/FaoStatAdapter.js"],"names":["_crZhConfig","id","dfDomain","oneCaption","key","isWithoutIndicator","isWithoutAdd","dataSource","linkFn","item","itemCaption","_crId","three","value","_crUnit","json","data","length","_unit","Unit","undefined","DATASET_EMPTY","ONE_BLANK","toUpperCase","substr","_crSubtitle","subtitle","_crPoint","Year","Value","x","ymdToUTC","MM_DD","y","_crHm","hm","Object","create","forEach","Area","seriaName","push","_compareByY","a","b","_crRefLegend","legend","propName","_arr","sort","reverse","_hmToPoints","arr","r","_crSeriesData","_hm","_legend","_crSeriaData","option","points","_toDataPoints","one","indexOf","_checkToSeries","FaoStatAdapter","toConfig","title","_id","_subtitle","_points","config","initBaseArea","add","spacingTop","addCaption","addPoints","addTooltip","fnBasePointFormatter","toInfo","toSeries","parentId","_isAllow","Error","initBaseSeria","_data","zhSeriaId","zhValueText","zhItemCaption"],"mappings":"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","file":"FaoStatAdapter.js","sourcesContent":["\r\n\r\nimport ConfigBuilder from '../../charts/ConfigBuilder'\r\nimport Tooltip from '../../charts/Tooltip'\r\nimport AdapterFn from '../AdapterFn'\r\n\r\nimport fnDescr from './fnDescr'\r\n\r\nimport C from './conf'\r\n\r\nconst _crZhConfig = (id, { dfDomain, oneCaption }) => ({\r\n  id: id,\r\n  key: id,\r\n  isWithoutIndicator: true,\r\n  isWithoutAdd: true,\r\n  dataSource: \"FAOSTAT\",\r\n  linkFn: \"FAO_STAT\",\r\n  item: dfDomain,\r\n  itemCaption: oneCaption\r\n});\r\n\r\nconst _crId = ({ three, value }) => three ? value + '_' + three : value;\r\n\r\nconst _crUnit = (json) => {\r\n  const { data=[] } = json\r\n  , item = data[data.length-1] || {}\r\n  , _unit = item.Unit === undefined\r\n       ? C.DATASET_EMPTY\r\n       : item.Unit ? item.Unit : C.ONE_BLANK;\r\n\r\n  return _unit[0].toUpperCase() + _unit.substr(1);\r\n};\r\n\r\nconst _crSubtitle = (json, subtitle) => {\r\n  const _unit = _crUnit(json);\r\n  return subtitle + ': ' + _unit;\r\n};\r\n\r\nconst _crPoint = ({ Year, Value }) => ({\r\n  x: AdapterFn.ymdToUTC('' + Year + C.MM_DD),\r\n  y: Value\r\n})\r\n\r\nconst _crHm = (json) => {\r\n  const { data=[]} = json\r\n  , hm = Object.create(null);\r\n\r\n  data.forEach(item => {\r\n     const { Area } = item\r\n     if (!hm[Area]) {\r\n       hm[Area] = []\r\n       hm[Area].seriaName = Area\r\n     }\r\n     hm[Area].push(_crPoint(item))\r\n  })\r\n  return hm;\r\n}\r\n\r\nconst _compareByY = (a, b) => a.y - b.y;\r\n\r\nconst _crRefLegend = (hm) => {\r\n  const legend = [];\r\n  let propName;\r\n  for(propName in hm) {\r\n    const _arr = hm[propName];\r\n    legend.push({\r\n      ..._arr[_arr.length-1],\r\n      Area: propName\r\n    })\r\n  }\r\n  return legend.sort(_compareByY).reverse();\r\n}\r\n\r\nconst _hmToPoints = (hm, arr) => {\r\n  const r = [];\r\n  arr.forEach(item => {\r\n    r.push(hm[item.Area])\r\n  })\r\n  return r;\r\n}\r\n\r\nconst _crSeriesData = (json) => {\r\n  const _hm = _crHm(json)\r\n      , _legend = _crRefLegend(_hm);\r\n\r\n  return _hmToPoints(_hm, _legend);\r\n}\r\n\r\nconst _crSeriaData = (json, option) => {\r\n  const { data=[] } = json\r\n     , points = [];\r\n  data.forEach(item => {\r\n    points.push(_crPoint(item))\r\n  })\r\n\r\n  return points;\r\n}\r\n\r\nconst _toDataPoints = (json, option) => {\r\n  const { one } = option\r\n  return ( (''+one).indexOf('>') === -1 )\r\n    ? _crSeriaData(json, option)\r\n    : _crSeriesData(json, option)\r\n}\r\n\r\nconst _checkToSeries = option => {\r\n  const { one } = option;\r\n  return ( (''+one).indexOf('>') === -1 )\r\n    ? true\r\n    : false;\r\n}\r\n\r\nconst FaoStatAdapter = {\r\n  toConfig(json, option){\r\n    const { title, subtitle } = option\r\n    , _id = _crId(option)\r\n    , _subtitle = _crSubtitle(json, subtitle)\r\n    , _points = _toDataPoints(json, option)\r\n    , config = ConfigBuilder()\r\n       .initBaseArea()\r\n       .add('chart', { spacingTop: 25 })\r\n       .addCaption(title, _subtitle)\r\n       .addPoints(_id, _points)\r\n       .addTooltip(Tooltip.fnBasePointFormatter)\r\n       .add('info', fnDescr.toInfo(json, title, _subtitle))\r\n       .add('zhConfig', _crZhConfig(_id, option))\r\n       .toConfig();\r\n    return { config };\r\n  },\r\n\r\n  toSeries(json, option){\r\n    const _data = _crSeriaData(json, option)\r\n        , _id = _crId(option)\r\n        , { parentId, oneCaption } = option\r\n        , _isAllow = _checkToSeries(option);\r\n    if (!_isAllow) {\r\n      throw new Error('ZH_1000');\r\n    }\r\n    return ConfigBuilder()\r\n      .initBaseSeria()\r\n      .add({\r\n        data: _data,\r\n        zhSeriaId: parentId + '_' + _id,\r\n        zhValueText: oneCaption,\r\n        zhItemCaption: oneCaption\r\n      })\r\n      .toConfig();\r\n  }\r\n};\r\n\r\nexport default FaoStatAdapter\r\n"]}