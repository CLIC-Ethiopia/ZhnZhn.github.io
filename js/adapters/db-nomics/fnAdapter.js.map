{"version":3,"sources":["../../../src/adapters/db-nomics/fnAdapter.js"],"names":["crError","AdapterFn","crItemLink","crItemConf","joinBy","ymdToUTC","getValue","getPeriodAndValue","fnSelector","getTitle","getSubtitle","getIndexedAt","C","CHART_URL","SUBT_MAX","_isId","id","indexOf","_crId","dfProvider","dfCode","seriaId","_getId","option","_crItemLink","bind","_crUpdatedDate","json","_date","split","_crDescr","_id","_crZhConfig","dataSource","_itemKey","title","key","itemCaption","itemConf","_crInfo","name","description","_isNumber","n","Number","isNaN","_isQuarter","str","_isAnnualQuarter","period","_crPoint","date","y","_crAqPoint","fnAdapter","crTitle","subtitle","_","_subtitle","length","crData","fromDate","frequency","data","_xFrom","value","crPoint","_len","_arrPoint","i","push","crConfigOption","zhConfig","info"],"mappings":"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","sourcesContent":["import AdapterFn from '../AdapterFn'\r\nimport fnSelector from './fnSelector'\r\n\r\nconst {\r\n  crError,\r\n  crItemLink,\r\n  crItemConf,\r\n  joinBy,\r\n  ymdToUTC,  \r\n  getValue\r\n} = AdapterFn;\r\nconst {\r\n  getPeriodAndValue,\r\n  getTitle,\r\n  getSubtitle,\r\n  getIndexedAt\r\n } = fnSelector;\r\n\r\nconst C = {\r\n  CHART_URL: 'https://db.nomics.world',\r\n  SUBT_MAX: 60\r\n};\r\n\r\n\r\nconst _isId = id => id && id.indexOf('/') !== -1;\r\nconst _crId = ({ dfProvider, dfCode, seriaId }) =>\r\n  joinBy('/', dfProvider, dfCode, seriaId);\r\nconst _getId = (option) => _isId(option.seriaId)\r\n  ? option.seriaId\r\n  : _crId(option);\r\n\r\nconst _crItemLink = crItemLink\r\n  .bind(null, 'DB Nomics Chart');\r\nconst _crUpdatedDate = json => {\r\n  const _date = getIndexedAt(json).split('T')[0]\r\n  return _date\r\n    ? `<p>Updated by DB Nomics on ${_date}</p>`\r\n    : '';\r\n};\r\nconst _crDescr = (json, option) => {\r\n  const _id = _getId(option);\r\n  return`<p>SeriaId: ${_id}</p>\r\n   ${_crUpdatedDate(json)}\r\n   ${_crItemLink(C.CHART_URL+'/'+_id)}`;\r\n};\r\n\r\nconst _crZhConfig = (option) => {\r\n  const {\r\n    dataSource, _itemKey,\r\n    dfProvider, dfCode, seriaId,\r\n    title\r\n  } = option\r\n  , _id = _itemKey || seriaId;\r\n  return {\r\n    id: _id, key: _id,\r\n    itemCaption: title,\r\n    dataSource,\r\n    itemConf: {\r\n       _itemKey: _id,\r\n       ...crItemConf(option),\r\n       dataSource,\r\n       dfProvider, dfCode, seriaId\r\n    }\r\n  }\r\n};\r\nconst _crInfo = (json, option) => ({\r\n  name: getSubtitle(json),\r\n  description: _crDescr(json, option)\r\n})\r\n\r\nconst _isNumber = n => typeof n === 'number'\r\n && !Number.isNaN(n);\r\n\r\nconst _isQuarter = str => (\"\"+str).indexOf(\"Q\") !== -1;\r\n\r\nconst _isAnnualQuarter = period =>\r\n  !_isQuarter(period[0]) && _isQuarter(period[1]);\r\n\r\nconst _crPoint = (date, y) => ([ymdToUTC(date), y]);\r\n\r\nconst _crAqPoint = (date, y) => _isQuarter(date)\r\n  ? _crPoint(date, y)\r\n  : [];\r\n\r\nconst fnAdapter = {\r\n  crError,\r\n  getValue,\r\n  crTitle: ({ title, subtitle }, json) => {\r\n    const _ = getSubtitle(json)\r\n    , _subtitle = _.length > C.SUBT_MAX\r\n         ? joinBy(': ', title, subtitle)\r\n         : _;\r\n    return {\r\n      title: getTitle(json),\r\n      subtitle: _subtitle\r\n    };\r\n  },\r\n\r\n  crData: (json, fromDate, frequency) => {\r\n    const data = []\r\n    , _xFrom = fromDate ? ymdToUTC(fromDate) : 0\r\n    , { period, value } = getPeriodAndValue(json)\r\n    , crPoint = _isAnnualQuarter(period)\r\n       ? _crAqPoint\r\n       : _crPoint\r\n    , _len = period.length;\r\n    let _arrPoint;\r\n    for (let i= 0; i<_len; i++){\r\n      _arrPoint = crPoint(period[i], value[i]);\r\n      if (_arrPoint[0] > _xFrom && _isNumber(_arrPoint[1])) {\r\n        data.push(_arrPoint)\r\n      }\r\n    }\r\n    return data;\r\n  },\r\n\r\n  crConfigOption: (json, option) => ({\r\n    zhConfig: _crZhConfig(option),\r\n    info: _crInfo(json, option)\r\n  })\r\n};\r\n\r\nexport default fnAdapter\r\n"],"file":"fnAdapter.js"}