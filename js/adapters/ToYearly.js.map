{"version":3,"sources":["../../src/adapters/ToYearly.js"],"names":["CATEGORIES","C","NOW","index","color","PREV","AVG","isVisible","RANGE","crValueMoving","fns","roundBy","numberFormat","_getYear","str","split","_getMonth","_crSeria","name","type","data","visible","_crItem","_crPoint","item","c","y","_crValuePoint","_crValueYearPoint","v","_findHighLow","arr","h","Number","NEGATIVE_INFINITY","l","POSITIVE_INFINITY","forEach","high","yHigh","low","yLow","_crHighLowPoint","key","_calcAvg","sum","reduce","acc","a","length","_crAvgPoint","_crSeriaData","i","year","crPoint","max","push","reverse","_crSeries","firtsItem","_yearNow","_dNow","prevItem","_yearPrev","_dPrev","nowSeria","nowItem","prevSeria","_hmToSeriaData","hm","_crBaseHm","Object","create","_crMonthHm","stopYear","isBreaked","_item","_y","_m","_crRangeSeria","refYear","parseFloat","_stopYear","_data","rangeSeria","areaRangeSeria","Tooltip","categoryRHLY","point","toSeria","rangeItem","_findStartYearIndex","yearStop","_crAvgSeria","yearNow","fromYear","startIndex","avgSeria","avgItem","_crZhConfig","option","legend","value","dataSource","itemCaption","_id","id","isWithoutIndicator","isWithoutAdd","_crValueAndDate","seria","date","_crValueMoving","bNowValue","bPrevValue","dateTo","moving","valueTo","isDenyToChange","toYearly","toConfig","title","subtitle","config","categoryConfig","addCaption","addSeriaBy","addTooltip","categorySimple","add","chart","spacingTop","marginTop","zhConfig","valueMoving"],"mappings":"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","sourcesContent":["import Builder from '../charts/ConfigBuilder'\r\nimport Tooltip from '../charts/Tooltip'\r\n\r\nimport fns from './AdapterFn'\r\n\r\nconst CATEGORIES = [\r\n  '01', '02', '03', '04', '05', '06',\r\n  '07', '08', '09', '10', '11', '12'\r\n];\r\n\r\nconst C = {\r\n  NOW: {\r\n    index: 3,\r\n    color: 'yellow',\r\n  },\r\n  PREV: {\r\n    index: 2,\r\n    color: '#f45b5b'\r\n  },\r\n  AVG: {\r\n    index: 1,\r\n    color: 'black',\r\n    isVisible: false\r\n  },\r\n  RANGE: {\r\n    index: 0,\r\n    color: '#7cb5ec'\r\n  }\r\n};\r\n\r\nconst {\r\n  crValueMoving,\r\n  roundBy,\r\n  numberFormat\r\n} = fns;\r\n\r\nconst _getYear = str => str.split(\"-\")[0];\r\nconst _getMonth = str => str.split(\"-\")[1];\r\n\r\nconst _crSeria = (\r\n  name, { type='spline', data, color, isVisible=true }\r\n) => ({\r\n  type, name, data, color, visible: isVisible\r\n});\r\nconst _crItem = (\r\n  name, { index, color, isVisible=true }\r\n) => ({\r\n   name, index, color, isVisible\r\n});\r\n\r\nconst _crPoint = item => ({\r\n  c: _getMonth(item[0]),\r\n  y: item[1]\r\n});\r\nconst _crValuePoint = item => item[1];\r\nconst _crValueYearPoint = item => ({\r\n  v: item[1],\r\n  y: _getYear(item[0])\r\n});\r\nconst _findHighLow = (arr) => {\r\n  let h = { v: Number.NEGATIVE_INFINITY, y: '' },\r\n      l = { v: Number.POSITIVE_INFINITY, y: '' };\r\n  arr.forEach(item => {\r\n    if (item.v > h.v) {\r\n      h = item\r\n    }\r\n    if (item.v < l.v ) {\r\n      l = item\r\n    }\r\n  })\r\n  return {\r\n    high: h.v, yHigh: h.y,\r\n    low: l.v, yLow: l.y\r\n  };\r\n}\r\nconst _crHighLowPoint = (key, arr) => {\r\n  return {\r\n      c: key,\r\n      ..._findHighLow(arr)\r\n  };\r\n}\r\nconst _calcAvg = (arr) => {\r\n  const sum = arr.reduce((acc, a) => acc + a, 0)\r\n  return arr.length !== 0\r\n    ? roundBy(sum/arr.length, 4)\r\n    : 0;\r\n};\r\nconst _crAvgPoint = (key, arr) => ({\r\n  y: _calcAvg(arr),\r\n  c: key\r\n});\r\n\r\nconst _crSeriaData = (data, i, year, crPoint=_crPoint) => {\r\n  const arr=[], max=data.length;\r\n  for (; i<max; i++){\r\n    const item = data[i]\r\n    if (_getYear(item[0]) !== year) {\r\n      break;\r\n    }\r\n    arr.push( crPoint(item) )\r\n  }\r\n  return { i, arr: arr.reverse() };\r\n}\r\n\r\nconst _crSeries = (data) => {\r\n  const firtsItem = data[0][0]\r\n      , _yearNow = _getYear(firtsItem)\r\n      , { i, arr:_dNow } = _crSeriaData(data, 0, _yearNow)\r\n      , prevItem = data[i][0]\r\n      , _yearPrev = _getYear(prevItem)\r\n      , { arr:_dPrev } = _crSeriaData(data, i, _yearPrev);\r\n\r\n  return {\r\n    nowSeria: _crSeria(_yearNow, { ...C.NOW, ...{data: _dNow} } ),\r\n    nowItem: _crItem(_yearNow, C.NOW),\r\n    prevSeria: _crSeria(_yearPrev, { ...C.PREV, ...{data: _dPrev} }),\r\n    prevItem: _crItem(_yearPrev, C.PREV)\r\n  };\r\n}\r\n\r\nconst _hmToSeriaData = (hm, crPoint) => {\r\n  const data = [];\r\n  CATEGORIES.forEach(key => {\r\n    data.push(crPoint(key, hm[key]))\r\n  })\r\n  return data;\r\n}\r\n\r\nconst _crBaseHm = () => {\r\n  const hm = Object.create(null);\r\n  CATEGORIES.forEach(key => {\r\n    hm[key] = []\r\n  })\r\n  return hm;\r\n}\r\nconst _crMonthHm = (i, data, stopYear, crPoint=_crValuePoint) => {\r\n  const hm = _crBaseHm()\r\n      , max = data.length;\r\n  let isBreaked = false;\r\n  for (;i<max;i++){\r\n    const _item = data[i]\r\n        , _y = _item[0];\r\n    if (_y === stopYear ) {\r\n      isBreaked = true\r\n      break;\r\n    }\r\n    const _m = _getMonth(_item[0])\r\n    //hm[_m].push(_item[1])\r\n    hm[_m].push(crPoint(_item))\r\n  }\r\n\r\n  return { hm, isBreaked };\r\n}\r\n\r\n\r\nconst _crRangeSeria = (data) => {\r\n  const refYear = parseFloat(_getYear(data[0][0]))\r\n      , stopYear = '' + (refYear - 5)\r\n      , { hm, isBreaked } = _crMonthHm(\r\n            0, data, stopYear, _crValueYearPoint\r\n        )\r\n      , max = data.length\r\n      , _stopYear = isBreaked\r\n           ? stopYear\r\n           : _getYear(data[max-1][0])\r\n      , name = `Range ${refYear}:${_stopYear}`\r\n      , _data = _hmToSeriaData(hm, _crHighLowPoint);\r\n\r\n  return {\r\n    rangeSeria: Builder()\r\n      .areaRangeSeria(\r\n         Tooltip.categoryRHLY, {\r\n           data: _data,\r\n           name: name,\r\n           point: {}\r\n         }\r\n       ).toSeria(),\r\n    rangeItem: _crItem(name, C.RANGE)\r\n  };\r\n}\r\n\r\nconst _findStartYearIndex = (data, yearStop) => {\r\n  const max = data.length;\r\n  let i = 0;\r\n  for(;i<max;i++){\r\n    if (_getYear(data[i][0]) !== yearStop ) {\r\n       break;\r\n    }\r\n  }\r\n  return i;\r\n}\r\n\r\nconst _crAvgSeria = (data) => {\r\n  const yearNow = _getYear(data[0][0])\r\n      , fromYear = parseFloat(yearNow) - 1\r\n      , stopYear = '' + (parseFloat(yearNow) - 5)\r\n      , max = data.length\r\n      , startIndex = _findStartYearIndex(data, yearNow)\r\n      , { hm, isBreaked } = _crMonthHm(startIndex, data, stopYear)\r\n      , _stopYear = isBreaked\r\n           ? stopYear\r\n           : _getYear(data[max-1][0])\r\n      , _data = _hmToSeriaData(hm, _crAvgPoint)\r\n      , name = `Avg ${fromYear}:${_stopYear}`;\r\n\r\n  return {\r\n    avgSeria: _crSeria(name, {...C.AVG, ...{data: _data}}),\r\n    avgItem: _crItem(name, C.AVG)\r\n  };\r\n}\r\n\r\n\r\nconst _crZhConfig = (option, { legend }) => {\r\n  const { value, dataSource, itemCaption } = option\r\n      , _id = value + '_' + 'YEARLY';\r\n  return {\r\n    id: _id,\r\n    key: _id,\r\n    itemCaption,\r\n    isWithoutIndicator: true,\r\n    isWithoutAdd: true,    \r\n    legend: legend,\r\n    dataSource: dataSource\r\n  };\r\n}\r\n\r\n\r\nconst _crValueAndDate = (seria, index) => {\r\n  const { data=[], name } = seria\r\n      , { y:value, c } = data[index];\r\n  return {\r\n    value,\r\n    date: `${c}-${name}`\r\n  };\r\n}\r\nconst _crValueMoving = (nowSeria, prevSeria) => {\r\n  const { data=[] } = nowSeria\r\n      , max = data.length - 1\r\n      , {\r\n          value:bNowValue,\r\n          date\r\n        } = _crValueAndDate(nowSeria, max)\r\n      , {\r\n          value:bPrevValue,\r\n          date:dateTo\r\n        } = _crValueAndDate(prevSeria, max)\r\n      , moving = crValueMoving({\r\n            bNowValue,\r\n            bPrevValue\r\n        });\r\n\r\n  return {\r\n    ...moving, date, dateTo,\r\n    valueTo: numberFormat(bPrevValue),\r\n    isDenyToChange: true\r\n  };\r\n};\r\n\r\n\r\nconst toYearly = {\r\n  toConfig(data, option) {\r\n    const { title, subtitle } = option\r\n    , {\r\n        nowSeria, nowItem,\r\n        prevSeria, prevItem\r\n      } = _crSeries(data)\r\n    , { rangeSeria, rangeItem } = _crRangeSeria(data)\r\n    , { avgSeria, avgItem } = _crAvgSeria(data)\r\n    , legend = [ nowItem, prevItem, rangeItem, avgItem ]\r\n    , config = Builder()\r\n       .categoryConfig(CATEGORIES)\r\n       .addCaption(title, subtitle)\r\n       .addSeriaBy(0, rangeSeria)\r\n       .addSeriaBy(1, avgSeria)\r\n       .addSeriaBy(2, prevSeria)\r\n       .addSeriaBy(3, nowSeria)\r\n       .addTooltip(Tooltip.categorySimple)\r\n       .add({\r\n         chart: { spacingTop: 25, marginTop: 45 },\r\n         zhConfig: _crZhConfig(option, { legend }),\r\n         valueMoving:  _crValueMoving(nowSeria, prevSeria)\r\n       })\r\n       .toConfig();\r\n\r\n    return config;\r\n  }\r\n}\r\n\r\nexport default toYearly\r\n"],"file":"ToYearly.js"}