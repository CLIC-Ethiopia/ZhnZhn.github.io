{"version":3,"sources":["../../../src/adapters/stat-uk/fnAdapter.js"],"names":["getValue","AdapterFn","crError","ymdToUTC","compareByDate","joinBy","crItemLink","_crItemLink","bind","MONTH_HM","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","QUARTER_HM","q1","q2","q3","q4","_mmmYyToMls","str","_arr","split","_m","trim","_yStr","_yPrefix","_yyyyQqToMls","_yyyy","_q","_mm","toLowerCase","NaN","_fCrToMls","observations","_item","dimensions","time","href","indexOf","_isNumber","n","_crZhConfig","_itemKey","title","dataSource","id","key","itemCaption","_crName","unit_of_measure","subtitle","_crDescr","links","dataset_metadata","_crInfo","json","option","name","description","fnAdapter","crData","_data","_toMsl","i","length","item","observation","_x","_y","parseFloat","push","sort","crConfigOption","zhConfig","info"],"mappings":"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","sourcesContent":["import AdapterFn from '../AdapterFn'\r\n\r\nconst {\r\n  getValue,\r\n  crError,\r\n  ymdToUTC,\r\n  compareByDate,  \r\n  joinBy,\r\n  crItemLink\r\n} = AdapterFn\r\n\r\nconst _crItemLink = crItemLink.bind(null, 'ONS Dataset Metadata');\r\n\r\nconst MONTH_HM = {\r\n  Jan: '01',\r\n  Feb: '02',\r\n  Mar: '03',\r\n  Apr: '04',\r\n  May: '05',\r\n  Jun: '06',\r\n  Jul: '07',\r\n  Aug: '08',\r\n  Sep: '09',\r\n  Oct: '10',\r\n  Nov: '11',\r\n  Dec: '12'\r\n}\r\n\r\nconst QUARTER_HM = {\r\n  q1: \"03\",\r\n  q2: \"06\",\r\n  q3: \"09\",\r\n  q4: \"12\"\r\n}\r\n\r\n//Jan-20\r\nconst _mmmYyToMls = str => {\r\n  const _arr = str.split('-')\r\n  , _m = MONTH_HM[_arr[0].trim()]\r\n  , _yStr = _arr[1].trim()\r\n  , _yPrefix = _yStr < '30' ? '20' : '19';\r\n  return ymdToUTC(`${_yPrefix}${_yStr}-${_m}`);\r\n}\r\n\r\n//2010-q1\r\nconst _yyyyQqToMls = str => {\r\n  const [ _yyyy, _q='' ] = str && str.split('-') || []\r\n  , _mm = QUARTER_HM[_q.trim().toLowerCase()];\r\n  return _yyyy && _mm\r\n    ? ymdToUTC(`${_yyyy}-${_mm}`)\r\n    : NaN;\r\n}\r\n\r\nconst _fCrToMls = observations => {\r\n  const _item = observations[0] || {}\r\n  , {  href='' } = (_item.dimensions || {}).time || {};\r\n  return href.indexOf('yyyy-qq') !== -1\r\n    ? _yyyyQqToMls\r\n    : _mmmYyToMls;\r\n}\r\n\r\nconst _isNumber = n => typeof n === 'number'\r\n && (n-n===0);\r\n\r\nconst _crZhConfig = ({\r\n  _itemKey,\r\n  title,\r\n  dataSource\r\n}) => ({\r\n  id: _itemKey, key: _itemKey,\r\n  itemCaption: title,\r\n  dataSource\r\n})\r\n\r\nconst _crName = ({ unit_of_measure }, { title, subtitle }) =>\r\n  joinBy(': ', subtitle, title, unit_of_measure);\r\n\r\nconst _crDescr = ({ links }) => {\r\n  const { href } = (links || {}).dataset_metadata || {};\r\n  return href ? _crItemLink(href) : '';\r\n}\r\n\r\nconst _crInfo = (json, option) => ({\r\n  name: _crName(json, option),\r\n  description: _crDescr(json)\r\n})\r\n\r\n\r\nconst fnAdapter = {\r\n  getValue,\r\n  crError,\r\n\r\n  crData: (json) => {\r\n    const _data = []\r\n    , { observations } = json\r\n    , _toMsl = _fCrToMls(observations);\r\n    let i=0;\r\n    for (;i<observations.length; i++){\r\n      const item = observations[i]\r\n      , { dimensions, observation } = item\r\n      , { id } = (dimensions || {}).time || {}\r\n      , _x = _toMsl(id)\r\n      , _y = parseFloat(observation)\r\n      if (_isNumber(_x) && _isNumber(_y)) {\r\n        _data.push([_x, _y])\r\n      }\r\n    }\r\n    return _data.sort(compareByDate);\r\n  },\r\n\r\n  crConfigOption: (json, option) => ({\r\n    zhConfig: _crZhConfig(option),\r\n    info: _crInfo(json, option)\r\n  })\r\n}\r\n\r\nexport default fnAdapter\r\n"],"file":"fnAdapter.js"}