{"version":3,"sources":["../../../src/adapters/eurostat/ChoroplethMap.js"],"names":["URL_EU_GEOJSON","NUMBER_OF_CLUSTERS","NUMBER_OF_ITERATION","COLORS","_findFeature","features","id","Array","isArray","i","length","properties","_mergeGeoAndValue","sGeo","dGeo","json","points","minValue","Number","POSITIVE_INFINITY","maxValue","NEGATIVE_INFINITY","forEach","cell","index","feature","value","point","push","_crHmIdCluster","clusters","hm","cluster","_mergeGeoJsonAndClusters","geoJson","hmIdCluster","maxCluster","_properties","_id","_cluster","_crStyle","_crEl","tag","className","cssText","el","document","createElement","style","_crInfoControl","L","mapId","Object","assign","control","onAdd","map","idEl","divEl","update","props","elInfo","MapFactory","crInfo","getElementById","updateCluster","color","from","to","elClusterInfo","crClusterInfo","_calcUpper","arrL","arrH","upLow","upUp","_crRowEl","wg","_n","addEventListener","event","innerHTML","_crFooterEl","_crGradeControl","gradeContorl","position","_div","_upperPrev","_upperNext","mathFn","toFixed","appendChild","_onMouseOver","infoControl","e","_layer","target","_fnOnEachFeature","layer","on","mouseover","bind","_addGeoSeria","statJson","configSlice","time","seriaSlice","geo","seria","JsonStatFn","crGeoSeria","_crChoroplethMap","option","jsonCube","zhMapSlice","dfTime","createGeoSlice","_points","_clusters","clusterMaker","crUnarySortedCluster","_hmIdCluster","addTo","geoJSON","onEachFeature","gradeControl","_crGeoJson","_geoJson","ChoroplethMap","hmUrlGeoJson","undefined","mapOption","doubleClickZoom","zoomSnap","minZoom","maxZoom","getLeaflet","Promise","resolve","then","getGeoJson","url","fetch","response","draw","setView","tileLayer"],"mappings":"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","sourcesContent":["import { render } from 'react-dom'\r\n\r\nimport JsonStatFn from './JsonStatFn'\r\nimport clusterMaker from '../../math/k-means'\r\nimport mathFn from '../../math/mathFn'\r\nimport merge from '../../utils/merge'\r\n\r\nimport MapFactory from '../../components/factories/MapFactory'\r\n\r\nconst URL_EU_GEOJSON = 'data/geo/eu-stat.geo.json'\r\n, NUMBER_OF_CLUSTERS = 6\r\n, NUMBER_OF_ITERATION = 100\r\n, COLORS = [\r\n   '#9ecae1', '#6baed6',\r\n   '#4292c6', '#2171b5',\r\n   '#08519c', '#08306b',\r\n   '#74c476'\r\n  ];\r\n\r\nconst _findFeature = function(features, id){\r\n  if (!Array.isArray(features)) {\r\n    return void 0;\r\n  }\r\n  for(let i=0; i<features.length; i++){\r\n    if (features?.[i]?.properties.id === id){\r\n      return features[i];\r\n    }\r\n  }\r\n  return void 0;\r\n};\r\n\r\n\r\nconst _mergeGeoAndValue = function(sGeo, dGeo, json){\r\n  const points = [];\r\n  let minValue = Number.POSITIVE_INFINITY\r\n    , maxValue = Number.NEGATIVE_INFINITY;\r\n  sGeo.forEach((cell, index) => {\r\n    const feature = _findFeature(json.features, dGeo.id[index])\r\n        , value = cell.value;\r\n    if (feature && value){\r\n      feature.properties.value = value;\r\n\r\n      const point = [value, 0];\r\n      point.id = feature.properties.id;\r\n      points.push(point);\r\n\r\n      if (minValue>value) { minValue = value; }\r\n      if (maxValue<value) { maxValue = value; }\r\n    }\r\n  })\r\n  if (points.length === 0){\r\n    const point = [0, 0];\r\n    point.id = 'ID';\r\n    points.push(point);\r\n  }\r\n  return { minValue, maxValue, points };\r\n}\r\n\r\nconst _crHmIdCluster = function(clusters){\r\n  const hm = {};\r\n  clusters.forEach((cluster, i) => {\r\n    for (const point of cluster.points){\r\n      hm[point.id] = i;\r\n    }\r\n  })\r\n  return hm;\r\n};\r\n\r\nconst _mergeGeoJsonAndClusters = function(geoJson, hmIdCluster, maxCluster){\r\n  geoJson.features.forEach((feature ) => {\r\n    const _properties = feature.properties\r\n        , _id = _properties.id\r\n    if (_id){\r\n      const _cluster = hmIdCluster[_id];\r\n      _properties.cluster = (typeof _cluster !== \"undefined\")\r\n             ? _cluster\r\n             : maxCluster;\r\n    } else {\r\n      _properties.cluster = maxCluster;\r\n    }\r\n  })\r\n};\r\n\r\n\r\nconst _crStyle = (feature) => ({\r\n  \"color\": 'green',\r\n  \"fillColor\": COLORS[feature.properties.cluster],\r\n  \"weight\": 1,\r\n  \"fillOpacity\": 0.7,\r\n  \"opacity\": 0.65\r\n});\r\n\r\nconst _crEl = function(tag, className='', cssText='', id){\r\n  const el = document.createElement(tag)\r\n  el.className = className\r\n  el.style.cssText = cssText\r\n  if (id) {\r\n    el.id = id;\r\n  }\r\n  return el;\r\n};\r\n\r\nconst _crInfoControl = (L, mapId) => Object.assign(L.control(), {\r\n  onAdd(map){\r\n    this.idEl = mapId + '_info-control'\r\n    this.divEl = _crEl('div', 'control-info', '', this.idEl)\r\n    return this.divEl;\r\n  },\r\n  update(props){\r\n    if (props){\r\n      const elInfo = MapFactory.crInfo(props);\r\n      render(elInfo, document.getElementById(this.idEl))\r\n    }\r\n  },\r\n  updateCluster(cluster, color, from, to){\r\n    if (cluster){\r\n      const elClusterInfo = MapFactory.crClusterInfo({ cluster, color, from, to });\r\n      render(elClusterInfo, document.getElementById(this.idEl))\r\n    }\r\n  }\r\n});\r\n\r\n\r\nconst _calcUpper = function(clusters, index, maxValue){\r\n  if (clusters.length - 1 === index) {\r\n    return maxValue;\r\n  }\r\n  const arrL = clusters?.[index]?.points ?? [[0]]\r\n      , arrH = clusters?.[index+1].points ?? [[0]]\r\n      , upLow = arrL[arrL.length-1][0]\r\n      , upUp = arrH[0] ? arrH[0][0] : upLow;\r\n\r\n  return (upLow + (upUp - upLow)/2);\r\n}\r\n\r\nconst _crRowEl = function(color, from, to, cluster, wg){\r\n  const _n = cluster?.points?.length ?? 0\r\n  , el = _crEl('p', '',\r\n     `opacity: 0.7; background: ${color}; padding: 5px 6px; cursor: pointer;`\r\n   )\r\n  el.addEventListener('click', function(event){\r\n    wg.updateCluster(cluster, color, from, to)\r\n  })\r\n  el.innerHTML = `<span>${from}&ndash;${to}<span>\r\n                  <span style=\"float: right; color: black; padding-left: 16px\">${_n}</span>`\r\n  return el;\r\n}\r\nconst _crFooterEl = function(){\r\n  const el = _crEl('div');\r\n  el.innerHTML = `<p style=\"opacity:0.65;background:green;padding: 3px 6px\">No Data</p>\r\n                  <p style=\"color:black;padding-top: 5px;\">Source: Eurostat</p>`\r\n  return el;\r\n}\r\n\r\nconst _crGradeControl = function(minValue, maxValue, clusters, L, wg){\r\n  const gradeContorl = L.control({ position: 'bottomleft' })\r\n  gradeContorl.onAdd = function(map){\r\n      const _div = _crEl('div', 'control-grade');\r\n\r\n      let _upperPrev, _upperNext;\r\n      _upperPrev = mathFn.toFixed(minValue)\r\n      clusters.forEach((cluster, index) => {\r\n        _upperNext = mathFn.toFixed(_calcUpper(clusters, index, maxValue))\r\n        _div.appendChild( _crRowEl(\r\n            COLORS[index], _upperPrev, _upperNext, cluster, wg\r\n        ))\r\n        _upperPrev = _upperNext;\r\n      })\r\n      _div.appendChild(_crFooterEl())\r\n\r\n      return _div;\r\n    }\r\n\r\n  return gradeContorl;\r\n}\r\n\r\nconst _onMouseOver = function(infoControl, e){\r\n  const _layer = e.target;\r\n  infoControl.update(_layer.feature.properties);\r\n}\r\n/*\r\nconst  _onMouseOut = function(infoControl, e){\r\n  //infoControl.update()\r\n}\r\n*/\r\nconst _fnOnEachFeature = function(infoControl, feature, layer){\r\n   layer.on({\r\n     mouseover: _onMouseOver.bind(null, infoControl),\r\n     //mouseout: _onMouseOut.bind(null, infoControl)\r\n   })\r\n}\r\n\r\nconst _addGeoSeria = (points, statJson, configSlice) => {\r\n  /* eslint-disable no-unused-vars */\r\n  const { time, ...seriaSlice } = configSlice;\r\n  /* eslint-enable no-unused-vars */\r\n  return points.map(point => {\r\n    seriaSlice.geo = point.id\r\n    point.seria = JsonStatFn.crGeoSeria(statJson, seriaSlice)\r\n    return point;\r\n  });\r\n}\r\n\r\nconst _crChoroplethMap = function(option){\r\n  const {\r\n    jsonCube:statJson, geoJson, zhMapSlice:configSlice,\r\n    map, L, mapId, time:dfTime\r\n  } = option\r\n  , { dGeo, sGeo, time } = JsonStatFn.createGeoSlice(statJson, configSlice, dfTime)\r\n  , { minValue, maxValue, points } = _mergeGeoAndValue(sGeo, dGeo, geoJson)\r\n  , _points = _addGeoSeria(points, statJson, configSlice)\r\n  , _clusters = clusterMaker.crUnarySortedCluster(_points, NUMBER_OF_CLUSTERS, NUMBER_OF_ITERATION)\r\n  , _hmIdCluster = _crHmIdCluster(_clusters);\r\n\r\n  _mergeGeoJsonAndClusters(geoJson, _hmIdCluster, NUMBER_OF_CLUSTERS);\r\n  const infoControl = _crInfoControl(L, mapId);\r\n  infoControl.addTo(map);\r\n\r\n  L.geoJSON(geoJson, {\r\n     style : _crStyle,\r\n     onEachFeature : _fnOnEachFeature.bind(null, infoControl)\r\n  }).addTo(map);\r\n\r\n\r\n  if ( _points.length > 1) {\r\n    const gradeControl = _crGradeControl(\r\n      minValue, maxValue, _clusters, L, infoControl\r\n    )\r\n    gradeControl.addTo(map);\r\n  }\r\n\r\n  option.time = time\r\n  return option;\r\n}\r\n\r\nconst _crGeoJson = (geoJson) => {\r\n  const _geoJson = merge(true, {}, geoJson)\r\n  _geoJson.features.forEach(feature => {\r\n     feature.properties.value = null\r\n  });\r\n  return _geoJson;\r\n}\r\n\r\nconst ChoroplethMap = {\r\n  hmUrlGeoJson: {},\r\n  L: undefined,\r\n  mapOption: {\r\n    doubleClickZoom: false,\r\n    zoomSnap: 0.5,\r\n    minZoom: 1,\r\n    maxZoom: 4\r\n  },\r\n\r\n  getLeaflet(){\r\n    if (this.L){\r\n      return Promise.resolve(this.L);\r\n    } else {\r\n      return import(\r\n        /* webpackChunkName: \"leaflet\" */\r\n        /* webpackMode: \"lazy\" */\r\n        'leaflet'\r\n      ).then(L => {\r\n        return this.L = L;\r\n      });\r\n    }\r\n  },\r\n\r\n  getGeoJson(url){\r\n     const geoJson = this.hmUrlGeoJson[url];\r\n     if (geoJson){\r\n       return Promise.resolve(_crGeoJson(geoJson));\r\n     } else {\r\n       return fetch(url)\r\n         .then(response => response.json())\r\n         .then(geoJson => this.hmUrlGeoJson[url] = geoJson)\r\n     }\r\n  },\r\n\r\n  draw({ id, jsonCube, zhMapSlice, time }){\r\n    return this.getLeaflet()\r\n       .then( (L) => {\r\n          const map = L.map(id, this.mapOption)\r\n            .setView([58.00, 10.00], 3);\r\n\r\n          /*\r\n          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n               id: 'addis',\r\n               attribution: '&copy; <a  href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\r\n               errorTileUrl: ''\r\n          }).addTo(map);\r\n          */\r\n\r\n          L.tileLayer('', {\r\n               id: id + '_tile'\r\n          }).addTo(map);\r\n\r\n          return {\r\n            jsonCube, zhMapSlice, time,\r\n            L, map, mapId: id\r\n          };\r\n       })\r\n       .then(option => {\r\n          return this.getGeoJson(URL_EU_GEOJSON)\r\n           .then(geoJson => {\r\n              option.geoJson = geoJson;\r\n              return option;\r\n           });\r\n       })\r\n       .then(option => Promise.resolve(\r\n         _crChoroplethMap(option)\r\n       ));\r\n  }\r\n};\r\n\r\nexport default ChoroplethMap\r\n"],"file":"ChoroplethMap.js"}