{"version":3,"sources":["../../../src/adapters/uncomtrade/fnLegend.js"],"names":["fnLegend","fItemWithRatio","hm","sum","item","name","_points","_p","length","_ratio","fns","roundBy","y","calcRecentSum","key","indexOf","C","WORLD","points","toAllLegend","arr","measure","crItemWithRatio","AVG_PRICE","map","toWorldLegend","world"],"mappings":";;;;;;;;;AACA;;AACA;;AAEA,IAAMA,QAAQ,GAAG;AAEfC,EAAAA,cAAc,EAAE,wBAACC,EAAD,EAAKC,GAAL;AAAA,WAAa,UAACC,IAAD,EAAU;AAC/B,UAAEC,IAAF,GAAWD,IAAX,CAAEC,IAAF;AAAA,UACAC,OADA,GACUJ,EAAE,CAACG,IAAD,CADZ;AAAA,UAEAE,EAFA,GAEKD,OAAO,CAACA,OAAO,CAACE,MAAR,GAAe,CAAhB,CAFZ;AAAA,UAGAC,MAHA,GAGSF,EAAE,GACL,MAAMG,sBAAIC,OAAJ,CAAaJ,EAAE,CAACK,CAAH,GAAKT,GAAN,GAAW,GAAvB,EAA4B,CAA5B,CAAN,GAAqC,GADhC,GAEL,EALN;;AAMN,2CACMC,IADN;AAEGC,QAAAA,IAAI,EAAEA,IAAI,GAAGI;AAFhB;AAID,KAXe;AAAA,GAFD;AAefI,EAAAA,aAAa,EAAE,uBAACX,EAAD,EAAQ;AACrB,QAAIY,GAAJ;AAAA,QAASX,GAAG,GAAG,CAAf;;AACA,SAAKW,GAAL,IAAYZ,EAAZ,EAAgB;AACd,UACKY,GAAG,CAACC,OAAJ,CAAY,OAAZ,MAAyB,CAAC,CAA1B,IACGD,GAAG,CAACC,OAAJ,CAAYC,iBAAEC,KAAd,MAAyB,CAAC,CAFlC,EAGE;AACA,YAAMC,MAAM,GAAGhB,EAAE,CAACY,GAAD,CAAjB;AACAX,QAAAA,GAAG,IAAIe,MAAM,CAACA,MAAM,CAACV,MAAP,GAAc,CAAf,CAAN,CAAwBI,CAA/B;AACD;AACF;;AACD,WAAOT,GAAP;AACD,GA3Bc;AA6BfgB,EAAAA,WAAW,EAAE,qBAACC,GAAD,EAAMlB,EAAN,EAAUmB,OAAV,EAAsB;AACjC,QAAMlB,GAAG,GAAGH,QAAQ,CAACa,aAAT,CAAuBX,EAAvB,CAAZ;AAAA,QACMoB,eAAe,GAAGtB,QAAQ,CAACC,cAAT,CAAwBC,EAAxB,EAA4BC,GAA5B,CADxB;AAEA,WAAQA,GAAG,KAAK,CAAR,IAAakB,OAAO,KAAKL,iBAAEO,SAA5B,GACFH,GAAG,CAACI,GAAJ,CAAQF,eAAR,CADE,GAEFF,GAFL;AAGD,GAnCc;AAqCfK,EAAAA,aAAa,EAAE,uBAACL,GAAD,EAAMlB,EAAN,EAAa;AAC1B,QAAMwB,KAAK,GAAGxB,EAAE,CAACc,iBAAEC,KAAH,CAAhB;AAAA,QACMd,GAAG,GAAGuB,KAAK,GACPA,KAAK,CAACA,KAAK,CAAClB,MAAN,GAAa,CAAd,CAAL,CAAsBI,CADf,GAEPZ,QAAQ,CAACa,aAAT,CAAuBX,EAAvB,CAHV;AAAA,QAIMoB,eAAe,GAAGtB,QAAQ,CAACC,cAAT,CAAwBC,EAAxB,EAA4BC,GAA5B,CAJxB;AAMA,WAAQA,GAAG,KAAK,CAAR,IAAaA,GAAG,IAAI,IAArB,GACFiB,GAAG,CAACI,GAAJ,CAAQF,eAAR,CADE,GAEFF,GAFL;AAGD;AA/Cc,CAAjB;eAkDepB,Q","sourcesContent":["\r\nimport fns from './fnAdapter'\r\nimport C from './conf'\r\n\r\nconst fnLegend = {\r\n\r\n  fItemWithRatio: (hm, sum) => (item) => {\r\n    const { name } = item\r\n        , _points = hm[name]\r\n        , _p = _points[_points.length-1]\r\n        , _ratio = _p\r\n              ? ' ' + fns.roundBy((_p.y/sum)*100, 1)+'%'\r\n              : '';\r\n    return {\r\n       ...item,\r\n       name: name + _ratio\r\n    };\r\n  },\r\n\r\n  calcRecentSum: (hm) => {\r\n    let key, sum = 0;\r\n    for (key in hm) {\r\n      if (\r\n           key.indexOf(', nes') === -1\r\n           && key.indexOf(C.WORLD) === -1\r\n      ) {\r\n        const points = hm[key];\r\n        sum += points[points.length-1].y\r\n      }\r\n    }\r\n    return sum;\r\n  },\r\n\r\n  toAllLegend: (arr, hm, measure) => {\r\n    const sum = fnLegend.calcRecentSum(hm)\r\n        , crItemWithRatio = fnLegend.fItemWithRatio(hm, sum);\r\n    return (sum !== 0 && measure !== C.AVG_PRICE)\r\n       ? arr.map(crItemWithRatio)\r\n       : arr;\r\n  },\r\n\r\n  toWorldLegend: (arr, hm) => {\r\n    const world = hm[C.WORLD]\r\n        , sum = world\r\n            ? world[world.length-1].y\r\n            : fnLegend.calcRecentSum(hm)\r\n        , crItemWithRatio = fnLegend.fItemWithRatio(hm, sum);\r\n\r\n    return (sum !== 0 && sum != null)\r\n       ? arr.map(crItemWithRatio)\r\n       : arr;\r\n  }\r\n};\r\n\r\nexport default fnLegend\r\n"],"file":"fnLegend.js"}