{"version":3,"sources":["../../src/adapters/IndicatorSma.js"],"names":["fnAddSeriesSma","chart","period","_id","parentId","options","zhConfig","id","dataSma","data","series","bSum","i","max","length","point","plus","y","minus","push","x","parseFloat","div","toFixed","seria","fSeries","zhSeriaId","zhValueText","lineWidth","addSeries","colors","console","log","undefined","fnRemoveSeries","userOptions","remove","_fnConvertToUTC","str","arrDate","split","Date","UTC","parseInt","_fnGetPriceAndFlow","close","high","low","bTp","bRmf","times","isFullData","fnGetConfigMfi","zhPoints","dataMcad","nPeriod","bPositiveFlow","bNegativeFlow","nNotFullPoint","isNegative","tp","rmf","gt","bMFR_PlusOne","bRatio","bY","zhDate","titleNotFullPoint","config","fIndicatorMfiConfig"],"mappings":"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","file":"IndicatorSma.js","sourcesContent":["\r\nimport Big from 'big.js';\r\n\r\nimport ChartConfig from '../charts/ChartConfig';\r\n\r\nexport const fnAddSeriesSma = function(chart, period){\r\n\r\n  const _id = 'SMA(' + period + ')'\r\n      , parentId = chart.options.zhConfig.id\r\n      , dataSma = []\r\n      , data = chart.series[0].data;\r\n\r\n  let bSum = Big('0.0');\r\n  for (var i=0, max=data.length; i<max; i++){\r\n    const point = data[i];\r\n    if (i>period){\r\n       bSum = bSum.plus(point.y).minus(data[i-period].y);\r\n       dataSma.push([point.x, parseFloat(bSum.div(period).toFixed(2))])\r\n    } else {\r\n      bSum = bSum.plus(point.y);\r\n    }\r\n  }\r\n\r\n  if (dataSma.length>0){\r\n    const seria = ChartConfig.fSeries();\r\n\r\n    seria.zhSeriaId = parentId + '_' + _id;\r\n    seria.zhValueText = _id;\r\n    seria.lineWidth = 2;\r\n    seria.data = dataSma;\r\n\r\n    chart.addSeries(seria, true, true)\r\n\r\n    return chart.options.colors[seria['_colorIndex']];\r\n\r\n  } else {\r\n    console.log('It seems, there are not enough data for SMA(' + period + ')');\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport const fnRemoveSeries = function(chart, zhValueText){\r\n   const series = chart.series;\r\n   for (var i=0, max=series.length; i<max; i++){\r\n     if (series[i].userOptions.zhValueText === zhValueText){\r\n       series[i].remove(true);\r\n       return true;\r\n     }\r\n   }\r\n   return false;\r\n}\r\n\r\nconst _fnConvertToUTC = function(str){\r\n   const arrDate = str.split('-');\r\n   return  Date.UTC(arrDate[0], (parseInt(arrDate[1], 10)-1), arrDate[2]);\r\n}\r\n\r\n\r\nconst _fnGetPriceAndFlow = function(point){\r\n  const close = point[4]\r\n      , high = (point[2]) ? point[2] : close\r\n      , low  = (point[3]) ? point[2] : close\r\n      , bTp = Big(high).plus(low).plus(close).div(3)\r\n      , bRmf = bTp.times(point[5])\r\n      , isFullData = (point[2] && point[3]) ? true : false;\r\n  return {bTp, bRmf, isFullData}\r\n};\r\n\r\nexport const fnGetConfigMfi = function(chart, period, id){\r\n\r\n  const data = chart.options.zhPoints\r\n       , parentId = chart.options.zhConfig.id\r\n       , dataMcad = []\r\n       , nPeriod = parseFloat(period) + 1;\r\n\r\n   let bPositiveFlow = Big('0.0')\r\n     , bNegativeFlow = Big('0.0001')\r\n     , nNotFullPoint = 0;\r\n\r\n   for (var i=0, max=data.length; i<max; i++){\r\n     const point = data[i];\r\n     if (i<nPeriod){\r\n       if (i==0){\r\n         const {bTp, bRmf, isFullData} = _fnGetPriceAndFlow(point);\r\n         if (!isFullData) { nNotFullPoint+=1;}\r\n         dataMcad.push({\r\n           y : null,\r\n           x : _fnConvertToUTC(point[0]),\r\n           isNegative : false,\r\n           tp : parseFloat(bTp.toFixed(4)),\r\n           rmf : parseFloat(bRmf.toFixed(4))\r\n         })\r\n       } else {\r\n         const {bTp, bRmf, isFullData} = _fnGetPriceAndFlow(point);\r\n         if (!isFullData) { nNotFullPoint+=1;}\r\n         let isNegative;\r\n         if (bTp.gt(dataMcad[i-1].tp)){\r\n            bPositiveFlow = bPositiveFlow.plus(bRmf.toFixed(4));\r\n            isNegative = false;\r\n         } else {\r\n           bNegativeFlow = bNegativeFlow.plus(bRmf.toFixed(4));\r\n           isNegative = true;\r\n         }\r\n         dataMcad.push({\r\n           y : null,\r\n           x : _fnConvertToUTC(point[0]),\r\n           isNegative : isNegative,\r\n           tp : parseFloat(bTp.toFixed(4)),\r\n           rmf : parseFloat(bRmf.toFixed(4))\r\n         })\r\n       }\r\n     } else {\r\n        const { bTp, bRmf, isFullData } = _fnGetPriceAndFlow(point);\r\n        if (!isFullData) { nNotFullPoint+=1;}\r\n\r\n        let isNegative;\r\n        if (bTp.gt(dataMcad[i-1].tp)){\r\n           bPositiveFlow = bPositiveFlow.plus(bRmf.toFixed(4));\r\n           isNegative = false;\r\n        } else {\r\n          bNegativeFlow = bNegativeFlow.plus(bRmf.toFixed(4));\r\n          isNegative = true;\r\n        }\r\n        if (dataMcad[i-period].isNegative){\r\n          bNegativeFlow = bNegativeFlow.minus(dataMcad[i-period].rmf);\r\n        } else {\r\n          bPositiveFlow = bPositiveFlow.minus(dataMcad[i-period].rmf);\r\n        }\r\n\r\n        const bMFR_PlusOne = bPositiveFlow.div(bNegativeFlow.toFixed(4)).plus('1')\r\n            , bRatio = Big('100').div(bMFR_PlusOne.toFixed(4))\r\n            , bY = Big('100').minus(bRatio.toFixed(4));\r\n\r\n        dataMcad.push({\r\n          x : _fnConvertToUTC(point[0]),\r\n          y : parseFloat(bY.toFixed(2)),\r\n          zhDate : point[0],\r\n          isNegative : isNegative,\r\n          tp : parseFloat(bTp.toFixed(4)),\r\n          rmf : parseFloat(bRmf.toFixed(4))\r\n        })\r\n     }\r\n   }\r\n\r\n   const titleNotFullPoint = (nNotFullPoint !== 0)\r\n           ? ' Not Full Data HL:' + nNotFullPoint\r\n           : ''\r\n       , config = ChartConfig.fIndicatorMfiConfig(\r\n           id, parentId, id + titleNotFullPoint, dataMcad\r\n         ) ;\r\n\r\n\r\n   return config;\r\n}\r\n"]}