{"version":3,"sources":["../../src/adapters/IndicatorSma.js"],"names":["C","ATH_UP","ATH_DOWN","fnAddSeriesSma","option","chart","id","period","isPlus","plus","parentId","options","zhConfig","dataSma","data","series","bSum","i","max","length","point","_period","parseFloat","minus","toFixed","y","push","x","div","seria","Object","assign","fSeries","zhSeriaId","zhValueText","lineWidth","addSeries","colors","console","log","undefined","fnRemoveSeries","userOptions","remove","_fnConvertToUTC","str","arrDate","split","Date","UTC","parseInt","_fnGetPriceAndFlow","close","high","low","bTp","bRmf","times","isFullData","fnGetConfigMfi","zhPoints","dataMcad","nPeriod","bPositiveFlow","bNegativeFlow","nNotFullPoint","isNegative","tp","rmf","gt","bMFR_PlusOne","bRatio","bY","zhDate","titleNotFullPoint","config","fIndicatorMfiConfig","fnMomAthConfig","_dataMom","_dataAth","_dataSum","prevPoint","mom","ath","co","color"],"mappings":"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","file":"IndicatorSma.js","sourcesContent":["\r\nimport Big from 'big.js';\r\n\r\nimport ChartConfig from '../charts/ChartConfig';\r\n\r\nconst C = {\r\n  ATH_UP: 'rgba(76, 175, 80, 0.75)',\r\n  ATH_DOWN: 'rgba(244, 67, 54, 0.75)'\r\n}\r\n\r\nexport const fnAddSeriesSma = function(option){\r\n  const { chart, id, period, isPlus, plus } = option\r\n      , parentId = chart.options.zhConfig.id\r\n      , dataSma = []\r\n      , data = chart.series[0].data;\r\n\r\n  let bSum = Big('0.0');\r\n  let i=0, max=data.length, point;\r\n  const _period = (isPlus)\r\n           ? parseFloat(Big(period).plus(plus).minus(1).toFixed(0))\r\n           : parseFloat(Big(period).minus(1).toFixed(0));\r\n  for (; i<max; i++){\r\n    point = data[i];\r\n    if (i>_period){\r\n       bSum = bSum.plus(point.y).minus(data[i-period].y);\r\n       dataSma.push([point.x, parseFloat(bSum.div(period).toFixed(2))])\r\n    } else {\r\n      bSum = bSum.plus(point.y);\r\n    }\r\n  }\r\n\r\n  if (dataSma.length>0){\r\n    const seria = Object.assign(\r\n      ChartConfig.fSeries(), {\r\n        zhSeriaId: parentId + '_' + id,\r\n        zhValueText: id,\r\n        lineWidth: 2,\r\n        data: dataSma\r\n      }\r\n    );\r\n    chart.addSeries(seria, true, true)\r\n    return chart.options.colors[seria['_colorIndex']];\r\n  } else {\r\n    console.log('It seems, there are not enough data for SMA(' + period + ')')\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport const fnRemoveSeries = function(chart, zhValueText){\r\n   const series = chart.series;\r\n   for (var i=0, max=series.length; i<max; i++){\r\n     if (series[i].userOptions.zhValueText === zhValueText){\r\n       series[i].remove(true);\r\n       return true;\r\n     }\r\n   }\r\n   return false;\r\n}\r\n\r\nconst _fnConvertToUTC = function(str){\r\n   const arrDate = str.split('-');\r\n   return  Date.UTC(arrDate[0], (parseInt(arrDate[1], 10)-1), arrDate[2]);\r\n}\r\n\r\n\r\nconst _fnGetPriceAndFlow = function(point){\r\n  const close = point[4]\r\n      , high = (point[2]) ? point[2] : close\r\n      , low  = (point[3]) ? point[2] : close\r\n      , bTp = Big(high).plus(low).plus(close).div(3)\r\n      , bRmf = bTp.times(point[5])\r\n      , isFullData = (point[2] && point[3]) ? true : false;\r\n  return {bTp, bRmf, isFullData}\r\n};\r\n\r\nexport const fnGetConfigMfi = function(chart, period, id){\r\n\r\n  const data = chart.options.zhPoints\r\n       , parentId = chart.options.zhConfig.id\r\n       , dataMcad = []\r\n       , nPeriod = parseFloat(period) + 1;\r\n\r\n   let bPositiveFlow = Big('0.0')\r\n     , bNegativeFlow = Big('0.0001')\r\n     , nNotFullPoint = 0;\r\n\r\n   for (var i=0, max=data.length; i<max; i++){\r\n     const point = data[i];\r\n     if (i<nPeriod){\r\n       if (i==0){\r\n         const {bTp, bRmf, isFullData} = _fnGetPriceAndFlow(point);\r\n         if (!isFullData) { nNotFullPoint+=1;}\r\n         dataMcad.push({\r\n           y : null,\r\n           x : _fnConvertToUTC(point[0]),\r\n           isNegative : false,\r\n           tp : parseFloat(bTp.toFixed(4)),\r\n           rmf : parseFloat(bRmf.toFixed(4))\r\n         })\r\n       } else {\r\n         const {bTp, bRmf, isFullData} = _fnGetPriceAndFlow(point);\r\n         if (!isFullData) { nNotFullPoint+=1;}\r\n         let isNegative;\r\n         if (bTp.gt(dataMcad[i-1].tp)){\r\n            bPositiveFlow = bPositiveFlow.plus(bRmf.toFixed(4));\r\n            isNegative = false;\r\n         } else {\r\n           bNegativeFlow = bNegativeFlow.plus(bRmf.toFixed(4));\r\n           isNegative = true;\r\n         }\r\n         dataMcad.push({\r\n           y : null,\r\n           x : _fnConvertToUTC(point[0]),\r\n           isNegative : isNegative,\r\n           tp : parseFloat(bTp.toFixed(4)),\r\n           rmf : parseFloat(bRmf.toFixed(4))\r\n         })\r\n       }\r\n     } else {\r\n        const { bTp, bRmf, isFullData } = _fnGetPriceAndFlow(point);\r\n        if (!isFullData) { nNotFullPoint+=1;}\r\n\r\n        let isNegative;\r\n        if (bTp.gt(dataMcad[i-1].tp)){\r\n           bPositiveFlow = bPositiveFlow.plus(bRmf.toFixed(4));\r\n           isNegative = false;\r\n        } else {\r\n          bNegativeFlow = bNegativeFlow.plus(bRmf.toFixed(4));\r\n          isNegative = true;\r\n        }\r\n        if (dataMcad[i-period].isNegative){\r\n          bNegativeFlow = bNegativeFlow.minus(dataMcad[i-period].rmf);\r\n        } else {\r\n          bPositiveFlow = bPositiveFlow.minus(dataMcad[i-period].rmf);\r\n        }\r\n\r\n        const bMFR_PlusOne = bPositiveFlow.div(bNegativeFlow.toFixed(4)).plus('1')\r\n            , bRatio = Big('100').div(bMFR_PlusOne.toFixed(4))\r\n            , bY = Big('100').minus(bRatio.toFixed(4));\r\n\r\n        dataMcad.push({\r\n          x : _fnConvertToUTC(point[0]),\r\n          y : parseFloat(bY.toFixed(2)),\r\n          zhDate : point[0],\r\n          isNegative : isNegative,\r\n          tp : parseFloat(bTp.toFixed(4)),\r\n          rmf : parseFloat(bRmf.toFixed(4))\r\n        })\r\n     }\r\n   }\r\n\r\n   const titleNotFullPoint = (nNotFullPoint !== 0)\r\n           ? ' Not Full Data HL:' + nNotFullPoint\r\n           : ''\r\n       , config = ChartConfig.fIndicatorMfiConfig(\r\n           id, parentId, id + titleNotFullPoint, dataMcad\r\n         );\r\n   return config;\r\n}\r\n\r\nexport const fnMomAthConfig = function(chart, id) {\r\n  const data = chart.options.zhPoints\r\n      , _dataMom = [], _dataAth = [], _dataSum = [];\r\n  let i = 1, max=data.length\r\n    , point, prevPoint\r\n    , x , mom, ath, co;\r\n\r\n  for (;i<max;i++) {\r\n    prevPoint = data[i-1]\r\n    point = data[i]\r\n    x = _fnConvertToUTC(point[0])\r\n    mom = point[4] - prevPoint[4]\r\n    _dataMom.push({ x: x, y: mom })\r\n    ath = parseFloat((point[1] - prevPoint[4]).toFixed(4))\r\n    _dataAth.push({\r\n      x: x, y: ath,\r\n      color: ath > 0 ? C.ATH_UP : C.ATH_DOWN\r\n    })\r\n    co = parseFloat((point[4] - point[1]).toFixed(4))\r\n    _dataSum.push({ x: x, y: co })\r\n  }\r\n\r\n  return ChartConfig.fnMomAthConfig(\r\n            _dataMom, _dataAth, _dataSum, id\r\n         );\r\n}\r\n"]}