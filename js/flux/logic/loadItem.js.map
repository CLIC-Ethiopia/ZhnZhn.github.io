{"version":3,"sources":["../../../src/flux/logic/loadItem.js"],"names":["ALERT","CATEGORY_TO_SPLINE","alertCaption","alertDescr","_isArr","Array","isArray","_isFn","fn","_crOptionFetch","option","optionFetch","_fetchToChartComp","objImpl","json","onCompleted","adapter","toConfig","config","then","_loadToChartComp","onFailed","fnFetch","api","getLimitRemaiming","uri","getRequestUrl","onCheckResponse","checkResponse","onFetch","bind","onCatch","fnCatch","_isNotAllowToAdd","toSeries","isAdd","_loadToChart","onAdded","_fetchToChart","itemCaption","value","hasSecondYAxis","chart","ChartStore","getActiveChart","series","zhItemCaption","color","zhColor","ChartFn","addSeriaWithRenderLabel","label","_isAddCategoryToSpline","seriaType","ChartTypes","isCategory","xAxis","categories","_runAsync","mls","setTimeout","_loadItem","parentId","isLoadToChart","error","Error","_crLoadFns","id","fnFetchToChartComp","fnFetchToChart","fLoadItem","fetchJson","_loadFns","loadItem","addPropsTo","crKey"],"mappings":"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","sourcesContent":["import { fetchJson } from '../../utils/fnFetch'\r\n\r\nimport ChartStore from '../stores/ChartStore'\r\nimport ChartFn from '../../charts/ChartFn'\r\nimport ChartTypes from '../../components/dialogs/ChartTypes'\r\n\r\nimport { fnCatch } from './fnCatch'\r\n\r\nconst ALERT = {\r\n  CATEGORY_TO_SPLINE: {\r\n    alertCaption: 'Series Error',\r\n    alertDescr: \"Adding category seria to not category isn't allowed.\"\r\n  }\r\n};\r\n\r\nconst _isArr = Array.isArray;\r\nconst _isFn = fn => typeof fn === 'function';\r\n\r\nconst _crOptionFetch = ({ optionFetch }, option) => _isFn(optionFetch)\r\n  ? optionFetch(option)\r\n  : optionFetch;\r\n\r\nconst _fetchToChartComp = function(objImpl ,{json, option, onCompleted}){\r\n  const { adapter } = objImpl\r\n      , { config } = adapter.toConfig(json, option);\r\n\r\n  if (!_isFn(config.then)){\r\n     onCompleted(option, config)\r\n  } else {\r\n    config.then(config => {\r\n      onCompleted(option, config)\r\n      return;\r\n    })\r\n  }\r\n};\r\n\r\nconst _loadToChartComp = function(objImpl, option, onCompleted, onFailed){\r\n  const { fnFetch, api } = objImpl\r\n  , { getLimitRemaiming } = api || {}\r\n  , optionFetch = _crOptionFetch(objImpl, option);\r\n\r\n  fnFetch({\r\n    uri : api.getRequestUrl(option),\r\n    option : option,\r\n    optionFetch: optionFetch,\r\n    getLimitRemaiming,\r\n    onCheckResponse : api.checkResponse,\r\n    onFetch : _fetchToChartComp.bind(null, objImpl),\r\n    onCompleted : onCompleted,\r\n    onCatch : fnCatch,\r\n    onFailed : onFailed\r\n  })\r\n}\r\n\r\nconst _isNotAllowToAdd = ({ toSeries, isAdd }, option) => !_isFn(toSeries)\r\n || (_isFn(isAdd) && !isAdd(option));\r\n\r\nconst _loadToChart = function(objImpl, option, onAdded, onFailed){  \r\n  const { fnFetch, api } = objImpl\r\n  , { getLimitRemaiming } = api || {}\r\n  , optionFetch = _crOptionFetch(objImpl, option);\r\n  fnFetch({\r\n    uri : api.getRequestUrl(option),\r\n    option : option,\r\n    optionFetch: optionFetch,\r\n    getLimitRemaiming,\r\n    onCheckResponse : api.checkResponse,\r\n    onFetch : _fetchToChart.bind(null, objImpl),\r\n    onCompleted : onAdded,\r\n    onCatch : fnCatch,\r\n    onFailed : onFailed\r\n  })\r\n};\r\n\r\nconst _fetchToChart = function(objImpl, { json, option, onCompleted }){\r\n  const { adapter } = objImpl\r\n      , { itemCaption, value, hasSecondYAxis } = option\r\n      , chart = ChartStore.getActiveChart()\r\n      , series = adapter.toSeries(json, option, chart)\r\n      , { zhItemCaption, color, zhColor } = series || {};\r\n\r\n  ChartFn.addSeriaWithRenderLabel({\r\n    chart, series,\r\n    label: zhItemCaption || itemCaption || value,\r\n    color: color || zhColor,\r\n    hasSecondYAxis: !!hasSecondYAxis\r\n  })\r\n  onCompleted(option)\r\n}\r\n\r\nconst _isAddCategoryToSpline = ({ seriaType }) => {\r\n  const chart = ChartStore.getActiveChart();\r\n  return seriaType\r\n    && ChartTypes.isCategory({ value: seriaType })\r\n    && chart && _isArr(chart.xAxis)\r\n    && !_isArr(chart.xAxis[0].categories);\r\n};\r\n\r\nconst _runAsync = (fn, mls=500) => {\r\n  setTimeout(fn, mls)\r\n};\r\n\r\nconst _loadItem = function(objImpl, option, onCompleted, onAdded, onFailed){\r\n  const parentId = ChartStore.isLoadToChart();\r\n  if (!parentId) {\r\n     _loadToChartComp(objImpl, option, onCompleted, onFailed);\r\n  } else {\r\n    if (_isNotAllowToAdd(objImpl.adapter, option)) {\r\n      _runAsync(() => {\r\n        fnCatch({\r\n          error: new Error(\"ERR_10\"),\r\n          option, onFailed\r\n        })\r\n      })\r\n    } else if (_isAddCategoryToSpline(option)) {\r\n      _runAsync(() => onFailed(ALERT.CATEGORY_TO_SPLINE))\r\n    } else {\r\n      option.parentId = parentId;\r\n      _loadToChart(objImpl, option, onAdded, onFailed);\r\n    }\r\n  }\r\n};\r\n\r\nconst _crLoadFns = (objImpl) => objImpl.id === 'Q'\r\n  ? {\r\n      fnFetchToChartComp: _fetchToChartComp.bind(null, objImpl),\r\n      fnFetchToChart: _fetchToChart.bind(null, objImpl),\r\n    }\r\n  : void 0;\r\n\r\nconst fLoadItem = (objImpl) => {\r\n   const {\r\n     fnFetch=fetchJson,\r\n     api, adapter\r\n   } = objImpl\r\n   , _loadFns = _crLoadFns(objImpl);\r\n   objImpl.fnFetch = fnFetch\r\n   return {\r\n     loadItem: _loadItem.bind(null, objImpl),\r\n     addPropsTo: api.addPropsTo,\r\n     crKey: adapter.crKey,\r\n     ..._loadFns\r\n   };\r\n}\r\n\r\nexport default fLoadItem\r\n"],"file":"loadItem.js"}