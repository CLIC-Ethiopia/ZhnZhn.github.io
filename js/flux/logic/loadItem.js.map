{"version":3,"sources":["../../../src/flux/logic/loadItem.js"],"names":["ALERT","CATEGORY_TO_SPLINE","alertCaption","alertDescr","_isArr","Array","isArray","_isFn","fn","_crOptionFetch","option","optionFetch","_fetchToChartComp","objImpl","json","onCompleted","adapter","toConfig","config","then","_loadToChartComp","onFailed","fnFetch","api","getLimitRemaiming","uri","getRequestUrl","onCheckResponse","checkResponse","onFetch","bind","onCatch","fnCatch","_loadToChart","onAdded","_fetchToChart","itemCaption","value","hasSecondYAxis","chart","ChartStore","getActiveChart","series","toSeries","zhItemCaption","color","zhColor","ChartFn","addSeriaWithRenderLabel","label","_isAddCategoryToSpline","seriaType","indexOf","xAxis","categories","_loadItem","parentId","isLoadToChart","_crLoadFns","id","fnFetchToChartComp","fnFetchToChart","fLoadItem","fetchJson","_loadFns","loadItem","addPropsTo","crKey"],"mappings":"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","sourcesContent":["import { fetchJson } from '../../utils/fnFetch'\r\n\r\nimport ChartStore from '../stores/ChartStore'\r\nimport ChartFn from '../../charts/ChartFn'\r\n\r\nimport { fnCatch } from './fnCatch'\r\n\r\nconst ALERT = {\r\n  CATEGORY_TO_SPLINE: {\r\n    alertCaption: 'Series Error',\r\n    alertDescr: \"Adding category seria to not category isn't allowed.\"\r\n  }\r\n};\r\n\r\nconst _isArr = Array.isArray;\r\nconst _isFn = fn => typeof fn === 'function';\r\n\r\nconst _crOptionFetch = ({ optionFetch }, option) => _isFn(optionFetch)\r\n  ? optionFetch(option)\r\n  : optionFetch;\r\n\r\nconst _fetchToChartComp = function(objImpl ,{json, option, onCompleted}){\r\n  const { adapter } = objImpl\r\n      , { config } = adapter.toConfig(json, option);\r\n\r\n  if (!_isFn(config.then)){\r\n     onCompleted(option, config)\r\n  } else {\r\n    config.then(config => {\r\n      onCompleted(option, config)\r\n      return;\r\n    })\r\n  }\r\n};\r\n\r\nconst _loadToChartComp = function(objImpl, option, onCompleted, onFailed){\r\n  const { fnFetch, api } = objImpl\r\n  , { getLimitRemaiming } = api || {}\r\n  , optionFetch = _crOptionFetch(objImpl, option);\r\n\r\n  fnFetch({\r\n    uri : api.getRequestUrl(option),\r\n    option : option,\r\n    optionFetch: optionFetch,\r\n    getLimitRemaiming,\r\n    onCheckResponse : api.checkResponse,\r\n    onFetch : _fetchToChartComp.bind(null, objImpl),\r\n    onCompleted : onCompleted,\r\n    onCatch : fnCatch,\r\n    onFailed : onFailed\r\n  })\r\n}\r\n\r\nconst _loadToChart = function(objImpl, option, onAdded, onFailed){\r\n  const { fnFetch, api } = objImpl\r\n  , { getLimitRemaiming } = api || {}\r\n  , optionFetch = _crOptionFetch(objImpl, option);\r\n  fnFetch({\r\n    uri : api.getRequestUrl(option),\r\n    option : option,\r\n    optionFetch: optionFetch,\r\n    getLimitRemaiming,\r\n    onCheckResponse : api.checkResponse,\r\n    onFetch : _fetchToChart.bind(null, objImpl),\r\n    onCompleted : onAdded,\r\n    onCatch : fnCatch,\r\n    onFailed : onFailed\r\n  })\r\n};\r\n\r\nconst _fetchToChart = function(objImpl, { json, option, onCompleted }){\r\n  const { adapter } = objImpl\r\n      , { itemCaption, value, hasSecondYAxis } = option\r\n      , chart = ChartStore.getActiveChart()\r\n      , series = adapter.toSeries(json, option, chart)\r\n      , { zhItemCaption, color, zhColor } = series || {};\r\n\r\n  ChartFn.addSeriaWithRenderLabel({\r\n    chart, series,\r\n    label: zhItemCaption || itemCaption || value,\r\n    color: color || zhColor,\r\n    hasSecondYAxis: !!hasSecondYAxis\r\n  })\r\n  onCompleted(option)\r\n}\r\n\r\nconst _isAddCategoryToSpline = ({ seriaType }) => {\r\n  const chart = ChartStore.getActiveChart();\r\n  return seriaType\r\n    && seriaType.indexOf('_SET') !== -1\r\n    && chart && _isArr(chart.xAxis)\r\n    && !_isArr(chart.xAxis[0].categories);\r\n};\r\n\r\nconst _loadItem = function(objImpl, option, onCompleted, onAdded, onFailed){\r\n  const parentId = ChartStore.isLoadToChart();\r\n  if (!parentId) {\r\n     _loadToChartComp(objImpl, option, onCompleted, onFailed);\r\n  } else {\r\n    if (_isAddCategoryToSpline(option)) {\r\n      onFailed(ALERT.CATEGORY_TO_SPLINE)\r\n    } else {\r\n      option.parentId = parentId;\r\n      _loadToChart(objImpl, option, onAdded, onFailed);\r\n    }\r\n  }\r\n};\r\n\r\nconst _crLoadFns = (objImpl) => objImpl.id === 'Q'\r\n  ? {\r\n      fnFetchToChartComp: _fetchToChartComp.bind(null, objImpl),\r\n      fnFetchToChart: _fetchToChart.bind(null, objImpl),\r\n    }\r\n  : void 0;\r\n\r\nconst fLoadItem = (objImpl) => {\r\n   const {\r\n     fnFetch=fetchJson,\r\n     api, adapter\r\n   } = objImpl\r\n   , _loadFns = _crLoadFns(objImpl);\r\n   objImpl.fnFetch = fnFetch\r\n   return {\r\n     loadItem: _loadItem.bind(null, objImpl),\r\n     addPropsTo: api.addPropsTo,\r\n     crKey: adapter.crKey,\r\n     ..._loadFns\r\n   };\r\n}\r\n\r\nexport default fLoadItem\r\n"],"file":"loadItem.js"}