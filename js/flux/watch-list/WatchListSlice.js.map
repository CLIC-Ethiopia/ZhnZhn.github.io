{"version":3,"sources":["../../../src/flux/watch-list/WatchListSlice.js"],"names":["WATCH_SAVED","Msg","WATCH_PREV","STORAGE_KEY","DIALOG_CAPTION","WatchListSlice","watchList","DF_WATCH_LIST","isWatchEdited","initWatchList","LocalForage","getItem","then","value","trigger","BAT","UPDATE_WATCH_BROWSER","getWatchList","getWatchGroups","groups","getWatchListsByGroup","groupCaption","group","Logic","findGroup","lists","onAddItem","item","_onEditWatch","addItem","WAT","ADD_ITEM","onRemoveItem","option","removeItem","_triggerUpdateWL","_onDragDrop","result","isDone","showAlertDialog","onDragDropItem","dragDropItem","onDragDropList","dragDropList","onDragDropGroup","dragDropGroup","onSaveWatch","setItem","onShowModalDialog","ModalDialog","INFO","caption","descr","error","console","log","forActionType","EDIT_WATCH_COMPLETED","EDIT_WATCH_FAILED","messages","message","onAddGroup","addGroup","ADD_GROUP","onRenameGroup","renameGroup","RENAME_GROUP","onDeleteGroup","deleteGroup","DELETE_GROUP","onCreateList","createList","CREATE_LIST","onRenameList","renameList","RENAME_LIST","onDeleteList","deleteList","DELETE_LIST"],"mappings":"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","sourcesContent":["import LocalForage from 'localforage';\r\n\r\nimport { BrowserActionTypes as BAT } from '../actions/BrowserActions';\r\nimport { WatchActionTypes as WAT } from '../actions/WatchActions';\r\nimport DF_WATCH_LIST from '../../constants/WatchDefault';\r\nimport { ModalDialog }  from '../../constants/Type';\r\nimport Msg from '../../constants/MsgWatch';\r\n\r\nimport Logic from './Logic';\r\n\r\nconst { WATCH_SAVED, WATCH_PREV } = Msg;\r\n\r\nconst STORAGE_KEY = 'WATCH_LIST_ERC'\r\n    , DIALOG_CAPTION ='Watch List:';\r\n\r\nconst WatchListSlice = {\r\n\r\n  watchList: DF_WATCH_LIST,\r\n  isWatchEdited: false,\r\n\r\n  initWatchList(){\r\n    LocalForage\r\n     .getItem(STORAGE_KEY)\r\n     .then(value => {\r\n       this.watchList = value || DF_WATCH_LIST;\r\n       this.trigger(BAT.UPDATE_WATCH_BROWSER, this.watchList);\r\n     })\r\n     .catch(() => {\r\n       this.watchList = DF_WATCH_LIST;\r\n       this.trigger(BAT.UPDATE_WATCH_BROWSER, this.watchList);\r\n    })\r\n  },\r\n  getWatchList(){\r\n    return this.watchList;\r\n  },\r\n  getWatchGroups(){\r\n    return this.watchList.groups;\r\n  },\r\n  getWatchListsByGroup(groupCaption){\r\n    const group = Logic.findGroup(this.watchList, groupCaption);\r\n    if (!group) { return []; }\r\n    return group.lists;\r\n  },\r\n\r\n  onAddItem(item){\r\n    this._onEditWatch(\r\n      Logic.addItem(this.watchList, item),\r\n      WAT.ADD_ITEM\r\n    );\r\n  },\r\n  onRemoveItem(option){\r\n    Logic.removeItem(this.watchList, option);\r\n    this._triggerUpdateWL()\r\n  },\r\n\r\n  _triggerUpdateWL(){\r\n    this.isWatchEdited = true;\r\n    this.trigger(BAT.UPDATE_WATCH_BROWSER, this.watchList);\r\n  },\r\n\r\n\r\n  _onDragDrop(result){\r\n    if (result.isDone){\r\n       this._triggerUpdateWL()\r\n    } else {\r\n      this.showAlertDialog(result);\r\n    }\r\n  },\r\n\r\n\r\n  onDragDropItem(option){\r\n    this._onDragDrop(Logic.dragDropItem(this.watchList, option) );\r\n  },\r\n  onDragDropList(option){\r\n    this._onDragDrop(Logic.dragDropList(this.watchList, option) );\r\n  },\r\n  onDragDropGroup(option){\r\n    this._onDragDrop(Logic.dragDropGroup(this.watchList, option));\r\n  },\r\n\r\n\r\n  onSaveWatch(){\r\n    if (this.isWatchEdited){\r\n       LocalForage.setItem(STORAGE_KEY , this.watchList)\r\n          .then(()=>{\r\n             this.isWatchEdited = false;\r\n             this.onShowModalDialog(ModalDialog.INFO, {\r\n                caption: DIALOG_CAPTION,\r\n                descr: WATCH_SAVED\r\n             })\r\n          })\r\n          .catch((error) => {\r\n             console.log(error);\r\n          })\r\n    } else {\r\n       this.onShowModalDialog(ModalDialog.INFO, {\r\n          caption: DIALOG_CAPTION,\r\n          descr: WATCH_PREV\r\n       })\r\n    }\r\n  },\r\n\r\n  _onEditWatch(result, forActionType){\r\n    if (result.isDone){\r\n      this._triggerUpdateWL()\r\n      this.trigger(WAT.EDIT_WATCH_COMPLETED, { forActionType });\r\n    } else {\r\n      this.trigger(WAT.EDIT_WATCH_FAILED, {\r\n          messages:[result.message],\r\n          forActionType\r\n      });\r\n    }\r\n  },\r\n  onAddGroup(option){\r\n    this._onEditWatch(\r\n      Logic.addGroup(this.watchList, option),\r\n      WAT.ADD_GROUP\r\n    );\r\n  },\r\n  onRenameGroup(option){\r\n    this._onEditWatch(\r\n      Logic.renameGroup(this.watchList, option),\r\n      WAT.RENAME_GROUP\r\n    );\r\n  },\r\n  onDeleteGroup(option){\r\n    this._onEditWatch(\r\n      Logic.deleteGroup(this.watchList, option),\r\n      WAT.DELETE_GROUP\r\n    );\r\n  },\r\n\r\n  onCreateList(option){\r\n    this._onEditWatch(\r\n      Logic.createList(this.watchList, option),\r\n      WAT.CREATE_LIST\r\n    );\r\n  },\r\n  onRenameList(option){\r\n    this._onEditWatch(\r\n      Logic.renameList(this.watchList, option),\r\n      WAT.RENAME_LIST\r\n    );\r\n  },\r\n  onDeleteList(option){\r\n    this._onEditWatch(\r\n      Logic.deleteList(this.watchList, option),\r\n      WAT.DELETE_LIST\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default WatchListSlice\r\n"],"file":"WatchListSlice.js"}