{"version":3,"sources":["../../../src/flux/watch-list/WatchListSlice.js"],"names":["STORAGE_KEY","DIALOG_CAPTION","WatchListSlice","watchList","DF_WATCH_LIST","isWatchEdited","initWatchList","LocalForage","getItem","then","value","trigger","BAT_UPDATE_WATCH_BROWSER","catch","getWatchList","getWatchGroups","groups","getWatchListsByGroup","groupCaption","group","lists","onAddItem","item","_onEditWatch","WAT","ADD_ITEM","onRemoveItem","option","_triggerUpdateWL","_onDragDrop","result","isDone","showAlertDialog","onDragDropItem","onDragDropList","onDragDropGroup","onSaveWatch","setItem","onShowModalDialog","ModalDialog","INFO","caption","descr","WATCH_SAVED","error","console","log","WATCH_PREV","forActionType","EDIT_WATCH_COMPLETED","EDIT_WATCH_FAILED","messages","message","onAddGroup","ADD_GROUP","onRenameGroup","RENAME_GROUP","onDeleteGroup","DELETE_GROUP","onCreateList","CREATE_LIST","onRenameList","RENAME_LIST","onDeleteList","DELETE_LIST"],"mappings":"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","sourcesContent":["import LocalForage from 'localforage';\r\n\r\nimport { BAT_UPDATE_WATCH_BROWSER } from '../actions/BrowserActions';\r\nimport { WatchActionTypes as WAT } from '../actions/WatchActions';\r\nimport DF_WATCH_LIST from '../../constants/WatchDefault';\r\nimport { ModalDialog }  from '../../constants/Type';\r\nimport {\r\n  WATCH_SAVED,\r\n  WATCH_PREV\r\n} from '../../constants/MsgWatch';\r\n\r\nimport { findGroup } from './LogicFn';\r\nimport {\r\n  dragDropItem,\r\n  dragDropList,\r\n  dragDropGroup\r\n} from './WithLogicDnD';\r\nimport {\r\n  addGroup,\r\n  renameGroup,\r\n  deleteGroup\r\n} from './WithLogicGroup';\r\nimport {\r\n  createList,\r\n  renameList,\r\n  deleteList\r\n} from './WithLogicList';\r\nimport {\r\n  addItem,\r\n  removeItem\r\n} from './WithLogicItem';\r\n\r\nconst STORAGE_KEY = 'WATCH_LIST_ERC'\r\n, DIALOG_CAPTION ='Watch List:';\r\n\r\nconst WatchListSlice = {\r\n\r\n  watchList: DF_WATCH_LIST,\r\n  isWatchEdited: false,\r\n\r\n  initWatchList(){\r\n    LocalForage\r\n     .getItem(STORAGE_KEY)\r\n     .then(value => {\r\n       this.watchList = value || DF_WATCH_LIST;\r\n       this.trigger(BAT_UPDATE_WATCH_BROWSER, this.watchList);\r\n     })\r\n     .catch(() => {\r\n       this.watchList = DF_WATCH_LIST;\r\n       this.trigger(BAT_UPDATE_WATCH_BROWSER, this.watchList);\r\n    })\r\n  },\r\n  getWatchList(){\r\n    return this.watchList;\r\n  },\r\n  getWatchGroups(){\r\n    return this.watchList.groups;\r\n  },\r\n  getWatchListsByGroup(groupCaption){\r\n    const group = findGroup(this.watchList, groupCaption);\r\n    if (!group) { return []; }\r\n    return group.lists;\r\n  },\r\n\r\n  onAddItem(item){\r\n    this._onEditWatch(\r\n      addItem(this.watchList, item),\r\n      WAT.ADD_ITEM\r\n    );\r\n  },\r\n  onRemoveItem(option){\r\n    removeItem(this.watchList, option);\r\n    this._triggerUpdateWL()\r\n  },\r\n\r\n  _triggerUpdateWL(){\r\n    this.isWatchEdited = true;\r\n    this.trigger(BAT_UPDATE_WATCH_BROWSER, this.watchList);\r\n  },\r\n\r\n\r\n  _onDragDrop(result){\r\n    if (result.isDone){\r\n       this._triggerUpdateWL()\r\n    } else {\r\n      this.showAlertDialog(result);\r\n    }\r\n  },\r\n\r\n\r\n  onDragDropItem(option){\r\n    this._onDragDrop(dragDropItem(this.watchList, option) );\r\n  },\r\n  onDragDropList(option){\r\n    this._onDragDrop(dragDropList(this.watchList, option) );\r\n  },\r\n  onDragDropGroup(option){\r\n    this._onDragDrop(dragDropGroup(this.watchList, option));\r\n  },\r\n\r\n\r\n  onSaveWatch(){\r\n    if (this.isWatchEdited){\r\n       LocalForage.setItem(STORAGE_KEY , this.watchList)\r\n          .then(()=>{\r\n             this.isWatchEdited = false;\r\n             this.onShowModalDialog(ModalDialog.INFO, {\r\n                caption: DIALOG_CAPTION,\r\n                descr: WATCH_SAVED\r\n             })\r\n          })\r\n          .catch((error) => {\r\n             console.log(error);\r\n          })\r\n    } else {\r\n       this.onShowModalDialog(ModalDialog.INFO, {\r\n          caption: DIALOG_CAPTION,\r\n          descr: WATCH_PREV\r\n       })\r\n    }\r\n  },\r\n\r\n  _onEditWatch(result, forActionType){\r\n    if (result.isDone){\r\n      this._triggerUpdateWL()\r\n      this.trigger(WAT.EDIT_WATCH_COMPLETED, { forActionType });\r\n    } else {\r\n      this.trigger(WAT.EDIT_WATCH_FAILED, {\r\n          messages:[result.message],\r\n          forActionType\r\n      });\r\n    }\r\n  },\r\n  onAddGroup(option){\r\n    this._onEditWatch(\r\n      addGroup(this.watchList, option),\r\n      WAT.ADD_GROUP\r\n    );\r\n  },\r\n  onRenameGroup(option){\r\n    this._onEditWatch(\r\n      renameGroup(this.watchList, option),\r\n      WAT.RENAME_GROUP\r\n    );\r\n  },\r\n  onDeleteGroup(option){\r\n    this._onEditWatch(\r\n      deleteGroup(this.watchList, option),\r\n      WAT.DELETE_GROUP\r\n    );\r\n  },\r\n\r\n  onCreateList(option){\r\n    this._onEditWatch(\r\n      createList(this.watchList, option),\r\n      WAT.CREATE_LIST\r\n    );\r\n  },\r\n  onRenameList(option){\r\n    this._onEditWatch(\r\n      renameList(this.watchList, option),\r\n      WAT.RENAME_LIST\r\n    );\r\n  },\r\n  onDeleteList(option){\r\n    this._onEditWatch(\r\n      deleteList(this.watchList, option),\r\n      WAT.DELETE_LIST\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default WatchListSlice\r\n"],"file":"WatchListSlice.js"}