{"version":3,"sources":["../../../src/flux/watch-list/WatchListSlice.js"],"names":["STORAGE_KEY","DIALOG_CAPTION","WatchListSlice","watchList","DF_WATCH_LIST","isWatchEdited","initWatchList","LocalForage","getItem","then","value","trigger","BAT_UPDATE_WATCH_BROWSER","catch","getWatchList","getWatchGroups","groups","getWatchListsByGroup","groupCaption","group","lists","onAddItem","item","_onEditWatch","WAT_ADD_ITEM","onRemoveItem","option","_triggerUpdateWL","_onDragDrop","result","isDone","showAlertDialog","onDragDropItem","onDragDropList","onDragDropGroup","onSaveWatch","setItem","onShowModalDialog","MDT_INFO","caption","descr","WATCH_SAVED","error","console","log","WATCH_PREV","forActionType","WAT_EDIT_WATCH_COMPLETED","WAT_EDIT_WATCH_FAILED","messages","message","onAddGroup","WAT_ADD_GROUP","onRenameGroup","WAT_RENAME_GROUP","onDeleteGroup","WAT_DELETE_GROUP","onCreateList","WAT_CREATE_LIST","onRenameList","WAT_RENAME_LIST","onDeleteList","WAT_DELETE_LIST"],"mappings":"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","sourcesContent":["import LocalForage from 'localforage';\r\n\r\nimport { BAT_UPDATE_WATCH_BROWSER } from '../actions/BrowserActions';\r\nimport {\r\n  WAT_ADD_ITEM,\r\n  WAT_EDIT_WATCH_COMPLETED,\r\n  WAT_EDIT_WATCH_FAILED,\r\n  WAT_ADD_GROUP,\r\n  WAT_RENAME_GROUP,\r\n  WAT_DELETE_GROUP,\r\n  WAT_CREATE_LIST,\r\n  WAT_RENAME_LIST,\r\n  WAT_DELETE_LIST\r\n} from '../actions/WatchActions';\r\nimport DF_WATCH_LIST from '../../constants/WatchDefault';\r\nimport { MDT_INFO }  from '../../constants/ModalDialogType';\r\nimport {\r\n  WATCH_SAVED,\r\n  WATCH_PREV\r\n} from '../../constants/MsgWatch';\r\n\r\nimport { findGroup } from './LogicFn';\r\nimport {\r\n  dragDropItem,\r\n  dragDropList,\r\n  dragDropGroup\r\n} from './WithLogicDnD';\r\nimport {\r\n  addGroup,\r\n  renameGroup,\r\n  deleteGroup\r\n} from './WithLogicGroup';\r\nimport {\r\n  createList,\r\n  renameList,\r\n  deleteList\r\n} from './WithLogicList';\r\nimport {\r\n  addItem,\r\n  removeItem\r\n} from './WithLogicItem';\r\n\r\nconst STORAGE_KEY = 'WATCH_LIST_ERC'\r\n, DIALOG_CAPTION ='Watch List:';\r\n\r\nconst WatchListSlice = {\r\n\r\n  watchList: DF_WATCH_LIST,\r\n  isWatchEdited: false,\r\n\r\n  initWatchList(){\r\n    LocalForage\r\n     .getItem(STORAGE_KEY)\r\n     .then(value => {\r\n       this.watchList = value || DF_WATCH_LIST;\r\n       this.trigger(BAT_UPDATE_WATCH_BROWSER, this.watchList);\r\n     })\r\n     .catch(() => {\r\n       this.watchList = DF_WATCH_LIST;\r\n       this.trigger(BAT_UPDATE_WATCH_BROWSER, this.watchList);\r\n    })\r\n  },\r\n  getWatchList(){\r\n    return this.watchList;\r\n  },\r\n  getWatchGroups(){\r\n    return this.watchList.groups;\r\n  },\r\n  getWatchListsByGroup(groupCaption){\r\n    const group = findGroup(this.watchList, groupCaption);\r\n    if (!group) { return []; }\r\n    return group.lists;\r\n  },\r\n\r\n  onAddItem(item){\r\n    this._onEditWatch(\r\n      addItem(this.watchList, item),\r\n      WAT_ADD_ITEM\r\n    );\r\n  },\r\n  onRemoveItem(option){\r\n    removeItem(this.watchList, option);\r\n    this._triggerUpdateWL()\r\n  },\r\n\r\n  _triggerUpdateWL(){\r\n    this.isWatchEdited = true;\r\n    this.trigger(BAT_UPDATE_WATCH_BROWSER, this.watchList);\r\n  },\r\n\r\n\r\n  _onDragDrop(result){\r\n    if (result.isDone){\r\n       this._triggerUpdateWL()\r\n    } else {\r\n      this.showAlertDialog(result);\r\n    }\r\n  },\r\n\r\n\r\n  onDragDropItem(option){\r\n    this._onDragDrop(dragDropItem(this.watchList, option) );\r\n  },\r\n  onDragDropList(option){\r\n    this._onDragDrop(dragDropList(this.watchList, option) );\r\n  },\r\n  onDragDropGroup(option){\r\n    this._onDragDrop(dragDropGroup(this.watchList, option));\r\n  },\r\n\r\n\r\n  onSaveWatch(){\r\n    if (this.isWatchEdited){\r\n       LocalForage.setItem(STORAGE_KEY , this.watchList)\r\n          .then(()=>{\r\n             this.isWatchEdited = false;\r\n             this.onShowModalDialog(MDT_INFO, {\r\n                caption: DIALOG_CAPTION,\r\n                descr: WATCH_SAVED\r\n             })\r\n          })\r\n          .catch((error) => {\r\n             console.log(error);\r\n          })\r\n    } else {\r\n       this.onShowModalDialog(MDT_INFO, {\r\n          caption: DIALOG_CAPTION,\r\n          descr: WATCH_PREV\r\n       })\r\n    }\r\n  },\r\n\r\n  _onEditWatch(result, forActionType){\r\n    if (result.isDone){\r\n      this._triggerUpdateWL()\r\n      this.trigger(WAT_EDIT_WATCH_COMPLETED, { forActionType });\r\n    } else {\r\n      this.trigger(WAT_EDIT_WATCH_FAILED, {\r\n          messages:[result.message],\r\n          forActionType\r\n      });\r\n    }\r\n  },\r\n  onAddGroup(option){\r\n    this._onEditWatch(\r\n      addGroup(this.watchList, option),\r\n      WAT_ADD_GROUP\r\n    );\r\n  },\r\n  onRenameGroup(option){\r\n    this._onEditWatch(\r\n      renameGroup(this.watchList, option),\r\n      WAT_RENAME_GROUP\r\n    );\r\n  },\r\n  onDeleteGroup(option){\r\n    this._onEditWatch(\r\n      deleteGroup(this.watchList, option),\r\n      WAT_DELETE_GROUP\r\n    );\r\n  },\r\n\r\n  onCreateList(option){\r\n    this._onEditWatch(\r\n      createList(this.watchList, option),\r\n      WAT_CREATE_LIST\r\n    );\r\n  },\r\n  onRenameList(option){\r\n    this._onEditWatch(\r\n      renameList(this.watchList, option),\r\n      WAT_RENAME_LIST\r\n    );\r\n  },\r\n  onDeleteList(option){\r\n    this._onEditWatch(\r\n      deleteList(this.watchList, option),\r\n      WAT_DELETE_LIST\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default WatchListSlice\r\n"],"file":"WatchListSlice.js"}