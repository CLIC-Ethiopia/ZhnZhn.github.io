{"version":3,"sources":["../../../src/flux/watch-list/WatchListSlice.js"],"names":["STORAGE_KEY","DIALOG_CAPTION","WatchListSlice","watchList","DF_WATCH_LIST","isWatchEdited","initWatchList","LocalForage","getItem","then","value","trigger","BAT_UPDATE_WATCH_BROWSER","catch","getWatchList","getWatchGroups","groups","getWatchListsByGroup","groupCaption","group","Logic","findGroup","lists","onAddItem","item","_onEditWatch","addItem","WAT","ADD_ITEM","onRemoveItem","option","removeItem","_triggerUpdateWL","_onDragDrop","result","isDone","showAlertDialog","onDragDropItem","onDragDropList","onDragDropGroup","onSaveWatch","setItem","onShowModalDialog","ModalDialog","INFO","caption","descr","WATCH_SAVED","error","console","log","WATCH_PREV","forActionType","EDIT_WATCH_COMPLETED","EDIT_WATCH_FAILED","messages","message","onAddGroup","addGroup","ADD_GROUP","onRenameGroup","renameGroup","RENAME_GROUP","onDeleteGroup","deleteGroup","DELETE_GROUP","onCreateList","createList","CREATE_LIST","onRenameList","renameList","RENAME_LIST","onDeleteList","deleteList","DELETE_LIST"],"mappings":"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","sourcesContent":["import LocalForage from 'localforage';\r\n\r\nimport { BAT_UPDATE_WATCH_BROWSER } from '../actions/BrowserActions';\r\nimport { WatchActionTypes as WAT } from '../actions/WatchActions';\r\nimport DF_WATCH_LIST from '../../constants/WatchDefault';\r\nimport { ModalDialog }  from '../../constants/Type';\r\nimport {\r\n  WATCH_SAVED,\r\n  WATCH_PREV\r\n} from '../../constants/MsgWatch';\r\n\r\nimport Logic from './Logic';\r\nimport {\r\n  dragDropItem,\r\n  dragDropList,\r\n  dragDropGroup\r\n} from './WithLogicDnD';\r\n\r\nconst STORAGE_KEY = 'WATCH_LIST_ERC'\r\n, DIALOG_CAPTION ='Watch List:';\r\n\r\nconst WatchListSlice = {\r\n\r\n  watchList: DF_WATCH_LIST,\r\n  isWatchEdited: false,\r\n\r\n  initWatchList(){\r\n    LocalForage\r\n     .getItem(STORAGE_KEY)\r\n     .then(value => {\r\n       this.watchList = value || DF_WATCH_LIST;\r\n       this.trigger(BAT_UPDATE_WATCH_BROWSER, this.watchList);\r\n     })\r\n     .catch(() => {\r\n       this.watchList = DF_WATCH_LIST;\r\n       this.trigger(BAT_UPDATE_WATCH_BROWSER, this.watchList);\r\n    })\r\n  },\r\n  getWatchList(){\r\n    return this.watchList;\r\n  },\r\n  getWatchGroups(){\r\n    return this.watchList.groups;\r\n  },\r\n  getWatchListsByGroup(groupCaption){\r\n    const group = Logic.findGroup(this.watchList, groupCaption);\r\n    if (!group) { return []; }\r\n    return group.lists;\r\n  },\r\n\r\n  onAddItem(item){\r\n    this._onEditWatch(\r\n      Logic.addItem(this.watchList, item),\r\n      WAT.ADD_ITEM\r\n    );\r\n  },\r\n  onRemoveItem(option){\r\n    Logic.removeItem(this.watchList, option);\r\n    this._triggerUpdateWL()\r\n  },\r\n\r\n  _triggerUpdateWL(){\r\n    this.isWatchEdited = true;\r\n    this.trigger(BAT_UPDATE_WATCH_BROWSER, this.watchList);\r\n  },\r\n\r\n\r\n  _onDragDrop(result){\r\n    if (result.isDone){\r\n       this._triggerUpdateWL()\r\n    } else {\r\n      this.showAlertDialog(result);\r\n    }\r\n  },\r\n\r\n\r\n  onDragDropItem(option){\r\n    this._onDragDrop(dragDropItem(this.watchList, option) );\r\n  },\r\n  onDragDropList(option){\r\n    this._onDragDrop(dragDropList(this.watchList, option) );\r\n  },\r\n  onDragDropGroup(option){\r\n    this._onDragDrop(dragDropGroup(this.watchList, option));\r\n  },\r\n\r\n\r\n  onSaveWatch(){\r\n    if (this.isWatchEdited){\r\n       LocalForage.setItem(STORAGE_KEY , this.watchList)\r\n          .then(()=>{\r\n             this.isWatchEdited = false;\r\n             this.onShowModalDialog(ModalDialog.INFO, {\r\n                caption: DIALOG_CAPTION,\r\n                descr: WATCH_SAVED\r\n             })\r\n          })\r\n          .catch((error) => {\r\n             console.log(error);\r\n          })\r\n    } else {\r\n       this.onShowModalDialog(ModalDialog.INFO, {\r\n          caption: DIALOG_CAPTION,\r\n          descr: WATCH_PREV\r\n       })\r\n    }\r\n  },\r\n\r\n  _onEditWatch(result, forActionType){\r\n    if (result.isDone){\r\n      this._triggerUpdateWL()\r\n      this.trigger(WAT.EDIT_WATCH_COMPLETED, { forActionType });\r\n    } else {\r\n      this.trigger(WAT.EDIT_WATCH_FAILED, {\r\n          messages:[result.message],\r\n          forActionType\r\n      });\r\n    }\r\n  },\r\n  onAddGroup(option){\r\n    this._onEditWatch(\r\n      Logic.addGroup(this.watchList, option),\r\n      WAT.ADD_GROUP\r\n    );\r\n  },\r\n  onRenameGroup(option){\r\n    this._onEditWatch(\r\n      Logic.renameGroup(this.watchList, option),\r\n      WAT.RENAME_GROUP\r\n    );\r\n  },\r\n  onDeleteGroup(option){\r\n    this._onEditWatch(\r\n      Logic.deleteGroup(this.watchList, option),\r\n      WAT.DELETE_GROUP\r\n    );\r\n  },\r\n\r\n  onCreateList(option){\r\n    this._onEditWatch(\r\n      Logic.createList(this.watchList, option),\r\n      WAT.CREATE_LIST\r\n    );\r\n  },\r\n  onRenameList(option){\r\n    this._onEditWatch(\r\n      Logic.renameList(this.watchList, option),\r\n      WAT.RENAME_LIST\r\n    );\r\n  },\r\n  onDeleteList(option){\r\n    this._onEditWatch(\r\n      Logic.deleteList(this.watchList, option),\r\n      WAT.DELETE_LIST\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default WatchListSlice\r\n"],"file":"WatchListSlice.js"}