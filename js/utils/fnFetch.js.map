{"version":3,"sources":["../../src/utils/fnFetch.js"],"names":["C","REQ_ERR","RESP_ERR","MSG_400","MSG_404","MSG_429","MSG_503","_isFn","fn","_isInArrValue","arr","value","Array","isArray","indexOf","_crErr","message","errCaption","_throwIfNotStatus","errStatus","status","msg","_promiseAll","response","propName","getLimitRemaiming","headers","_limitRemaining","get","Promise","all","resolve","_fFetch","type","uri","option","optionFetch","onCheckResponse","onFetch","onCompleted","onFailed","onCatch","_fnFetch","fetch","fetchJsonpImpl","then","statusText","ok","resErrStatus","undefined","limitRemaining","json","error","console","log","fetchJson","fetchTxt","fetchJsonp"],"mappings":";;;;;;;AAAA;;AAEA,IAAMA,CAAC,GAAG;AACR;AACAC,EAAAA,OAAO,EAAE,eAFD;AAGRC,EAAAA,QAAQ,EAAE,gBAHF;AAKRC,EAAAA,OAAO,EAAE,mBALD;AAMRC,EAAAA,OAAO,EAAE,+BAND;AAORC,EAAAA,OAAO,EAAE,kEAPD;AAQRC,EAAAA,OAAO,EAAE;AARD,CAAV;;AAWA,IAAMC,KAAK,GAAG,SAARA,KAAQ,CAAAC,EAAE;AAAA,SAAI,OAAOA,EAAP,KAAc,UAAlB;AAAA,CAAhB;;AAEA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,GAAD,EAAMC,KAAN;AAAA,SAAgBC,KAAK,CAACC,OAAN,CAAcH,GAAd,KACjCA,GAAG,CAACI,OAAJ,CAAYH,KAAZ,MAAuB,CAAC,CADP;AAAA,CAAtB;;AAGA,IAAMI,MAAM,GAAG,SAATA,MAAS,CAACC,OAAD,EAAUC,UAAV;AAAA,MAAUA,UAAV;AAAUA,IAAAA,UAAV,GAAqBjB,CAAC,CAACC,OAAvB;AAAA;;AAAA,SAAoC;AACjDgB,IAAAA,UAAU,EAAVA,UADiD;AAEjDD,IAAAA,OAAO,EAAPA;AAFiD,GAApC;AAAA,CAAf;;AAKA,IAAME,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,SAAD,EAAYC,MAAZ,EAAoBC,GAApB,EAA4B;AACpD,MAAI,CAACZ,aAAa,CAACU,SAAD,EAAYC,MAAZ,CAAlB,EAAuC;AACrC,UAAML,MAAM,CAACM,GAAD,CAAZ;AACD;AACF,CAJD;;AAMA,IAAMC,WAAW,GAAG,SAAdA,WAAc,OAGd;AAAA,MAFJC,QAEI,QAFJA,QAEI;AAAA,MAFMC,QAEN,QAFMA,QAEN;AAAA,MAFgBJ,MAEhB,QAFgBA,MAEhB;AAAA,MADJK,iBACI,QADJA,iBACI;;AACJ,MAAMC,OAAO,GAAGH,QAAQ,CAACG,OAAzB;AAAA,MACEC,eAAe,GAAGD,OAAO,IACnBnB,KAAK,CAACmB,OAAO,CAACE,GAAT,CADO,IAEZrB,KAAK,CAACkB,iBAAD,CAFO,GAGZA,iBAAiB,CAACC,OAAD,CAHL,GAIZ,KAAK,CALb;;AAMA,SAAOG,OAAO,CAACC,GAAR,CAAY,CACjBD,OAAO,CAACE,OAAR,CAAgBJ,eAAhB,CADiB,EAEjBJ,QAAQ,CAACC,QAAD,CAAR,EAFiB,EAGjBK,OAAO,CAACE,OAAR,CAAgBX,MAAhB,CAHiB,CAAZ,CAAP;AAKD,CAfD;;AAiBA,IAAMY,OAAO,GAAG,SAAVA,OAAU,CAACR,QAAD,EAAWS,IAAX;AAAA,SAAoB,iBAOjC;AAAA,QANAC,GAMA,SANAA,GAMA;AAAA,6BANKC,MAML;AAAA,QANKA,MAML,6BANY,EAMZ;AAAA,QALAC,WAKA,SALAA,WAKA;AAAA,QAJAX,iBAIA,SAJAA,iBAIA;AAAA,QAHAY,eAGA,SAHAA,eAGA;AAAA,QAFAC,OAEA,SAFAA,OAEA;AAAA,QAFSC,WAET,SAFSA,WAET;AAAA,QADAC,QACA,SADAA,QACA;AAAA,QADUC,OACV,SADUA,OACV;;AACD,QAAMC,QAAQ,GAAGT,IAAI,KAAK,OAAT,GACbU,KADa,GAEbC,sBAFJ;;AAGAF,IAAAA,QAAQ,CAACR,GAAD,EAAME,WAAN,CAAR,CACGS,IADH,CACQ,UAAAtB,QAAQ,EAAI;AAAA,UACRH,MADQ,GACmBG,QADnB,CACRH,MADQ;AAAA,UACA0B,UADA,GACmBvB,QADnB,CACAuB,UADA;AAAA,UACYC,EADZ,GACmBxB,QADnB,CACYwB,EADZ;AAAA,UAERC,YAFQ,GAEQb,MAFR,CAERa,YAFQ;;AAGhB,UAAK5B,MAAM,IAAE,GAAR,IAAeA,MAAM,GAAC,GAAvB,IAA+B2B,EAAnC,EAAuC;AACpC,eAAOzB,WAAW,CAAC;AACjBC,UAAAA,QAAQ,EAARA,QADiB;AACPC,UAAAA,QAAQ,EAARA,QADO;AAEjBC,UAAAA,iBAAiB,EAAjBA;AAFiB,SAAD,CAAlB;AAIF,OALD,MAKO,IAAIL,MAAM,KAAK,GAAf,EAAoB;AACxBF,QAAAA,iBAAiB,CAAC8B,YAAD,EAAe5B,MAAf,EAAuBpB,CAAC,CAACG,OAAzB,CAAjB;;AACA,eAAOmB,WAAW,CAAC;AAAEC,UAAAA,QAAQ,EAARA,QAAF;AAAYC,UAAAA,QAAQ,EAARA,QAAZ;AAAsBJ,UAAAA,MAAM,EAANA;AAAtB,SAAD,CAAlB;AACF,OAHM,MAGA,IAAIA,MAAM,KAAK,GAAf,EAAoB;AACxB,cAAML,MAAM,CAACf,CAAC,CAACI,OAAH,CAAZ;AACF,OAFM,MAEA,IAAIgB,MAAM,KAAK,GAAf,EAAoB;AACxB,cAAML,MAAM,CAACf,CAAC,CAACK,OAAH,CAAZ;AACF,OAFM,MAEA,IAAIe,MAAM,GAAC,GAAP,IAAcA,MAAM,GAAC,GAAzB,EAA6B;AACjCF,QAAAA,iBAAiB,CAAC8B,YAAD,EAAe5B,MAAf,EAA0BA,MAA1B,UAAqC0B,UAArC,CAAjB;;AACA,eAAOxB,WAAW,CAAC;AAAEC,UAAAA,QAAQ,EAARA,QAAF;AAAYC,UAAAA,QAAQ,EAARA,QAAZ;AAAsBJ,UAAAA,MAAM,EAANA;AAAtB,SAAD,CAAlB;AACF,OAHM,MAGA,IAAIA,MAAM,KAAK,GAAf,EAAoB;AACxB,cAAML,MAAM,CAACf,CAAC,CAACM,OAAH,CAAZ;AACF,OAFM,MAEA,IAAIc,MAAM,IAAE,GAAR,IAAeA,MAAM,GAAC,GAA1B,EAA8B;AAClC,cAAML,MAAM,CAAIK,MAAJ,UAAe0B,UAAf,EAA6B9C,CAAC,CAACE,QAA/B,CAAZ;AACF,OAFM,MAEA;AACL,eAAO,CAAC+C,SAAD,EAAY,EAAZ,EAAgB7B,MAAhB,CAAP;AACD;AACF,KA1BH,EA2BGyB,IA3BH,CA2BQ,iBAAoC;AAAA,UAAlCK,cAAkC;AAAA,UAAlBC,IAAkB;AAAA,UAAZ/B,MAAY;;AACvC,UAAIb,KAAK,CAAC8B,eAAD,CAAT,EAA2B;AACzB,YAAIA,eAAe,CAACc,IAAD,EAAOhB,MAAP,EAAef,MAAf,CAAnB,EAA2C;AACzCe,UAAAA,MAAM,CAACe,cAAP,GAAwBA,cAAxB;AACAZ,UAAAA,OAAO,CAAC;AAAEa,YAAAA,IAAI,EAAJA,IAAF;AAAQhB,YAAAA,MAAM,EAANA,MAAR;AAAgBI,YAAAA,WAAW,EAAXA;AAAhB,WAAD,CAAP;AACD;AACH,OALA,MAKM;AACLJ,QAAAA,MAAM,CAACe,cAAP,GAAwBA,cAAxB;AACAZ,QAAAA,OAAO,CAAC;AAAEa,UAAAA,IAAI,EAAJA,IAAF;AAAQhB,UAAAA,MAAM,EAANA,MAAR;AAAgBI,UAAAA,WAAW,EAAXA;AAAhB,SAAD,CAAP;AACD;AACF,KArCH,WAsCS,UAAAa,KAAK,EAAI;AACb,UAAI7C,KAAK,CAACkC,OAAD,CAAT,EAAoB;AACjBA,QAAAA,OAAO,CAAC;AAAEW,UAAAA,KAAK,EAALA,KAAF;AAASjB,UAAAA,MAAM,EAANA,MAAT;AAAiBK,UAAAA,QAAQ,EAARA;AAAjB,SAAD,CAAP;AACF,OAFD,MAEO;AACLa,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD;AACH,KA5CH;AA6CD,GAxDe;AAAA,CAAhB;;AA0DO,IAAMG,SAAS,GAAGvB,OAAO,CAAC,MAAD,CAAzB;;;;AACA,IAAMwB,QAAQ,GAAGxB,OAAO,CAAC,MAAD,CAAxB;;;;AACA,IAAMyB,UAAU,GAAGzB,OAAO,CAAC,MAAD,EAAS,OAAT,CAA1B","sourcesContent":["import fetchJsonpImpl from 'fetch-jsonp'\r\n\r\nconst C = {\r\n  //LIMIT_REMAINING: 'X-RateLimit-Remaining',\r\n  REQ_ERR: 'Request Error',\r\n  RESP_ERR: 'Response Error',\r\n\r\n  MSG_400: '400: Bad request.',\r\n  MSG_404: '404: Resource is not existed.',\r\n  MSG_429: '429: Too many request in a given amount of time (rate limiting).',\r\n  MSG_503: '503: Back-end server is at capacity.'\r\n};\r\n\r\nconst _isFn = fn => typeof fn === 'function';\r\n\r\nconst _isInArrValue = (arr, value) => Array.isArray(arr)\r\n  && arr.indexOf(value) !== -1;\r\n\r\nconst _crErr = (message, errCaption=C.REQ_ERR) => ({\r\n  errCaption,\r\n  message\r\n});\r\n\r\nconst _throwIfNotStatus = (errStatus, status, msg) => {\r\n  if (!_isInArrValue(errStatus, status)) {\r\n    throw _crErr(msg);\r\n  }\r\n};\r\n\r\nconst _promiseAll = ({\r\n  response, propName, status,\r\n  getLimitRemaiming\r\n}) => {\r\n  const headers = response.headers\r\n  , _limitRemaining = headers\r\n       && _isFn(headers.get)\r\n       && _isFn(getLimitRemaiming)\r\n        ? getLimitRemaiming(headers)\r\n        : void 0;\r\n  return Promise.all([\r\n    Promise.resolve(_limitRemaining),\r\n    response[propName](),\r\n    Promise.resolve(status)\r\n  ]);\r\n};\r\n\r\nconst _fFetch = (propName, type) => function({\r\n   uri, option={},\r\n   optionFetch,\r\n   getLimitRemaiming,\r\n   onCheckResponse,\r\n   onFetch, onCompleted,\r\n   onFailed, onCatch\r\n }){\r\n  const _fnFetch = type !== 'jsonp'\r\n    ? fetch\r\n    : fetchJsonpImpl;\r\n  _fnFetch(uri, optionFetch)\r\n    .then(response => {\r\n      const { status, statusText, ok } = response\r\n          , { resErrStatus} = option;\r\n      if ((status>=200 && status<400) || ok) {\r\n         return _promiseAll({\r\n           response, propName,\r\n           getLimitRemaiming\r\n         });\r\n      } else if (status === 400) {\r\n         _throwIfNotStatus(resErrStatus, status, C.MSG_400)\r\n         return _promiseAll({ response, propName, status });\r\n      } else if (status === 404) {\r\n         throw _crErr(C.MSG_404);\r\n      } else if (status === 429) {\r\n         throw _crErr(C.MSG_429);\r\n      } else if (status>400 && status<500){\r\n         _throwIfNotStatus(resErrStatus, status, `${status}: ${statusText}`)\r\n         return _promiseAll({ response, propName, status });\r\n      } else if (status === 503) {\r\n         throw _crErr(C.MSG_503);\r\n      } else if (status>=500 && status<600){\r\n         throw _crErr(`${status}: ${statusText}`, C.RESP_ERR);\r\n      } else {\r\n        return [undefined, {}, status];\r\n      }\r\n    })\r\n    .then(([limitRemaining, json, status]) => {\r\n       if (_isFn(onCheckResponse)){\r\n         if (onCheckResponse(json, option, status)) {\r\n           option.limitRemaining = limitRemaining;\r\n           onFetch({ json, option, onCompleted });\r\n         }\r\n      } else {\r\n        option.limitRemaining = limitRemaining;\r\n        onFetch({ json, option, onCompleted });\r\n      }\r\n    })\r\n    .catch(error => {\r\n       if (_isFn(onCatch)) {\r\n          onCatch({ error, option, onFailed })\r\n       } else {\r\n         console.log(error)\r\n       }\r\n    })\r\n};\r\n\r\nexport const fetchJson = _fFetch('json');\r\nexport const fetchTxt = _fFetch('text');\r\nexport const fetchJsonp = _fFetch('json', 'jsonp');\r\n"],"file":"fnFetch.js"}